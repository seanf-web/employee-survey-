<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TASK Monthly Employment Check-In</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }
    .header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .lang-select { display: flex; align-items: center; gap: 10px; }
    .progress { display: flex; justify-content: space-between; flex: 1; margin-left: 30px; }
    .step {
      width: 50px; height: 50px; border-radius: 50%;
      background: #ccc; color: white; display: flex;
      align-items: center; justify-content: center;
      font-weight: bold; font-size: 18px;
    }
    .step.active { background: #145078; }
    h1,h2 { color:#145078; text-align:center; }
    h1{ font-size:2.3em; } h2{ font-size:1.9em; margin-bottom:10px; }

    label { font-weight:bold; display:block; margin:12px 0 6px; color:#333; }
    input, select, textarea {
      width:100%; padding:14px 16px; border:2px solid #d1d5db;
      border-radius:14px; font-size:16px; margin-bottom:18px;
      box-sizing:border-box; transition:all 0.2s ease;
    }
    input:focus,select:focus,textarea:focus {
      border-color:#33a7b5; box-shadow:0 0 6px rgba(51,167,181,0.4);
      outline:none;
    }
    textarea { min-height:100px; resize:vertical; border-radius:14px; }

    .btn {
      padding:14px 26px; border:none; border-radius:14px;
      font-weight:bold; cursor:pointer; margin:10px 5px 0 0;
      background:linear-gradient(135deg,#145078,#33a7b5); color:white;
      transition:all 0.2s ease;
    }
    .btn:hover { transform:translateY(-2px); box-shadow:0 4px 10px rgba(0,0,0,0.2); }

    .highlight-box { border:2px solid #facc15; border-radius:14px; padding:20px; margin:20px 0; background:#fefce8; }

    .radio-card {
      border:2px solid #d1d5db; border-radius:14px; padding:20px;
      text-align:center; cursor:pointer; background:#fafafa; transition:all 0.2s ease;
    }
    .radio-card:hover { background:#f1f5f9; }
    .radio-card input { margin-top:12px; transform:scale(1.3); }

    .upload-box {
      border:2px dashed #93c5fd; border-radius:14px;
      padding:25px; text-align:center; cursor:pointer; background:#f9fafb;
    }
    .upload-box:hover { background:#eff6ff; }
    .preview img { max-width:140px; margin:6px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.15); }
    .preview div.file-name { background:#f3f4f6; border:1px solid #d1d5db; border-radius:6px; padding:8px; margin:5px; font-size:14px; }

    /* Tutorial Overlay */
    #tutorialOverlay {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.7);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 9999;
    }
    #tutorialBox {
      background: white;
      border-radius: 16px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    }
    #tutorialBox h2 {
      color:#145078;
      margin-bottom:20px;
    }
    .voice-test-btn {
      background:#facc15;
      color:#111;
      border:none;
      padding:10px 16px;
      border-radius:8px;
      font-weight:bold;
      cursor:pointer;
      margin-top:8px;
    }
    .voice-test-btn.playing {
      background:#dc2626;
      color:white;
    }
  </style>
</head>
<body>
  <div id="tutorialOverlay">
    <div id="tutorialBox">
      <h2>üëã Welcome to the Guided Tutorial</h2>
      <p>Select a tutorial language and guide voice below:</p>

      <div class="section">
        <h3 style="color:#0284c7;">Choose Language</h3>
        <select id="tutorialLang" style="width:100%; padding:10px; margin:8px 0;">
          <option value="en">English</option>
          <option value="es">Espa√±ol</option>
          <option value="ht">Krey√≤l</option>
        </select>
      </div>

      <div class="section voice-section">
        <h3 style="color:#0284c7;">Choose Your Guide</h3>
        <select id="voiceSelect" style="width:100%; padding:10px; margin:8px 0;">
          <option value="Sean">Sean - Steady & Reassuring</option>
          <option value="Diani">Diani - Bright & Encouraging</option>
          <option value="Mia">Mia - Gentle & Understanding</option>
          <option value="Tiffany">Tiffany - Energetic & Clear</option>
          <option value="Paul">Paul - Calm & Thoughtful</option>
          <option value="Adam">Adam - Direct & Focused</option>
          <option value="Frank">Frank - Supportive & Straightforward</option>
        </select>
        <button id="voiceTestBtn" class="voice-test-btn">üîä TEST THIS VOICE</button>
      </div>

      <div style="margin-top:20px;">
        <button class="btn" onclick="startTutorial()">‚ñ∂Ô∏è Start Tutorial</button>
        <button class="btn" style="background:#6b7280;" onclick="skipTutorial()">‚è≠Ô∏è Skip Tutorial</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div id="survey"></div>
  </div>
<script>
let page = 1;
let formData = {};
let lang = "en";

const translations = {
  en: {
    continue: "Continue",
    back: "Back",
    submit: "Submit Monthly Report",
    stillWorking: "Are you still employed at this TASK-assisted job? *",
    yesEmployed: "Yes, still employed",
    noEmployed: "No longer employed",
    yesHelper: "Great job maintaining employment",
    noHelper: "We are here to help you find another job",
    completeRequired: "Please complete all required fields before continuing.",
    stopMessage: "You are no longer eligible to complete this survey. Please contact TASK."
  },
  es: {
    continue: "Continuar",
    back: "Atr√°s",
    submit: "Enviar Informe Mensual",
    stillWorking: "¬øSigues empleado en este trabajo asistido por TASK? *",
    yesEmployed: "S√≠, sigo empleado",
    noEmployed: "Ya no estoy empleado",
    yesHelper: "¬°Excelente trabajo manteniendo el empleo!",
    noHelper: "Estamos aqu√≠ para ayudarte a encontrar otro trabajo",
    completeRequired: "Por favor completa todos los campos requeridos antes de continuar.",
    stopMessage: "Ya no eres elegible para completar esta encuesta. Por favor contacta a TASK."
  },
  ht: {
    continue: "Kontinye",
    back: "Retounen",
    submit: "Soum√®t Rap√≤ Chak Mwa",
    stillWorking: "√àske w ap toujou travay nan travay TASK te ede w jwenn lan? *",
    yesEmployed: "Wi, toujou ap travay",
    noEmployed: "Mwen pa travay ank√≤",
    yesHelper: "Bon travay kenbe travay la!",
    noHelper: "Nou la pou ede ou jwenn yon l√≤t travay",
    completeRequired: "Tanpri ranpli tout chan obligatwa yo anvan ou kontinye.",
    stopMessage: "Ou pa elijib pou konplete sondaj sa ank√≤. Tanpri kontakte TASK."
  }
};

// ===== Tutorial Voices =====
const voiceData = {
  Sean:   { gender: 'male', pitch: 1.0, rate: 1.0, intro: {
    en: "Hey there! I'm Sean, your steady and reassuring guide. Let‚Äôs complete this survey together step by step.",
    es: "¬°Hola! Soy Sean, tu gu√≠a firme y tranquilo. Vamos a completar esta encuesta paso a paso.",
    ht: "Bonjou! Mwen se Sean, gid ou ki konfyans. Ann konplete sondaj sa a etap pa etap."
  }},
  Diani:  { gender: 'female', pitch: 1.3, rate: 1.05, intro: {
    en: "Hi! I‚Äôm Diani, excited to guide you today. I‚Äôll make sure this feels bright and encouraging!",
    es: "¬°Hola! Soy Diani y estoy emocionada de guiarte hoy. ¬°Haremos esto de forma positiva y alentadora!",
    ht: "Bonjou! Mwen se Diani, mwen kontan pou ede w jodi a. Ann f√® sa ak k√® kontan ak ankourajman!"
  }},
  Mia:    { gender: 'female', pitch: 1.1, rate: 1.0, intro: {
    en: "Hello, I‚Äôm Mia. I know surveys can feel like a lot, so I‚Äôll keep this gentle and easy for you.",
    es: "Hola, soy Mia. S√© que las encuestas pueden sentirse pesadas, as√≠ que har√© que sea suave y f√°cil.",
    ht: "Bonjou, mwen se Mia. Mwen konnen sondaj yo ka sanble tw√≤p, kidonk m ap f√® sa senp e fasil pou ou."
  }},
  Tiffany:{ gender: 'female', pitch: 1.4, rate: 1.15, intro: {
    en: "What‚Äôs up! I‚Äôm Tiffany, here to guide you with energy. This will be quick and clear.",
    es: "¬°Hola! Soy Tiffany, y te guiar√© con energ√≠a. Esto ser√° r√°pido y claro.",
    ht: "Kijan ou ye! Mwen se Tiffany, mwen la ak en√®ji pou ede ou. Sa ap rapid e kl√®."
  }},
  Paul:   { gender: 'male', pitch: 0.9, rate: 0.95, intro: {
    en: "Good day, I‚Äôm Paul. Calm and thoughtful, I‚Äôll guide you carefully through each step.",
    es: "Buen d√≠a, soy Paul. Con calma y cuidado, te guiar√© paso a paso.",
    ht: "Bonjou, mwen se Paul. Trankil e reflechi, m ap mennen ou av√®k swen."
  }},
  Adam:   { gender: 'male', pitch: 1.0, rate: 1.05, intro: {
    en: "Hey! I‚Äôm Adam, direct and focused. Let‚Äôs get this survey done together.",
    es: "¬°Hola! Soy Adam, directo y enfocado. Vamos a completar esta encuesta juntos.",
    ht: "Bonjou! Mwen se Adam, dir√®k e konsantre. Ann fini sondaj sa ansanm."
  }},
  Frank:  { gender: 'male', pitch: 0.95, rate: 1.0, intro: {
    en: "Hi, I‚Äôm Frank. I‚Äôll keep this straightforward and supportive as we move through the survey.",
    es: "Hola, soy Frank. Mantendr√© esto claro y con apoyo mientras avanzamos en la encuesta.",
    ht: "Bonjou, mwen se Frank. M ap f√® bagay yo kl√® e ak sip√≤ pandan n ap f√® sondaj la."
  }}
};
let availableVoices = [];
let isCurrentlySpeaking = false;

// Load browser voices when available
function loadVoices() {
  availableVoices = speechSynthesis.getVoices();
}
speechSynthesis.onvoiceschanged = loadVoices;

// Test selected voice intro
function testVoice() {
  const testBtn = document.getElementById('voiceTestBtn');
  const voiceSelect = document.getElementById('voiceSelect');
  const tutorialLang = document.getElementById('tutorialLang')?.value || 'en';
  const selected = voiceSelect.value;

  if (isCurrentlySpeaking) {
    speechSynthesis.cancel();
    isCurrentlySpeaking = false;
    testBtn.textContent = 'üîä TEST THIS VOICE';
    testBtn.classList.remove('playing');
    return;
  }

  // Get intro text for chosen voice + language
  const introText = voiceData[selected]?.intro[tutorialLang] || "Testing this voice...";

  const utterance = new SpeechSynthesisUtterance(introText);

  // Pick best-matching voice
  if (availableVoices.length > 0) {
    const config = voiceData[selected] || {};
    utterance.voice = availableVoices.find(v => 
      (config.gender === 'male' && v.name.toLowerCase().includes('male')) ||
      (config.gender === 'female' && v.name.toLowerCase().includes('female'))
    ) || availableVoices[0];
  }

  // Adjust pitch, rate, volume
  utterance.rate = voiceData[selected]?.rate || 1.0;
  utterance.pitch = voiceData[selected]?.pitch || 1.0;
  utterance.volume = 0.9;

  utterance.onstart = () => {
    isCurrentlySpeaking = true;
    testBtn.textContent = '‚èπÔ∏è STOP VOICE';
    testBtn.classList.add('playing');
  };

  utterance.onend = () => {
    isCurrentlySpeaking = false;
    testBtn.textContent = 'üîä TEST THIS VOICE';
    testBtn.classList.remove('playing');
  };

  speechSynthesis.speak(utterance);
}

// Hook test button
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("voiceTestBtn").addEventListener("click", testVoice);
});
function getTutorialSteps() {
  const steps = [
    {
      page: 1,
      selector: '.radio-card:first-child',
      text: {
        en: "Let‚Äôs begin with the first question. Since you‚Äôre here, you‚Äôre probably still employed. Select ‚ÄòYes, still employed‚Äô.",
        es: "Comencemos con la primera pregunta. Como est√°s aqu√≠, probablemente sigues empleado. Selecciona ‚ÄòS√≠, sigo empleado‚Äô.",
        ht: "Ann k√≤manse ak premye kesyon an. Depi ou la, ou pwobableman toujou gen travay. Chwazi ‚ÄòWi, toujou ap travay‚Äô."
      },
      action: () => {
        setTimeout(() => {
          const radio = document.querySelector('input[value="yes"]');
          if (radio) {
            radio.checked = true;
            formData.stillWorking = "yes";
            toggleEmployment(true);
          }
        }, 600);
      }
    },
    {
      page: 1,
      selector: '#continueBtn',
      text: {
        en: "Perfect! See how the Continue button appeared? Click it to move on.",
        es: "¬°Perfecto! ¬øVes c√≥mo apareci√≥ el bot√≥n Continuar? Haz clic para continuar.",
        ht: "Paf√®! Ou w√® kijan bouton Kontinye a par√®t? Klike sou li pou kontinye."
      },
      action: () => {
        setTimeout(() => nextPage(), 1200);
      }
    },
    {
      page: 2,
      selector: '#firstName',
      text: {
        en: "Now we‚Äôre at Step 2 for your contact info. Let‚Äôs start by entering a first name.",
        es: "Ahora estamos en el Paso 2 para tu informaci√≥n de contacto. Ingresemos un nombre.",
        ht: "Kounye a nou nan Etap 2 pou enf√≤masyon kontak ou. Ann mete yon non."
      },
      action: () => {
        setTimeout(() => {
          const field = document.getElementById('firstName');
          if (field) field.value = "John";
        }, 800);
      }
    },
    {
      page: 2,
      selector: '#lastName',
      text: {
        en: "Next, type a last name.",
        es: "Ahora escribe un apellido.",
        ht: "Kounye a mete yon siyati."
      },
      action: () => {
        setTimeout(() => {
          const field = document.getElementById('lastName');
          if (field) field.value = "Smith";
        }, 800);
      }
    },
    {
      page: 2,
      selector: '.btn:last-child',
      text: {
        en: "Good! Click Continue to go to Step 3.",
        es: "¬°Bien! Haz clic en Continuar para ir al Paso 3.",
        ht: "Bon! Klike sou Kontinye pou ale nan Etap 3."
      },
      action: () => {
        setTimeout(() => nextPage(), 1200);
      }
    },
    {
      page: 3,
      selector: '#q1',
      text: {
        en: "Step 3 is about your experience. First, describe wha
let selectedVoice = null;

// Speak helper using chosen guide + language
function speak(text, callback) {
  if (!speechSynthesis) return callback?.();

  if (speechSynthesis.speaking) {
    speechSynthesis.cancel();
  }

  const voiceSelect = document.getElementById('voiceSelect');
  const tutorialLang = document.getElementById('tutorialLang')?.value || 'en';
  const chosen = voiceSelect.value;
  const config = voiceData[chosen] || voiceData.Sean;

  const utterance = new SpeechSynthesisUtterance(text);

  // Assign actual browser voice if available
  if (availableVoices.length > 0) {
    utterance.voice = availableVoices.find(v =>
      (config.gender === 'male' && v.name.toLowerCase().includes('male')) ||
      (config.gender === 'female' && v.name.toLowerCase().includes('female'))
    ) || availableVoices[0];
  }

  // Apply per-voice tuning
  utterance.rate = config.rate || 1.0;
  utterance.pitch = config.pitch || 1.0;
  utterance.volume = 0.9;

  utterance.onend = () => {
    if (callback) callback();
  };

  speechSynthesis.speak(utterance);
}

// Tutorial runner
let isDemoMode = false;
let demoStep = 0;

function runTutorialStep() {
  if (!isDemoMode) return;

  const steps = getTutorialSteps();
  if (demoStep >= steps.length) {
    const voiceSelect = document.getElementById('voiceSelect');
    const tutorialLang = document.getElementById('tutorialLang')?.value || 'en';
    const chosen = voiceSelect.value;
    const config = voiceData[chosen] || voiceData.Sean;

    const closingText = {
      en: "Tutorial completed! You can now fill in your real information.",
      es: "¬°Tutorial completado! Ahora puedes ingresar tu informaci√≥n real.",
      ht: "Tutorial fini! Kounye a ou ka ranpli enf√≤masyon rey√®l ou."
    }[tutorialLang];

    speak(closingText, exitTutorial);
    return;
  }

  const step = steps[demoStep];

  // Make sure we‚Äôre on the right page
  if (page !== step.page) {
    page = step.page;
    renderPage();
    setTimeout(() => runTutorialStep(), 500);
    return;
  }

  // Highlight element
  const element = document.querySelector(step.selector);
  if (element) {
    clearHighlights();
    element.style.border = '3px solid #f59e0b';
    element.style.boxShadow = '0 0 15px rgba(245,158,11,0.6)';
    element.scrollIntoView({ behavior: 'smooth', block: 'center' });

    // Speak translated text
    const tutorialLang = document.getElementById('tutorialLang')?.value || 'en';
    const stepText = step.text[tutorialLang] || step.text.en;

    speak(stepText, () => {
      step.action();
      setTimeout(() => {
        demoStep++;
        runTutorialStep();
      }, 1500); // pacing
    });
  } else {
    demoStep++;
    runTutorialStep();
  }
}

// Clear highlights
function clearHighlights() {
  document.querySelectorAll('*').forEach(el => {
    el.style.border = '';
    el.style.boxShadow = '';
  });
}
// Start Tutorial
function startTutorial() {
  const tutorialLang = document.getElementById('tutorialLang').value;
  const voiceSelect = document.getElementById('voiceSelect').value;

  // Save language
  lang = tutorialLang;
  localStorage.setItem("taskLanguage", lang);

  // Reset state
  isDemoMode = true;
  demoStep = 0;
  page = 1;
  formData = {};

  renderPage();
  document.getElementById("tutorialOverlay").style.display = "none";

  // Intro line
  const introText = voiceData[voiceSelect]?.intro[tutorialLang] 
    || voiceData.Sean.intro.en;

  setTimeout(() => {
    speak(introText, () => {
      setTimeout(() => runTutorialStep(), 800);
    });
  }, 500);
}

// Exit Tutorial (end of walkthrough or user cancels)
function exitTutorial() {
  isDemoMode = false;
  speechSynthesis.cancel();
  clearHighlights();

  // Reset survey to normal
  page = 1;
  formData = {};
  renderPage();
}

// Skip Tutorial (jump straight to survey)
function skipTutorial() {
  const tutorialLang = document.getElementById('tutorialLang').value;
  lang = tutorialLang;
  localStorage.setItem("taskLanguage", lang);

  isDemoMode = false;
  document.getElementById("tutorialOverlay").style.display = "none";
  page = 1;
  formData = {};
  renderPage();
}
function renderPage() {
  const t = translations[lang];
  let html = "";

  // ===== STEP 1: Employment Status =====
  if (page === 1) {
    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step">2</div>
          <div class="step">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${t.stillWorking}</h2>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px;">
        <label class="radio-card">
          <div style="font-weight:bold; color:#145078;">${t.yesEmployed}</div>
          <div style="font-size:13px; color:#16a34a;">${t.yesHelper}</div>
          <input type="radio" name="stillWorking" value="yes"
            ${formData.stillWorking === 'yes' ? 'checked' : ''}
            onchange="toggleEmployment(true)">
        </label>

        <label class="radio-card" style="border-color:#fca5a5;">
          <div style="font-weight:bold; color:#145078;">${t.noEmployed}</div>
          <div style="font-size:13px; color:#dc2626;">${t.noHelper}</div>
          <input type="radio" name="stillWorking" value="no"
            ${formData.stillWorking === 'no' ? 'checked' : ''}
            onchange="toggleEmployment(false)">
        </label>
      </div>

      <div id="continueBtn" style="text-align:right; margin-top:20px; ${formData.stillWorking === 'yes' ? '' : 'display:none;'}">
        <button class="btn" onclick="nextPage()">${t.continue} ‚Üí</button>
      </div>

      <div id="stopMessage" style="color:#dc2626; font-weight:bold; text-align:center; margin-top:20px; ${formData.stillWorking === 'no' ? '' : 'display:none;'}">
        ${t.stopMessage}
      </div>
    `;
  }

  // ===== STEP 2: Contact Info =====
  if (page === 2) {
    const labels = {
      en: {
        title: "Step 2: Contact Information",
        blurb: "We collect your contact info so TASK can stay in touch and provide support.",
        firstName: "First Name *",
        lastName: "Last Name *",
        phone: "Phone Number *",
        email: "Email *",
        preferred: "Preferred Contact Method",
        months: "How many months have you been employed through TASK's job placement program? *",
        options: ["Phone","Email","Text Message"]
      },
      es: {
        title: "Paso 2: Informaci√≥n de Contacto",
        blurb: "Recopilamos tu informaci√≥n de contacto para que TASK pueda mantenerse en contacto y brindarte apoyo.",
        firstName: "Nombre *",
        lastName: "Apellido *",
        phone: "N√∫mero de Tel√©fono *",
        email: "Correo Electr√≥nico *",
        preferred: "M√©todo de Contacto Preferido",
        months: "¬øCu√°ntos meses has estado empleado a trav√©s del programa de colocaci√≥n laboral de TASK? *",
        options: ["Tel√©fono","Correo Electr√≥nico","Mensaje de Texto"]
      },
      ht: {
        title: "Etap 2: Enf√≤masyon Kontak",
        blurb: "Nou kolekte enf√≤masyon kontak ou pou TASK ka rete nan kontak ak ba ou sip√≤.",
        firstName: "Non *",
        lastName: "Siyati *",
        phone: "Nimewo Telef√≤n *",
        email: "Im√®l *",
        preferred: "Met√≤d Kontak ou pi pito",
        months: "Konbyen mwa ou te gen travay nan pwogram travay TASK la? *",
        options: ["Telef√≤n","Im√®l","Mesaj T√®ks"]
      }
    }[lang];

    function buildMonthOptions() {
      let opts = "";
      for (let i = 1; i <= 120; i++) {
        let label;
        if (i < 12) {
          label = `${i} ${lang==='es'?'mes':'month'}${i>1?(lang==='es'?'es':'s'):''}`;
        } else {
          const years = Math.floor(i / 12);
          const rem = i % 12;
          let yearLabel = years + " " + (lang==='es' ? (years>1?"a√±os":"a√±o") : lang==='ht' ? (years>1?"ane":"ane") : (years>1?"years":"year"));
          if (rem > 0) {
            yearLabel += lang==='es'
              ? `, ${rem} mes${rem>1?"es":""}`
              : lang==='ht'
                ? `, ${rem} mwa`
                : `, ${rem} month${rem>1?"s":""}`;
          }
          label = `${i} ${lang==='es'?"meses":lang==='ht'?"mwa":"months"} (${yearLabel})`;
        }
        opts += `<option value="${i}" ${formData.monthsEmployed==i?'selected':''}>${label}</option>`;
      }
      return opts;
    }

    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${labels.title}</h2>
      <p class="blurb">${labels.blurb}</p>

      <div class="grid-2" style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
        <div>
          <label>${labels.firstName}</label>
          <input id="firstName" required value="${formData.firstName || ''}">
        </div>
        <div>
          <label>${labels.lastName}</label>
          <input id="lastName" required value="${formData.lastName || ''}">
        </div>
        <div>
          <label>${labels.phone}</label>
          <input id="phone" type="tel" oninput="formatPhone(this)" required value="${formData.phone || ''}">
        </div>
        <div>
          <label>${labels.email}</label>
          <input id="email" type="email" required value="${formData.email || ''}">
        </div>
      </div>

      <label>${labels.preferred}</label>
      <select id="preferredContact">
        ${labels.options.map(o=>`<option value="${o}" ${formData.preferredContact===o?'selected':''}>${o}</option>`).join("")}
      </select>

      <div class="highlight-box">
        <label style="font-size:18px; font-weight:bold;">${labels.months}</label>
        <select id="monthsEmployed" required>
          <option value="">${lang==='es'?'Seleccionar...':lang==='ht'?'Chwazi...':'Select...'}</option>
          ${buildMonthOptions()}
        </select>
      </div>

      <div style="display:flex; justify-content:space-between;">
        <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
        <button class="btn" onclick="nextPage()">${translations[lang].continue} ‚Üí</button>
      </div>
    `;
  }

  document.getElementById("survey").innerHTML = html;
}
  // ===== STEP 3: Monthly Documentation =====
  if (page === 3) {
    const labels = {
      en: {
        title: "Step 3: Monthly Documentation & Support",
        blurb: "Share your feedback and upload employment verification",
        q1: "What has helped you stay successful in your TASK-assisted job?",
        q1ph: "Supportive management, flexible schedule, good pay...",
        q2: "What ongoing challenges can TASK help you address?",
        q2ph: "Transportation, childcare, housing, financial stress...",
        q3: "How has TASK support made a difference in your employment journey?",
        q3ph: "Job search assistance, interview prep, work clothes...",
        uploadTitle: "Upload Your Last Two Pay Stubs *",
        uploadDesc: "You can upload files or take photos. Please upload both stubs.",
        auth: "Authorization *",
        authList: [
          "Contact me monthly for employment check-ins and support",
          "Provide information about additional resources and services",
          "Connect me with emergency assistance if needed",
          "Follow up if employment status changes"
        ]
      },
      es: {
        title: "Paso 3: Documentaci√≥n Mensual y Apoyo",
        blurb: "Comparte tus comentarios y sube la verificaci√≥n de empleo",
        q1: "¬øQu√© te ha ayudado a mantenerte exitoso en tu trabajo asistido por TASK?",
        q1ph: "Gerencia solidaria, horario flexible, buen pago...",
        q2: "¬øQu√© desaf√≠os continuos puede ayudarte TASK a abordar?",
        q2ph: "Transporte, cuidado infantil, vivienda, estr√©s financiero...",
        q3: "¬øC√≥mo el apoyo de TASK ha marcado la diferencia en tu trayectoria laboral?",
        q3ph: "Asistencia en b√∫squeda de empleo, preparaci√≥n de entrevistas, ropa de trabajo...",
        uploadTitle: "Sube Tus √öltimos Dos Talones de Pago *",
        uploadDesc: "Puedes subir archivos o tomar fotos. Por favor sube ambos talones.",
        auth: "Autorizaci√≥n *",
        authList: [
          "Contactarme mensualmente para verificaciones de empleo y apoyo",
          "Proporcionar informaci√≥n sobre recursos y servicios adicionales",
          "Conectarme con asistencia de emergencia si es necesario",
          "Dar seguimiento si cambia mi estado laboral"
        ]
      },
      ht: {
        title: "Etap 3: Dokiman Chak Mwa ak Sip√≤",
        blurb: "Pataje k√≤mant√® ou yo epi telechaje verifikasyon travay",
        q1: "Kisa ki te ede ou rete siks√® nan travay TASK te ede ou jwenn lan?",
        q1ph: "Jesyon ki sip√≤te, or√® fleksib, bon sal√®...",
        q2: "Ki defi k ap kontinye TASK ka ede w rezoud?",
        q2ph: "Pwobl√®m transp√≤, swen timoun, lojman, estr√®s finansye...",
        q3: "Kijan sip√≤ TASK f√® yon diferans nan vwayaj travay ou?",
        q3ph: "Asistans pou rech√®ch travay, preparasyon ent√®vyou, rad travay...",
        uploadTitle: "Telechaje 2 D√®nye Fich Peman Ou *",
        uploadDesc: "Ou ka telechaje fichye oswa pran foto. Tanpri telechaje tou de.",
        auth: "Otorizasyon *",
        authList: [
          "Kontakte m chak mwa pou verifye travay ak sip√≤",
          "Bay enf√≤masyon sou resous ak s√®vis adisyon√®l",
          "Konekte m ak asistans ijans si sa neses√®",
          "F√® swivi si estati travay chanje"
        ]
      }
    }[lang];

    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step active">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${labels.title}</h2>
      <p class="blurb">${labels.blurb}</p>

      <div class="highlight-box">
        <label>${labels.q1}</label>
        <textarea id="q1" rows="4" placeholder="${labels.q1ph}">${formData.q1 || ''}</textarea>
      </div>

      <div class="highlight-box">
        <label>${labels.q2}</label>
        <textarea id="q2" rows="4" placeholder="${labels.q2ph}">${formData.q2 || ''}</textarea>
      </div>

      <div class="highlight-box">
        <label>${labels.q3}</label>
        <textarea id="q3" rows="4" placeholder="${labels.q3ph}">${formData.q3 || ''}</textarea>
      </div>

      <div class="highlight-box">
        <h3 style="font-size:20px; color:#145078;">${labels.uploadTitle}</h3>
        <p style="font-size:16px; color:#555;">${labels.uploadDesc}</p>

        <div class="upload-box" onclick="document.getElementById('payStubInput').click()">
          <div style="font-size:38px; margin-bottom:10px;">üì∑ üìÅ</div>
          <p>${lang==='es'?'Haz clic para subir o tomar fotos':lang==='ht'?'Klike pou telechaje oswa pran foto':'Click to upload or take photos'}</p>
        </div>
        <input type="file" id="payStubInput" accept=".pdf,image/*" multiple capture="environment" style="display:none;" onchange="previewFile(this,'payStubPreview')">

        <div id="payStubPreview" class="preview" style="margin-top:15px;"></div>
      </div>

      <div class="highlight-box">
        <label style="display:flex; align-items:start; cursor:pointer;">
          <input type="checkbox" id="authorization" style="margin-top:6px; margin-right:12px; transform:scale(1.2); width:auto;">
          <div>
            <span style="font-size:18px; font-weight:bold; color:#145078;">${labels.auth}</span>
            <div style="font-size:14px; margin-top:8px; color:#145078;">
              ${labels.authList.map(item=>`<div>‚Ä¢ ${item}</div>`).join("")}
            </div>
          </div>
        </label>
      </div>

      <div style="display:flex; justify-content:space-between;">
        <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
        <button class="btn" onclick="submitSurvey()">${translations[lang].submit}</button>
      </div>
    `;
  }
  // ===== STEP 4: Success Page =====
  if (page === 4) {
    const labels = {
      en: {
        success: "Monthly Report Submitted Successfully!",
        thanks: "Thank you for your continued commitment to employment success through TASK!",
        office: "TASK Employment Office",
        location: "Trenton Area Soup Kitchen",
        address: "72¬Ω Escher St, Trenton, NJ 08609",
        phoneLabel: "Employment Office",
        phone: "609-697-6215 or 609-697-6166",
        hours: "Meal Time Hours",
        h1: "Mon-Fri: 10:30 AM - 1:00 PM",
        h2: "Mon-Thu: 3:30 PM - 5:00 PM",
        online: "Online",
        website: "trentonsoupkitchen.org",
        reward: "Reward Program",
        rewardText: "Complete monthly surveys and maintain employment to earn gift card rewards! Visit our Employment Office to claim your incentive."
      },
      es: {
        success: "¬°Informe Mensual Enviado Exitosamente!",
        thanks: "¬°Gracias por tu compromiso continuo con el √©xito laboral a trav√©s de TASK!",
        office: "Oficina de Empleo TASK",
        location: "Cocina de Sopa del √Årea de Trenton",
        address: "72¬Ω Escher St, Trenton, NJ 08609",
        phoneLabel: "Oficina de Empleo",
        phone: "609-697-6215 o 609-697-6166",
        hours: "Horario de Comidas",
        h1: "Lun-Vie: 10:30 AM - 1:00 PM",
        h2: "Lun-Jue: 3:30 PM - 5:00 PM",
        online: "En L√≠nea",
        website: "trentonsoupkitchen.org",
        reward: "Programa de Recompensas",
        rewardText: "Completa encuestas mensuales y mant√©n el empleo para ganar tarjetas de regalo. ¬°Visita nuestra oficina para reclamar tu incentivo!"
      },
      ht: {
        success: "Rap√≤ Chak Mwa Soum√®t ak Siks√®!",
        thanks: "M√®si pou angajman kontiny√®l ou ak siks√® travay nan TASK!",
        office: "Biwo Travay TASK",
        location: "Kizin Soup Trenton Area",
        address: "72¬Ω Escher St, Trenton, NJ 08609",
        phoneLabel: "Biwo Travay",
        phone: "609-697-6215 oswa 609-697-6166",
        hours: "Or√® Manje",
        h1: "Lendi-Vandredi: 10:30 AM - 1:00 PM",
        h2: "Lendi-Jedi: 3:30 PM - 5:00 PM",
        online: "Sou Ent√®n√®t",
        website: "trentonsoupkitchen.org",
        reward: "Pwogram Rekonpans",
        rewardText: "Konplete sondaj chak mwa yo epi kenbe travay pou jwenn rekonpans ak kat kado! Vizite Biwo Travay nou pou reklame li."
      }
    }[lang];

    html = `
      <div style="text-align:center;">
        <div style="font-size:80px; margin-bottom:20px;">üéâ</div>
        <h1 style="color:#16a34a;">${labels.success}</h1>
        <p style="font-size:20px; color:#6b7280; margin-bottom:30px;">${labels.thanks}</p>

        <div class="highlight-box" style="text-align:left; background:#f0fdf4; border-color:#86efac;">
          <h2 style="color:#145078; margin-bottom:15px;">${labels.office}</h2>

          <div class="contact-item" style="margin-bottom:10px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:20px;">üìç</span>
            <div>
              <div style="font-weight:bold; font-size:16px;">${labels.location}</div>
              <div style="font-size:14px;">${labels.address}</div>
            </div>
          </div>

          <div class="contact-item" style="margin-bottom:10px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:20px;">üìû</span>
            <div>
              <div style="font-weight:bold;">${labels.phoneLabel}</div>
              <div style="font-size:14px;">${labels.phone}</div>
            </div>
          </div>

          <div class="contact-item" style="margin-bottom:10px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:20px;">üïê</span>
            <div>
              <div style="font-weight:bold;">${labels.hours}</div>
              <div style="font-size:14px;">${labels.h1}</div>
              <div style="font-size:14px;">${labels.h2}</div>
            </div>
          </div>

          <div class="contact-item" style="display:flex; align-items:center; gap:8px;">
            <span style="font-size:20px;">üåê</span>
            <div>
              <div style="font-weight:bold;">${labels.online}</div>
              <div style="font-size:14px;">${labels.website}</div>
            </div>
          </div>
        </div>

        <div class="highlight-box" style="text-align:center; background:#fff7ed; border-color:#fdba74; margin-top:20px;">
          <div style="font-size:22px; font-weight:bold; color:#166534; margin-bottom:10px;">
            üíµ ${labels.reward}
          </div>
          <p style="color:#166534; font-weight:500;">${labels.rewardText}</p>
        </div>
      </div>
    `;
  }

  // finally inject page HTML
  document.getElementById("survey").innerHTML = html;
}
// ===== Helpers =====

// Toggle employment eligibility (Step 1)
function toggleEmployment(isEmployed) {
  formData.stillWorking = isEmployed ? "yes" : "no";
  if (isEmployed) {
    document.getElementById("continueBtn").style.display = "";
    document.getElementById("stopMessage").style.display = "none";
  } else {
    document.getElementById("continueBtn").style.display = "none";
    document.getElementById("stopMessage").style.display = "";
  }
}

// Save form data across pages
function saveFormData() {
  if (page === 2) {
    formData.firstName = document.getElementById("firstName")?.value || "";
    formData.lastName = document.getElementById("lastName")?.value || "";
    formData.phone = document.getElementById("phone")?.value || "";
    formData.email = document.getElementById("email")?.value || "";
    formData.preferredContact = document.getElementById("preferredContact")?.value || "";
    formData.monthsEmployed = document.getElementById("monthsEmployed")?.value || "";
  }
  if (page === 3) {
    formData.q1 = document.getElementById("q1")?.value || "";
    formData.q2 = document.getElementById("q2")?.value || "";
    formData.q3 = document.getElementById("q3")?.value || "";
    formData.authorization = document.getElementById("authorization")?.checked || false;
  }
}

// Validate required fields
function validatePage() {
  const t = translations[lang];

  if (page === 2) {
    const required = ["firstName","lastName","phone","email","monthsEmployed"];
    for (let field of required) {
      const el = document.getElementById(field);
      if (!el?.value.trim()) {
        alert(t.completeRequired);
        el?.focus();
        return false;
      }
    }
  }

  if (page === 3) {
    const payStubFiles = document.getElementById("payStubInput")?.files || [];
    const authChecked = document.getElementById("authorization")?.checked;

    if (payStubFiles.length < 2) {
      alert(lang==="es"
        ? "Por favor sube al menos dos talones de pago."
        : lang==="ht"
          ? "Tanpri telechaje omwen 2 fich peman."
          : "Please upload at least two pay stubs."
      );
      return false;
    }
    if (!authChecked) {
      alert(t.completeRequired);
      return false;
    }
  }
  return true;
}

// Navigation
function nextPage() {
  if (!validatePage()) return;
  saveFormData();
  page++;
  renderPage();
}
function prevPage() {
  saveFormData();
  page--;
  renderPage();
}
// ===== Submit Handler =====
function submitSurvey() {
  if (!validatePage()) return;

  // Prevent resubmissions within 30 days
  const lastSubmission = localStorage.getItem("taskFormSubmitted");
  if (lastSubmission) {
    const daysSince = Math.floor((Date.now() - parseInt(lastSubmission)) / (1000*60*60*24));
    if (daysSince < 30) {
      alert(lang==="es"
        ? "Ya enviaste un informe este mes. Vuelve el pr√≥ximo mes."
        : lang==="ht"
          ? "Ou deja soum√®t yon rap√≤ mwa sa a. Tanpri retounen mwa pwochen."
          : "You already submitted a report this month. Please return next month."
      );
      return;
    }
  }

  saveFormData();
  formData.submissionId = "TASK_" + Date.now();
  formData.timestamp = new Date().toISOString();

  // store submission marker
  localStorage.setItem("taskFormSubmitted", Date.now().toString());
  console.log("Form submitted:", formData);

  page = 4;
  renderPage();
}

// ===== Phone formatting =====
function formatPhone(input) {
  let val = input.value.replace(/\D/g, "");
  if (val.length > 3 && val.length <= 6) {
    input.value = `(${val.slice(0, 3)}) ${val.slice(3)}`;
  } else if (val.length > 6) {
    input.value = `(${val.slice(0, 3)}) ${val.slice(3, 6)}-${val.slice(6, 10)}`;
  } else {
    input.value = val;
  }
}

// ===== File Preview =====
function previewFile(input, previewId) {
  const preview = document.getElementById(previewId);
  preview.innerHTML = "";

  if (input.files.length > 0) {
    const count = document.createElement("p");
    count.textContent = `${input.files.length} file(s) selected`;
    count.style.fontWeight = "bold";
    count.style.color = "#16a34a";
    count.style.marginBottom = "10px";
    preview.appendChild(count);
  }

  Array.from(input.files).forEach(file => {
    if (file.type.startsWith("image/")) {
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement("img");
        img.src = e.target.result;
        preview.appendChild(img);
      };
      reader.readAsDataURL(file);
    } else {
      const div = document.createElement("div");
      div.classList.add("file-name");
      div.textContent = file.name;
      preview.appendChild(div);
    }
  });
}

// ===== Init =====
const savedLang = localStorage.getItem("taskLanguage");
if (savedLang && translations[savedLang]) {
  lang = savedLang;
}
renderPage();
</script>
</body>
</html>
