<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TASK Monthly Employment Check-In</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }
    .header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .lang-select { display: flex; align-items: center; gap: 10px; }
    .progress { display: flex; justify-content: space-between; flex: 1; margin-left: 30px; }
    .step {
      width: 50px; height: 50px; border-radius: 50%;
      background: #ccc; color: white; display: flex;
      align-items: center; justify-content: center;
      font-weight: bold; font-size: 18px;
    }
    .step.active { background: #145078; }
    h1,h2 { color:#145078; text-align:center; }
    h1{ font-size:2.3em; } h2{ font-size:1.9em; margin-bottom:10px; }

    label { font-weight:bold; display:block; margin:12px 0 6px; color:#333; }
    input, select, textarea {
      width:100%; padding:14px 16px; border:2px solid #d1d5db;
      border-radius:14px; font-size:16px; margin-bottom:18px;
      box-sizing:border-box; transition:all 0.2s ease;
    }
    input:focus,select:focus,textarea:focus {
      border-color:#33a7b5; box-shadow:0 0 6px rgba(51,167,181,0.4);
      outline:none;
    }
    textarea { min-height:100px; resize:vertical; border-radius:14px; }

    .btn {
      padding:14px 26px; border:none; border-radius:14px;
      font-weight:bold; cursor:pointer; margin:10px 5px 0 0;
      background:linear-gradient(135deg,#145078,#33a7b5); color:white;
      transition:all 0.2s ease;
    }
    .btn:hover { transform:translateY(-2px); box-shadow:0 4px 10px rgba(0,0,0,0.2); }

    .highlight-box { border:2px solid #facc15; border-radius:14px; padding:20px; margin:20px 0; background:#fefce8; }

    .radio-card {
      border:2px solid #d1d5db; border-radius:14px; padding:20px;
      text-align:center; cursor:pointer; background:#fafafa; transition:all 0.2s ease;
    }
    .radio-card:hover { background:#f1f5f9; }
    .radio-card input { margin-top:12px; transform:scale(1.3); }

    .upload-box {
      border:2px dashed #93c5fd; border-radius:14px;
      padding:25px; text-align:center; cursor:pointer; background:#f9fafb;
    }
    .upload-box:hover { background:#eff6ff; }
    .preview img { max-width:140px; margin:6px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.15); }
    .preview div.file-name { background:#f3f4f6; border:1px solid #d1d5db; border-radius:6px; padding:8px; margin:5px; font-size:14px; }

    /* Tutorial overlay */
    #tutorialOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #tutorialContent {
      background: white;
      padding: 30px;
      border-radius: 18px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0,0,0,0.25);
    }
    #tutorialContent h1 { margin-bottom: 20px; }
    #tutorialContent select {
      margin: 10px 0 20px;
      padding: 10px;
      border-radius: 10px;
      border: 2px solid #ccc;
      width: 100%;
    }
    .tutorial-btn {
      padding: 14px 22px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px;
    }
    .tutorial-primary { background:#2563eb; color:white; }
    .tutorial-secondary { background:#6b7280; color:white; }
    .tutorial-test { background:#facc15; color:#000; margin-bottom:20px; }
  </style>
</head>
<body>
  <!-- Tutorial Overlay -->
  <div id="tutorialOverlay">
    <div id="tutorialContent">
      <h1>üëã Welcome to the Guided Tutorial</h1>
      <p>Select a tutorial language and guide voice below:</p>

      <h3>Choose Language</h3>
      <select id="tutorialLang">
        <option value="en">English</option>
        <option value="es">Espa√±ol</option>
        <option value="ht">Krey√≤l</option>
      </select>

      <h3>Choose Your Guide</h3>
      <select id="voiceSelect">
        <option value="Sean">Sean - Calm & Supportive</option>
        <option value="Diani">Diani - Bright & Encouraging</option>
        <option value="Marcus">Marcus - Clear & Professional</option>
      </select>

      <button class="tutorial-btn tutorial-test" onclick="testVoice()">üîä TEST THIS VOICE</button><br>
      <button class="tutorial-btn tutorial-primary" onclick="startTutorial()">‚ñ∂Ô∏è Start Tutorial</button>
      <button class="tutorial-btn tutorial-secondary" onclick="skipTutorial()">‚è≠ Skip Tutorial</button>
    </div>
  </div>

  <!-- Survey Container -->
  <div class="container">
    <div id="survey"></div>
  </div>
<script>
let page = 1;
let formData = {};
let lang = "en";

// Track tutorial state
let isDemoMode = false;
let demoStep = 0;

// ===== Translations =====
const translations = {
  en: {
    continue: "Continue",
    back: "Back",
    submit: "Submit Monthly Report",
    stillWorking: "Are you still employed at this TASK-assisted job? *",
    yesEmployed: "Yes, still employed",
    noEmployed: "No longer employed",
    yesHelper: "Great job maintaining employment",
    noHelper: "We are here to help you find another job",
    completeRequired: "Please complete all required fields before continuing.",
    stopMessage: "You are no longer eligible to complete this survey. Please contact TASK."
  },
  es: {
    continue: "Continuar",
    back: "Atr√°s",
    submit: "Enviar Informe Mensual",
    stillWorking: "¬øSigues empleado en este trabajo asistido por TASK? *",
    yesEmployed: "S√≠, sigo empleado",
    noEmployed: "Ya no estoy empleado",
    yesHelper: "¬°Excelente trabajo manteniendo el empleo!",
    noHelper: "Estamos aqu√≠ para ayudarte a encontrar otro trabajo",
    completeRequired: "Por favor completa todos los campos requeridos antes de continuar.",
    stopMessage: "Ya no eres elegible para completar esta encuesta. Por favor contacta a TASK."
  },
  ht: {
    continue: "Kontinye",
    back: "Retounen",
    submit: "Soum√®t Rap√≤ Chak Mwa",
    stillWorking: "√àske w ap toujou travay nan travay TASK te ede w jwenn lan? *",
    yesEmployed: "Wi, toujou ap travay",
    noEmployed: "Mwen pa travay ank√≤",
    yesHelper: "Bon travay kenbe travay la!",
    noHelper: "Nou la pou ede ou jwenn yon l√≤t travay",
    completeRequired: "Tanpri ranpli tout chan obligatwa yo anvan ou kontinye.",
    stopMessage: "Ou pa elijib pou konplete sondaj sa ank√≤. Tanpri kontakte TASK."
  }
};

// ===== Voice Data =====
const voiceData = {
  Sean: {
    intro: {
      en: "Hi, I‚Äôm Sean. I‚Äôll guide you through filling out this survey step by step.",
      es: "Hola, soy Sean. Te guiar√© paso a paso para completar esta encuesta.",
      ht: "Bonjou, mwen se Sean. M ap gide ou etap pa etap pou ranpli sondaj sa a."
    }
  },
  Diani: {
    intro: {
      en: "Hello, I‚Äôm Diani. Let‚Äôs walk through this survey together.",
      es: "Hola, soy Diani. Vamos a recorrer esta encuesta juntos.",
      ht: "Bonjou, mwen se Diani. Ann pase ansanm nan sondaj sa a."
    }
  },
  Marcus: {
    intro: {
      en: "Greetings, I‚Äôm Marcus. I‚Äôll explain how to complete this survey clearly.",
      es: "Saludos, soy Marcus. Te explicar√© claramente c√≥mo completar esta encuesta.",
      ht: "Bonjou, mwen se Marcus. M ap eksplike w kl√®man kijan pou ranpli sondaj sa a."
    }
  }
};

// ===== Voice Functions =====
function speak(text, cb) {
  speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = lang === "es" ? "es-ES" : lang === "ht" ? "ht-HT" : "en-US";
  utter.onend = () => { if (cb) cb(); };
  speechSynthesis.speak(utter);
}

function testVoice() {
  const tutorialLang = document.getElementById("tutorialLang").value;
  const voiceSelect = document.getElementById("voiceSelect").value;
  const sample = voiceData[voiceSelect]?.intro[tutorialLang] || "This is a test voice sample.";
  speak(sample);
}

// ===== Tutorial Flow =====
function startTutorial() {
  const tutorialLang = document.getElementById('tutorialLang').value;
  const voiceSelect = document.getElementById('voiceSelect').value;

  // Save language
  lang = tutorialLang;
  localStorage.setItem("taskLanguage", lang);

  // Reset state
  isDemoMode = true;
  demoStep = 0;
  page = 1;
  formData = {};

  renderPage();
  document.getElementById("tutorialOverlay").style.display = "none";

  // Intro line
  const introText = voiceData[voiceSelect]?.intro[tutorialLang] 
    || voiceData.Sean.intro.en;

  setTimeout(() => {
    speak(introText, () => {
      setTimeout(() => runTutorialStep(), 800);
    });
  }, 500);
}

function skipTutorial() {
  const tutorialLang = document.getElementById('tutorialLang').value;
  lang = tutorialLang;
  localStorage.setItem("taskLanguage", lang);

  isDemoMode = false;
  document.getElementById("tutorialOverlay").style.display = "none";
  page = 1;
  formData = {};
  renderPage();
}

function exitTutorial() {
  isDemoMode = false;
  speechSynthesis.cancel();
  clearHighlights();
  page = 1;
  formData = {};
  renderPage();
}

// highlight utility
function highlightElement(selector) {
  clearHighlights();
  const el = document.querySelector(selector);
  if (el) {
    el.style.boxShadow = "0 0 12px 4px rgba(250,204,21,0.9)";
    el.style.transition = "box-shadow 0.3s ease";
  }
}
function clearHighlights() {
  document.querySelectorAll("*").forEach(el => {
    el.style.boxShadow = "";
  });
}

// tutorial steps engine
function runTutorialStep() {
  if (!isDemoMode) return;
  demoStep++;

  if (demoStep === 1) {
    highlightElement("input, select, textarea");
    speak("This is where you‚Äôll enter information, like your contact details or feedback.", () => {
      setTimeout(runTutorialStep, 1200);
    });
  }
  else if (demoStep === 2) {
    highlightElement(".btn");
    speak("These buttons help you continue, go back, or submit your report.", () => {
      setTimeout(runTutorialStep, 1200);
    });
  }
  else if (demoStep === 3) {
    highlightElement(".upload-box");
    speak("Here you‚Äôll upload your pay stubs to verify employment.", () => {
      setTimeout(runTutorialStep, 1200);
    });
  }
  else {
    clearHighlights();
    speak("That‚Äôs the end of the tutorial. You can now complete the survey on your own.", () => {
      exitTutorial();
    });
  }
}
function renderPage() {
  const t = translations[lang];
  let html = "";

  // ===== STEP 1: Employment Status =====
  if (page === 1) {
    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step">2</div>
          <div class="step">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${t.stillWorking}</h2>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px;">
        <label class="radio-card">
          <div style="font-weight:bold; color:#145078;">${t.yesEmployed}</div>
          <div style="font-size:13px; color:#16a34a;">${t.yesHelper}</div>
          <input type="radio" name="stillWorking" value="yes"
            ${formData.stillWorking === 'yes' ? 'checked' : ''}
            onchange="toggleEmployment(true)">
        </label>

        <label class="radio-card" style="border-color:#fca5a5;">
          <div style="font-weight:bold; color:#145078;">${t.noEmployed}</div>
          <div style="font-size:13px; color:#dc2626;">${t.noHelper}</div>
          <input type="radio" name="stillWorking" value="no"
            ${formData.stillWorking === 'no' ? 'checked' : ''}
            onchange="toggleEmployment(false)">
        </label>
      </div>

      <div id="continueBtn" style="text-align:right; margin-top:20px; ${formData.stillWorking === 'yes' ? '' : 'display:none;'}">
        <button class="btn" onclick="nextPage()">${t.continue} ‚Üí</button>
      </div>

      <div id="stopMessage" style="color:#dc2626; font-weight:bold; text-align:center; margin-top:20px; ${formData.stillWorking === 'no' ? '' : 'display:none;'}">
        ${t.stopMessage}
      </div>
    `;
  }

  // ===== STEP 2: Contact Info =====
  if (page === 2) {
    const labels = {
      en: {
        title: "Step 2: Contact Information",
        blurb: "We collect your contact info so TASK can stay in touch and provide support.",
        firstName: "First Name *",
        lastName: "Last Name *",
        phone: "Phone Number *",
        email: "Email *",
        preferred: "Preferred Contact Method",
        months: "How many months have you been employed through TASK's job placement program? *",
        options: ["Phone","Email","Text Message"]
      },
      es: {
        title: "Paso 2: Informaci√≥n de Contacto",
        blurb: "Recopilamos tu informaci√≥n de contacto para que TASK pueda mantenerse en contacto y brindarte apoyo.",
        firstName: "Nombre *",
        lastName: "Apellido *",
        phone: "N√∫mero de Tel√©fono *",
        email: "Correo Electr√≥nico *",
        preferred: "M√©todo de Contacto Preferido",
        months: "¬øCu√°ntos meses has estado empleado a trav√©s del programa de colocaci√≥n laboral de TASK? *",
        options: ["Tel√©fono","Correo Electr√≥nico","Mensaje de Texto"]
      },
      ht: {
        title: "Etap 2: Enf√≤masyon Kontak",
        blurb: "Nou kolekte enf√≤masyon kontak ou pou TASK ka rete nan kontak ak ba ou sip√≤.",
        firstName: "Non *",
        lastName: "Siyati *",
        phone: "Nimewo Telef√≤n *",
        email: "Im√®l *",
        preferred: "Met√≤d Kontak ou pi pito",
        months: "Konbyen mwa ou te gen travay nan pwogram travay TASK la? *",
        options: ["Telef√≤n","Im√®l","Mesaj T√®ks"]
      }
    }[lang];

    function buildMonthOptions() {
      let opts = "";
      for (let i = 1; i <= 120; i++) {
        let label;
        if (i < 12) {
          label = `${i} ${lang==='es'?'mes':'month'}${i>1?(lang==='es'?'es':'s'):''}`;
        } else {
          const years = Math.floor(i / 12);
          const rem = i % 12;
          let yearLabel = years + " " + (lang==='es' ? (years>1?"a√±os":"a√±o") : lang==='ht' ? (years>1?"ane":"ane") : (years>1?"years":"year"));
          if (rem > 0) {
            yearLabel += lang==='es'
              ? `, ${rem} mes${rem>1?"es":""}`
              : lang==='ht'
                ? `, ${rem} mwa`
                : `, ${rem} month${rem>1?"s":""}`;
          }
          label = `${i} ${lang==='es'?"meses":lang==='ht'?"mwa":"months"} (${yearLabel})`;
        }
        opts += `<option value="${i}" ${formData.monthsEmployed==i?'selected':''}>${label}</option>`;
      }
      return opts;
    }

    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${labels.title}</h2>
      <p class="blurb">${labels.blurb}</p>

      <div class="grid-2" style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
        <div>
          <label>${labels.firstName}</label>
          <input id="firstName" required value="${formData.firstName || ''}">
        </div>
        <div>
          <label>${labels.lastName}</label>
          <input id="lastName" required value="${formData.lastName || ''}">
        </div>
        <div>
          <label>${labels.phone}</label>
          <input id="phone" type="tel" oninput="formatPhone(this)" required value="${formData.phone || ''}">
        </div>
        <div>
          <label>${labels.email}</label>
          <input id="email" type="email" required value="${formData.email || ''}">
        </div>
      </div>

      <label>${labels.preferred}</label>
      <select id="preferredContact">
        ${labels.options.map(o=>`<option value="${o}" ${formData.preferredContact===o?'selected':''}>${o}</option>`).join("")}
      </select>

      <div class="highlight-box">
        <label style="font-size:18px; font-weight:bold;">${labels.months}</label>
        <select id="monthsEmployed" required>
          <option value="">${lang==='es'?'Seleccionar...':lang==='ht'?'Chwazi...':'Select...'}</option>
          ${buildMonthOptions()}
        </select>
      </div>

      <div style="display:flex; justify-content:space-between;">
        <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
        <button class="btn" onclick="nextPage()">${translations[lang].continue} ‚Üí</button>
      </div>
    `;
  }

  document.getElementById("survey").innerHTML = html;
}
  // ===== STEP 3: Monthly Documentation =====
  if (page === 3) {
    const labels = {
      en: {
        title: "Step 3: Monthly Documentation & Support",
        blurb: "Share your feedback and upload employment verification",
        q1: "What has helped you stay successful in your TASK-assisted job?",
        q1ph: "Supportive management, flexible schedule, good pay...",
        q2: "What ongoing challenges can TASK help you address?",
        q2ph: "Transportation, childcare, housing, financial stress...",
        q3: "How has TASK support made a difference in your employment journey?",
        q3ph: "Job search assistance, interview prep, work clothes...",
        uploadTitle: "Upload Your Last Two Pay Stubs *",
        uploadDesc: "You can upload files or take photos. Please upload both stubs.",
        auth: "Authorization *",
        authList: [
          "Contact me monthly for employment check-ins and support",
          "Provide information about additional resources and services",
          "Connect me with emergency assistance if needed",
          "Follow up if employment status changes"
        ]
      },
      es: {
        title: "Paso 3: Documentaci√≥n Mensual y Apoyo",
        blurb: "Comparte tus comentarios y sube la verificaci√≥n de empleo",
        q1: "¬øQu√© te ha ayudado a mantenerte exitoso en tu trabajo asistido por TASK?",
        q1ph: "Gerencia solidaria, horario flexible, buen pago...",
        q2: "¬øQu√© desaf√≠os continuos puede ayudarte TASK a abordar?",
        q2ph: "Transporte, cuidado infantil, vivienda, estr√©s financiero...",
        q3: "¬øC√≥mo el apoyo de TASK ha marcado la diferencia en tu trayectoria laboral?",
        q3ph: "Asistencia en b√∫squeda de empleo, preparaci√≥n de entrevistas, ropa de trabajo...",
        uploadTitle: "Sube Tus √öltimos Dos Talones de Pago *",
        uploadDesc: "Puedes subir archivos o tomar fotos. Por favor sube ambos talones.",
        auth: "Autorizaci√≥n *",
        authList: [
          "Contactarme mensualmente para verificaciones de empleo y apoyo",
          "Proporcionar informaci√≥n sobre recursos y servicios adicionales",
          "Conectarme con asistencia de emergencia si es necesario",
          "Dar seguimiento si cambia mi estado laboral"
        ]
      },
      ht: {
        title: "Etap 3: Dokiman Chak Mwa ak Sip√≤",
        blurb: "Pataje k√≤mant√® ou yo epi telechaje verifikasyon travay",
        q1: "Kisa ki te ede ou rete siks√® nan travay TASK te ede ou jwenn lan?",
        q1ph: "Jesyon ki sip√≤te, or√® fleksib, bon sal√®...",
        q2: "Ki defi k ap kontinye TASK ka ede w rezoud?",
        q2ph: "Pwobl√®m transp√≤, swen timoun, lojman, estr√®s finansye...",
        q3: "Kijan sip√≤ TASK f√® yon diferans nan vwayaj travay ou?",
        q3ph: "Asistans pou rech√®ch travay, preparasyon ent√®vyou, rad travay...",
        uploadTitle: "Telechaje 2 D√®nye Fich Peman Ou *",
        uploadDesc: "Ou ka telechaje fichye oswa pran foto. Tanpri telechaje tou de.",
        auth: "Otorizasyon *",
        authList: [
          "Kontakte m chak mwa pou verifye travay ak sip√≤",
          "Bay enf√≤masyon sou resous ak s√®vis adisyon√®l",
          "Konekte m ak asistans ijans si sa neses√®",
          "F√® swivi si estati travay chanje"
        ]
      }
    }[lang];

    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step active">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${labels.title}</h2>
      <p class="blurb">${labels.blurb}</p>

      <div class="highlight-box">
        <label>${labels.q1}</label>
        <textarea id="q1" rows="4" placeholder="${labels.q1ph}">${formData.q1 || ''}</textarea>
      </div>

      <div class="highlight-box">
        <label>${labels.q2}</label>
        <textarea id="q2" rows="4" placeholder="${labels.q2ph}">${formData.q2 || ''}</textarea>
      </div>

      <div class="highlight-box">
        <label>${labels.q3}</label>
        <textarea id="q3" rows="4" placeholder="${labels.q3ph}">${formData.q3 || ''}</textarea>
      </div>

      <div class="highlight-box">
        <h3 style="font-size:20px; color:#145078;">${labels.uploadTitle}</h3>
        <p style="font-size:16px; color:#555;">${labels.uploadDesc}</p>

        <div class="upload-box" onclick="document.getElementById('payStubInput').click()">
          <div style="font-size:38px; margin-bottom:10px;">üì∑ üìÅ</div>
          <p>${lang==='es'?'Haz clic para subir o tomar fotos':lang==='ht'?'Klike pou telechaje oswa pran foto':'Click to upload or take photos'}</p>
        </div>
        <input type="file" id="payStubInput" accept=".pdf,image/*" multiple capture="environment" style="display:none;" onchange="previewFile(this,'payStubPreview')">

        <div id="payStubPreview" class="preview" style="margin-top:15px;"></div>
      </div>

      <div class="highlight-box">
        <label style="display:flex; align-items:start; cursor:pointer;">
          <input type="checkbox" id="authorization" style="margin-top:6px; margin-right:12px; transform:scale(1.2); width:auto;">
          <div>
            <span style="font-size:18px; font-weight:bold; color:#145078;">${labels.auth}</span>
            <div style="font-size:14px; margin-top:8px; color:#145078;">
              ${labels.authList.map(item=>`<div>‚Ä¢ ${item}</div>`).join("")}
            </div>
          </div>
        </label>
      </div>

      <div style="display:flex; justify-content:space-between;">
        <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
        <button class="btn" onclick="submitSurvey()">${translations[lang].submit}</button>
      </div>
    `;
  }
  // ===== STEP 4: Success Page =====
  if (page === 4) {
    const labels = {
      en: {
        success: "Monthly Report Submitted Successfully!",
        thanks: "Thank you for your continued commitment to employment success through TASK!",
        office: "TASK Employment Office",
        location: "Trenton Area Soup Kitchen",
        address: "72¬Ω Escher St, Trenton, NJ 08609",
        phoneLabel: "Employment Office",
        phone: "609-697-6215 or 609-697-6166",
        hours: "Meal Time Hours",
        h1: "Mon-Fri: 10:30 AM - 1:00 PM",
        h2: "Mon-Thu: 3:30 PM - 5:00 PM",
        online: "Online",
        website: "trentonsoupkitchen.org",
        reward: "Reward Program",
        rewardText: "Complete monthly surveys and maintain employment to earn gift card rewards! Visit our Employment Office to claim your incentive."
      },
      es: {
        success: "¬°Informe Mensual Enviado Exitosamente!",
        thanks: "¬°Gracias por tu compromiso continuo con el √©xito laboral a trav√©s de TASK!",
        office: "Oficina de Empleo TASK",
        location: "Cocina de Sopa del √Årea de Trenton",
        address: "72¬Ω Escher St, Trenton, NJ 08609",
        phoneLabel: "Oficina de Empleo",
        phone: "609-697-6215 o 609-697-6166",
        hours: "Horario de Comidas",
        h1: "Lun-Vie: 10:30 AM - 1:00 PM",
        h2: "Lun-Jue: 3:30 PM - 5:00 PM",
        online: "En L√≠nea",
        website: "trentonsoupkitchen.org",
        reward: "Programa de Recompensas",
        rewardText: "Completa encuestas mensuales y mant√©n el empleo para ganar tarjetas de regalo. ¬°Visita nuestra oficina para reclamar tu incentivo!"
      },
      ht: {
        success: "Rap√≤ Chak Mwa Soum√®t ak Siks√®!",
        thanks: "M√®si pou angajman kontiny√®l ou ak siks√® travay nan TASK!",
        office: "Biwo Travay TASK",
        location: "Kizin Soup Trenton Area",
        address: "72¬Ω Escher St, Trenton, NJ 08609",
        phoneLabel: "Biwo Travay",
        phone: "609-697-6215 oswa 609-697-6166",
        hours: "Or√® Manje",
        h1: "Lendi-Vandredi: 10:30 AM - 1:00 PM",
        h2: "Lendi-Jedi: 3:30 PM - 5:00 PM",
        online: "Sou Ent√®n√®t",
        website: "trentonsoupkitchen.org",
        reward: "Pwogram Rekonpans",
        rewardText: "Konplete sondaj chak mwa yo epi kenbe travay pou jwenn rekonpans ak kat kado! Vizite Biwo Travay nou pou reklame li."
      }
    }[lang];

    html = `
      <div style="text-align:center;">
        <div style="font-size:80px; margin-bottom:20px;">üéâ</div>
        <h1 style="color:#16a34a;">${labels.success}</h1>
        <p style="font-size:20px; color:#6b7280; margin-bottom:30px;">${labels.thanks}</p>

        <div class="highlight-box" style="text-align:left; background:#f0fdf4; border-color:#86efac;">
          <h2 style="color:#145078; margin-bottom:15px;">${labels.office}</h2>

          <div class="contact-item" style="margin-bottom:10px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:20px;">üìç</span>
            <div>
              <div style="font-weight:bold; font-size:16px;">${labels.location}</div>
              <div style="font-size:14px;">${labels.address}</div>
            </div>
          </div>

          <div class="contact-item" style="margin-bottom:10px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:20px;">üìû</span>
            <div>
              <div style="font-weight:bold;">${labels.phoneLabel}</div>
              <div style="font-size:14px;">${labels.phone}</div>
            </div>
          </div>

          <div class="contact-item" style="margin-bottom:10px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:20px;">üïê</span>
            <div>
              <div style="font-weight:bold;">${labels.hours}</div>
              <div style="font-size:14px;">${labels.h1}</div>
              <div style="font-size:14px;">${labels.h2}</div>
            </div>
          </div>

          <div class="contact-item" style="display:flex; align-items:center; gap:8px;">
            <span style="font-size:20px;">üåê</span>
            <div>
              <div style="font-weight:bold;">${labels.online}</div>
              <div style="font-size:14px;">${labels.website}</div>
            </div>
          </div>
        </div>

        <div class="highlight-box" style="text-align:center; background:#fff7ed; border-color:#fdba74; margin-top:20px;">
          <div style="font-size:22px; font-weight:bold; color:#166534; margin-bottom:10px;">
            üíµ ${labels.reward}
          </div>
          <p style="color:#166534; font-weight:500;">${labels.rewardText}</p>
        </div>
      </div>
    `;
  }

  // Inject into survey container
  document.getElementById("survey").innerHTML = html;
}
// ===== Language Setter =====
function setLanguage(newLang) {
  lang = newLang;
  localStorage.setItem("taskLanguage", lang);
  renderPage();
}

// ===== Employment Toggle =====
function toggleEmployment(isEmployed) {
  formData.stillWorking = isEmployed ? "yes" : "no";
  if (isEmployed) {
    document.getElementById("continueBtn").style.display = "block";
    document.getElementById("stopMessage").style.display = "none";
  } else {
    document.getElementById("continueBtn").style.display = "none";
    document.getElementById("stopMessage").style.display = "block";
  }
}

// ===== Save Current Step Data =====
function saveFormData() {
  if (page === 2) {
    formData.firstName = document.getElementById("firstName").value.trim();
    formData.lastName = document.getElementById("lastName").value.trim();
    formData.phone = document.getElementById("phone").value.trim();
    formData.email = document.getElementById("email").value.trim();
    formData.preferredContact = document.getElementById("preferredContact").value;
    formData.monthsEmployed = document.getElementById("monthsEmployed").value;
  }
  if (page === 3) {
    formData.q1 = document.getElementById("q1").value.trim();
    formData.q2 = document.getElementById("q2").value.trim();
    formData.q3 = document.getElementById("q3").value.trim();
    formData.authorization = document.getElementById("authorization").checked;
    const fileInput = document.getElementById("payStubInput");
    formData.payStubs = fileInput.files ? Array.from(fileInput.files).map(f=>f.name) : [];
  }
}

// ===== Validation =====
function validatePage() {
  const t = translations[lang];
  if (page === 1 && !formData.stillWorking) {
    alert(t.completeRequired);
    return false;
  }
  if (page === 2) {
    if (!document.getElementById("firstName").value.trim()
        || !document.getElementById("lastName").value.trim()
        || !document.getElementById("phone").value.trim()
        || !document.getElementById("email").value.trim()
        || !document.getElementById("monthsEmployed").value) {
      alert(t.completeRequired);
      return false;
    }
  }
  if (page === 3) {
    if (!document.getElementById("authorization").checked) {
      alert(t.completeRequired);
      return false;
    }
    const files = document.getElementById("payStubInput").files;
    if (!files || files.length < 2) {
      alert(lang==="es"
        ? "Por favor sube dos talones de pago"
        : lang==="ht"
          ? "Tanpri telechaje de fich peman"
          : "Please upload two pay stubs"
      );
      return false;
    }
  }
  return true;
}

// ===== Navigation =====
function nextPage() {
  if (!validatePage()) return;
  saveFormData();
  page++;
  renderPage();
}
function prevPage() {
  if (page > 1) {
    page--;
    renderPage();
  }
}
// ===== Submit Survey =====
function submitSurvey() {
  if (!validatePage()) return;

  // Prevent resubmission within 30 days
  const lastSubmission = localStorage.getItem("taskFormSubmitted");
  if (lastSubmission) {
    const daysSince = Math.floor((Date.now() - parseInt(lastSubmission)) / (1000*60*60*24));
    if (daysSince < 30) {
      alert(lang==="es"
        ? "Ya enviaste un informe este mes. Vuelve el pr√≥ximo mes."
        : lang==="ht"
          ? "Ou deja soum√®t yon rap√≤ mwa sa a. Tanpri retounen pwochen mwa."
          : "You already submitted a report this month. Please return next month."
      );
      return;
    }
  }

  saveFormData();
  formData.submissionId = "TASK_" + Date.now();
  formData.timestamp = new Date().toISOString();

  localStorage.setItem("taskFormSubmitted", Date.now().toString());
  console.log("Form submitted:", formData);

  page = 4;
  renderPage();
}

// ===== Phone Formatting =====
function formatPhone(input) {
  let val = input.value.replace(/\D/g, "");
  if (val.length > 3 && val.length <= 6) {
    input.value = `(${val.slice(0, 3)}) ${val.slice(3)}`;
  } else if (val.length > 6) {
    input.value = `(${val.slice(0, 3)}) ${val.slice(3, 6)}-${val.slice(6, 10)}`;
  } else {
    input.value = val;
  }
}

// ===== File Preview =====
function previewFile(input, previewId) {
  const preview = document.getElementById(previewId);
  preview.innerHTML = "";

  if (input.files.length > 0) {
    const count = document.createElement("p");
    count.textContent = `${input.files.length} file(s) selected`;
    count.style.fontWeight = "bold";
    count.style.color = "#16a34a";
    count.style.marginBottom = "10px";
    preview.appendChild(count);
  }

  Array.from(input.files).forEach(file => {
    if (file.type.startsWith("image/")) {
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement("img");
        img.src = e.target.result;
        img.style.maxWidth = "140px";
        img.style.margin = "6px";
        img.style.borderRadius = "10px";
        img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.15)";
        preview.appendChild(img);
      };
      reader.readAsDataURL(file);
    } else {
      const div = document.createElement("div");
      div.classList.add("file-name");
      div.textContent = file.name;
      div.style.background = "#f3f4f6";
      div.style.border = "1px solid #d1d5db";
      div.style.borderRadius = "6px";
      div.style.padding = "8px";
      div.style.margin = "5px";
      div.style.fontSize = "14px";
      preview.appendChild(div);
    }
  });
}

// ===== Initialization =====
document.addEventListener("DOMContentLoaded", () => {
  const savedLang = localStorage.getItem("taskLanguage");
  if (savedLang && translations[savedLang]) {
    lang = savedLang;
  }
  renderPage();
});
</script>
</body>
</html>
