<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TASK Monthly Employment Check-In</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: #111827;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }
    h1,h2,h3 {
      color:#145078;
      text-align:center;
    }
    h1{ font-size:2.3em; } 
    h2{ font-size:1.9em; margin-bottom:10px; }
    h3{ font-size:1.5em; margin:14px 0; }
    label {
      font-weight:bold; display:block; margin:12px 0 6px; color:#333;
    }
    input, select, textarea {
      width:100%; padding:14px 16px; border:2px solid #d1d5db;
      border-radius:14px; font-size:16px; margin-bottom:18px;
      box-sizing:border-box; transition:all 0.2s ease;
    }
    input:focus,select:focus,textarea:focus {
      border-color:#33a7b5; box-shadow:0 0 6px rgba(51,167,181,0.4);
      outline:none;
    }
    textarea { min-height:100px; resize:vertical; border-radius:14px; }
    .btn {
      padding:14px 26px;
      border:none;
      border-radius:14px;
      font-weight:bold;
      cursor:pointer;
      margin:10px 5px 0 0;
      background:linear-gradient(135deg,#145078,#33a7b5);
      color:white;
      transition:all 0.2s ease;
    }
    .btn:hover {
      transform:translateY(-2px);
      box-shadow:0 4px 10px rgba(0,0,0,0.2);
    }
    .btn.secondary {
      background:#6b7280;
    }
    .highlight-box {
      border:2px solid #facc15; /* Yellow border */
      border-radius:14px;
      padding:20px;
      margin:20px 0;
      background:#fefce8;
    }
    .radio-card {
      border:2px solid #d1d5db;
      border-radius:14px;
      padding:20px;
      text-align:center;
      cursor:pointer;
      background:#fafafa;
      transition:all 0.2s ease;
    }
    .radio-card:hover { background:#f1f5f9; }
    .radio-card input {
      margin-top:12px;
      transform:scale(1.3);
    }
    .upload-box {
      border:2px dashed #93c5fd;
      border-radius:14px;
      padding:25px;
      text-align:center;
      cursor:pointer;
      background:#f9fafb;
    }
    .upload-box:hover { background:#eff6ff; }
    .preview img {
      max-width:140px;
      margin:6px;
      border-radius:10px;
      box-shadow:0 2px 6px rgba(0,0,0,0.15);
    }
    .preview div.file-name {
      background:#f3f4f6;
      border:1px solid #d1d5db;
      border-radius:6px;
      padding:8px;
      margin:5px;
      font-size:14px;
    }
    .header-bar {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:20px;
    }
    .lang-select { display:flex; align-items:center; gap:10px; }
    .progress { display:flex; justify-content:space-between; flex:1; margin-left:30px; }
    .step {
      width:50px; height:50px; border-radius:50%;
      background:#ccc; color:white; display:flex;
      align-items:center; justify-content:center;
      font-weight:bold; font-size:18px;
    }
    .step.active { background:#145078; }
    /* Tutorial overlay */
    .tutorial-overlay {
      position:fixed;
      top:0; left:0;
      width:100vw; height:100vh;
      background:rgba(0,0,0,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:1000;
      padding:10px;
      box-sizing:border-box;
    }
    .tutorial-content {
      background:white;
      border-radius:20px;
      width:100%;
      max-width:500px;
      max-height:95vh;
      overflow-y:auto;
      padding:25px;
      text-align:center;
      box-sizing:border-box;
    }
    .section {
      margin:15px 0;
      padding:15px;
      border-radius:12px;
      border:2px solid #e2e8f0;
    }
    .language-section {
      background:#fef3c7;
      border-color:#f59e0b;
    }
    .voice-section {
      background:#e0f2fe;
      border-color:#0284c7;
    }
    .voice-test-btn {
      width:100%;
      padding:10px;
      background:#16a34a;
      color:white;
      border:none;
      border-radius:8px;
      font-size:14px;
      font-weight:bold;
      cursor:pointer;
      margin-top:8px;
    }
    .voice-test-btn.playing {
      background:#dc2626;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="survey">
      <h2 style="color:#145078; text-align:center;">Loading TASK Survey...</h2>
    </div>
  </div>
  <!-- Tutorial overlay -->
  <div id="tutorialOverlay" class="tutorial-overlay">
    <div class="tutorial-content">
      <h2 style="color:#145078; margin:0 0 15px 0;">Welcome to TASK Monthly Survey</h2>
      <p style="font-size:16px; margin:0 0 15px 0;">Would you like a guided tutorial before starting?</p>

      <!-- LANGUAGE -->
      <div class="section language-section">
        <h3 style="color:#92400e; margin:0 0 10px 0; font-size:16px;">Tutorial Language</h3>
        <select id="tutorialLang" style="width:100%; padding:10px; font-size:14px; margin:0;">
          <option value="en">English</option>
          <option value="es">Espa√±ol (Spanish)</option>
          <option value="ht">Krey√≤l Ayisyen (Haitian Creole)</option>
        </select>
      </div>

      <!-- VOICE -->
      <div class="section voice-section">
        <h3 style="color:#0284c7; margin:0 0 10px 0; font-size:16px;">Choose Your Guide</h3>
        <select id="voiceSelect" style="width:100%; padding:10px; font-size:14px; margin:0 0 8px 0;">
          <option value="Sean">Sean - Steady & Reassuring (Male)</option>
          <option value="Diani">Diani - Bright & Encouraging (Female)</option>
          <option value="Paul">Paul - Calm & Thoughtful (Male)</option>
          <option value="Mia">Mia - Gentle & Understanding (Female)</option>
          <option value="Frank">Frank - Supportive & Practical (Male)</option>
          <option value="Amy">Amy - Friendly & Warm (Female)</option>
        </select>
        <button id="voiceTestBtn" class="voice-test-btn">üîä TEST THIS VOICE</button>
      </div>

      <!-- PLAYBACK MODE -->
      <div class="section" style="background:#f3f4f6;">
        <h3 style="color:#145078; font-size:16px; margin:0 0 10px 0;">Tutorial Mode</h3>
        <label style="display:block; margin-bottom:6px;">
          <input type="radio" name="advanceMode" value="auto" checked> Auto-advance tutorial
        </label>
        <label style="display:block;">
          <input type="radio" name="advanceMode" value="manual"> Manual advance (Next/Back buttons)
        </label>
      </div>
      <!-- Checklist -->
      <div style="margin:15px 0; font-size:14px;">
        <div style="font-weight:bold; color:#145078; margin-bottom:8px;">You‚Äôll need:</div>
        <div>üì± A phone or computer</div>
        <div>üí∞ Your last 2 pay stubs</div>
        <div>‚è∞ About 5‚Äì10 minutes</div>
      </div>

      <!-- Buttons -->
      <button class="btn" id="startTutorialBtn" style="font-size:16px; padding:12px 24px; margin:5px;">
        üé¨ Start Tutorial
      </button>
      <button class="btn secondary" id="skipTutorialBtn" style="font-size:14px; padding:10px 20px;">
        Skip & Start Survey
      </button>
    </div>
  </div>

  <!-- Script section begins -->
  <script>
    // Global state
    let page = 1;
    let formData = {};
    let lang = "en";
    let availableVoices = [];
    let isCurrentlySpeaking = false;
    let selectedVoice = null;
    let isDemoMode = false;
    let demoStep = 0;
    let autoAdvance = true;
    const translations = {
      en: {
        continue: "Continue",
        back: "Back",
        submit: "Submit Monthly Report",
        stillWorking: "Are you still employed at this TASK-assisted job? *",
        yesEmployed: "Yes, still employed",
        noEmployed: "No longer employed",
        yesHelper: "Great job maintaining employment",
        noHelper: "We are here to help you find another job",
        completeRequired: "Please complete all required fields before continuing.",
        stopMessage: "You are no longer eligible to complete this survey. Please contact TASK.",
        stepContact: "Step 2: Contact Information",
        stepJob: "Step 3: Job Information",
        stepFeedback: "Step 4: Share Your Experience",
        stepUpload: "Step 5: Upload Pay Stubs",
        stepAuth: "Step 6: Authorization",
        stepSuccess: "Step 7: Success!"
      },
      es: {
        continue: "Continuar",
        back: "Atr√°s",
        submit: "Enviar Informe Mensual",
        stillWorking: "¬øSigues empleado en este trabajo asistido por TASK? *",
        yesEmployed: "S√≠, sigo empleado",
        noEmployed: "Ya no estoy empleado",
        yesHelper: "¬°Excelente trabajo manteniendo el empleo!",
        noHelper: "Estamos aqu√≠ para ayudarte a encontrar otro trabajo",
        completeRequired: "Por favor completa todos los campos requeridos antes de continuar.",
        stopMessage: "Ya no eres elegible para completar esta encuesta. Por favor contacta a TASK.",
        stepContact: "Paso 2: Informaci√≥n de Contacto",
        stepJob: "Paso 3: Informaci√≥n de Empleo",
        stepFeedback: "Paso 4: Comparte tu Experiencia",
        stepUpload: "Paso 5: Sube Talones de Pago",
        stepAuth: "Paso 6: Autorizaci√≥n",
        stepSuccess: "Paso 7: ¬°√âxito!"
      },
      ht: {
        continue: "Kontinye",
        back: "Retounen",
        submit: "Soum√®t Rap√≤ Chak Mwa",
        stillWorking: "√àske w ap toujou travay nan travay TASK te ede w jwenn lan? *",
        yesEmployed: "Wi, toujou ap travay",
        noEmployed: "Mwen pa travay ank√≤",
        yesHelper: "Bon travay kenbe travay la!",
        noHelper: "Nou la pou ede ou jwenn yon l√≤t travay",
        completeRequired: "Tanpri ranpli tout chan obligatwa yo anvan ou kontinye.",
        stopMessage: "Ou pa elijib pou konplete sondaj sa ank√≤. Tanpri kontakte TASK.",
        stepContact: "Etap 2: Enf√≤masyon Kontak",
        stepJob: "Etap 3: Enf√≤masyon Travay",
        stepFeedback: "Etap 4: Pataje Eksperyans Ou",
        stepUpload: "Etap 5: Telechaje Fich Peman",
        stepAuth: "Etap 6: Otorizasyon",
        stepSuccess: "Etap 7: Siks√®!"
      }
    };
    function setLanguage(l) {
      lang = l;
      localStorage.setItem("taskLanguage", l);
      renderPage();
    }

    function renderPage() {
      const t = translations[lang];
      let html = "";

      // Tutorial overlay stays separate, we only render the survey pages here
      if (page === 1) {
        html = `
          <div class="header-bar">
            <div class="lang-select">
              üåê <select id="langToggle" onchange="setLanguage(this.value)">
                <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
                <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
                <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
              </select>
            </div>
            <div class="progress">
              <div class="step active">1</div>
              <div class="step">2</div>
              <div class="step">3</div>
              <div class="step">4</div>
              <div class="step">5</div>
              <div class="step">6</div>
              <div class="step">7</div>
            </div>
          </div>

          <h2>${t.stillWorking}</h2>

          <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px;">
            <label class="radio-card">
              <div style="font-weight:bold; color:#145078;">${t.yesEmployed}</div>
              <div style="font-size:13px; color:#16a34a;">${t.yesHelper}</div>
              <input type="radio" name="stillWorking" value="yes"
                ${formData.stillWorking === 'yes' ? 'checked' : ''}
                onchange="toggleEmployment(true)">
            </label>

            <label class="radio-card" style="border-color:#fca5a5;">
              <div style="font-weight:bold; color:#145078;">${t.noEmployed}</div>
              <div style="font-size:13px; color:#dc2626;">${t.noHelper}</div>
              <input type="radio" name="stillWorking" value="no"
                ${formData.stillWorking === 'no' ? 'checked' : ''}
                onchange="toggleEmployment(false)">
            </label>
          </div>

          <div id="continueBtn" style="text-align:right; margin-top:20px; ${formData.stillWorking === 'yes' ? '' : 'display:none;'}">
            <button class="btn" onclick="nextPage()">${t.continue} ‚Üí</button>
          </div>

          <div id="stopMessage" style="color:#dc2626; font-weight:bold; text-align:center; margin-top:20px; ${formData.stillWorking === 'no' ? '' : 'display:none;'}">
            ${t.stopMessage}
          </div>
        `;
      }

      document.getElementById("survey").innerHTML = html;
    }
    if (page === 2) {
      const labels = {
        en: {
          title: "Step 2: Contact Information",
          blurb: "We collect your contact info so TASK can stay in touch and provide support.",
          firstName: "First Name *",
          lastName: "Last Name *",
          phone: "Phone Number *",
          email: "Email *",
          preferred: "Preferred Contact Method",
          months: "How long have you been employed at this job? *",
          options: ["Phone", "Email", "Text Message"]
        },
        es: {
          title: "Paso 2: Informaci√≥n de Contacto",
          blurb: "Recopilamos tu informaci√≥n de contacto para que TASK pueda mantenerse en contacto y brindarte apoyo.",
          firstName: "Nombre *",
          lastName: "Apellido *",
          phone: "N√∫mero de Tel√©fono *",
          email: "Correo Electr√≥nico *",
          preferred: "M√©todo de Contacto Preferido",
          months: "¬øCu√°nto tiempo has estado empleado en este trabajo? *",
          options: ["Tel√©fono", "Correo Electr√≥nico", "Mensaje de Texto"]
        },
        ht: {
          title: "Etap 2: Enf√≤masyon Kontak",
          blurb: "Nou kolekte enf√≤masyon kontak ou pou TASK ka rete an kontak ak ba ou sip√≤.",
          firstName: "Non *",
          lastName: "Siyati *",
          phone: "Nimewo Telef√≤n *",
          email: "Im√®l *",
          preferred: "Met√≤d Kontak ou pi pito",
          months: "Konbyen tan ou te travay nan travay sa a? *",
          options: ["Telef√≤n", "Im√®l", "Mesaj T√®ks"]
        }
      }[lang];

      function buildMonthOptions() {
        let opts = "";
        for (let i = 1; i <= 120; i++) {
          let label;
          if (i < 12) {
            label = `${i} ${lang==='es'?'mes':lang==='ht'?'mwa':'month'}${i>1?(lang==='es'?'es':lang==='ht'?'':'s'):''}`;
          } else {
            const years = Math.floor(i / 12);
            const rem = i % 12;
            let yearLabel = years + " " + (lang==='es' ? (years>1?"a√±os":"a√±o") : lang==='ht' ? (years>1?"ane":"ane") : (years>1?"years":"year"));
            if (rem > 0) {
              yearLabel += lang==='es'
                ? `, ${rem} mes${rem>1?"es":""}`
                : lang==='ht'
                  ? `, ${rem} mwa`
                  : `, ${rem} month${rem>1?"s":""}`;
            }
            label = `${i} ${lang==='es'?"meses":lang==='ht'?"mwa":"months"} (${yearLabel})`;
          }
          opts += `<option value="${i}" ${formData.monthsEmployed==i?'selected':''}>${label}</option>`;
        }
        return opts;
      }

      html = `
        <div class="header-bar">
          <div class="lang-select">
            üåê <select id="langToggle" onchange="setLanguage(this.value)">
              <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
              <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
              <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
            </select>
          </div>
          <div class="progress">
            <div class="step active">1</div>
            <div class="step active">2</div>
            <div class="step">3</div>
            <div class="step">4</div>
            <div class="step">5</div>
            <div class="step">6</div>
            <div class="step">7</div>
          </div>
        </div>

        <h2>${labels.title}</h2>
        <p class="blurb">${labels.blurb}</p>

        <div class="grid-2" style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
          <div>
            <label>${labels.firstName}</label>
            <input id="firstName" required value="${formData.firstName || ''}">
          </div>
          <div>
            <label>${labels.lastName}</label>
            <input id="lastName" required value="${formData.lastName || ''}">
          </div>
          <div>
            <label>${labels.phone}</label>
            <input id="phone" type="tel" oninput="formatPhone(this)" required value="${formData.phone || ''}">
          </div>
          <div>
            <label>${labels.email}</label>
            <input id="email" type="email" required value="${formData.email || ''}">
          </div>
        </div>

        <label>${labels.preferred}</label>
        <select id="preferredContact">
          ${labels.options.map(o=>`<option value="${o}" ${formData.preferredContact===o?'selected':''}>${o}</option>`).join("")}
        </select>

        <div class="highlight-box" style="border-color: #facc15;">
          <label style="font-size:18px; font-weight:bold;">${labels.months}</label>
          <select id="monthsEmployed" required>
            <option value="">${lang==='es'?'Seleccionar...':lang==='ht'?'Chwazi...':'Select...'}</option>
            ${buildMonthOptions()}
          </select>
        </div>

        <div style="display:flex; justify-content:space-between;">
          <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
          <button class="btn" onclick="nextPage()">${translations[lang].continue} ‚Üí</button>
        </div>
      `;
    }
    if (page === 3) {
      const labels = {
        en: {
          title: "Step 3: Job Details",
          blurb: "Please provide a few details about your current job so TASK can better support you.",
          employer: "Where are you currently working? *",
          payRate: "What is your hourly pay rate (or salary equivalent)? *",
          payPlaceholder: "Example: $16.50/hr or $40,000/year"
        },
        es: {
          title: "Paso 3: Detalles del Trabajo",
          blurb: "Por favor proporciona algunos detalles sobre tu trabajo actual para que TASK pueda apoyarte mejor.",
          employer: "¬øD√≥nde est√°s trabajando actualmente? *",
          payRate: "¬øCu√°l es tu salario por hora (o equivalente anual)? *",
          payPlaceholder: "Ejemplo: $16.50/hr o $40,000/a√±o"
        },
        ht: {
          title: "Etap 3: Detay Travay",
          blurb: "Tanpri bay k√®k detay sou travay akty√®l ou pou TASK ka sip√≤te ou pi byen.",
          employer: "Ki kote ou ap travay kounye a? *",
          payRate: "Ki kantite ou touche pa √®dtan (oswa sal√® ekivalan)? *",
          payPlaceholder: "Egzanp: $16.50/√®dtan oswa $40,000/ane"
        }
      }[lang];

      html = `
        <div class="header-bar">
          <div class="lang-select">
            üåê <select id="langToggle" onchange="setLanguage(this.value)">
              <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
              <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
              <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
            </select>
          </div>
          <div class="progress">
            <div class="step active">1</div>
            <div class="step active">2</div>
            <div class="step active">3</div>
            <div class="step">4</div>
            <div class="step">5</div>
            <div class="step">6</div>
            <div class="step">7</div>
          </div>
        </div>

        <h2>${labels.title}</h2>
        <p class="blurb">${labels.blurb}</p>

        <div class="highlight-box" style="border-color:#facc15;">
          <label>${labels.employer}</label>
          <input id="employer" type="text" required value="${formData.employer || ''}">
        </div>

        <div class="highlight-box" style="border-color:#facc15;">
          <label>${labels.payRate}</label>
          <input id="payRate" type="text" placeholder="${labels.payPlaceholder}" required value="${formData.payRate || ''}">
        </div>

        <div style="display:flex; justify-content:space-between;">
          <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
          <button class="btn" onclick="nextPage()">${translations[lang].continue} ‚Üí</button>
        </div>
      `;
    }
    if (page === 4) {
      const labels = {
        en: {
          title: "Step 4: Job Experience Feedback",
          blurb: "How do you feel about your job so far? Your feedback helps TASK understand your experience.",
          rating: "Rate your overall job experience:",
          comments: "What has been the best part of your job so far?"
        },
        es: {
          title: "Paso 4: Opini√≥n sobre la Experiencia Laboral",
          blurb: "¬øC√≥mo te sientes acerca de tu trabajo hasta ahora? Tus comentarios ayudan a TASK a entender tu experiencia.",
          rating: "Califica tu experiencia laboral general:",
          comments: "¬øCu√°l ha sido la mejor parte de tu trabajo hasta ahora?"
        },
        ht: {
          title: "Etap 4: Fidbak sou Eksperyans Travay",
          blurb: "Kijan ou santi w sou travay ou jiska prezan? Fidbak ou ede TASK konprann eksperyans ou.",
          rating: "Evalye eksperyans travay ou an jeneral:",
          comments: "Ki pati ki pi bon nan travay ou jiska kounye a?"
        }
      }[lang];

      html = `
        <div class="header-bar">
          <div class="lang-select">
            üåê <select id="langToggle" onchange="setLanguage(this.value)">
              <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
              <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
              <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
            </select>
          </div>
          <div class="progress">
            <div class="step active">1</div>
            <div class="step active">2</div>
            <div class="step active">3</div>
            <div class="step active">4</div>
            <div class="step">5</div>
            <div class="step">6</div>
            <div class="step">7</div>
          </div>
        </div>

        <h2>${labels.title}</h2>
        <p class="blurb">${labels.blurb}</p>

        <div class="highlight-box" style="border-color:#facc15; text-align:center;">
          <label style="font-size:18px; font-weight:bold;">${labels.rating}</label>
          <div id="starRating" style="margin:10px 0;">
            ${[1,2,3,4,5].map(num => `
              <span 
                onclick="setRating(${num})" 
                style="cursor:pointer; font-size:32px; margin:4px; color:${formData.rating >= num ? '#facc15' : '#d1d5db'};"
              >‚òÖ</span>
            `).join("")}
          </div>
        </div>

        <div class="highlight-box" style="border-color:#facc15;">
          <label>${labels.comments}</label>
          <textarea id="bestPart" rows="3">${formData.bestPart || ''}</textarea>
        </div>

        <div style="display:flex; justify-content:space-between;">
          <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
          <button class="btn" onclick="nextPage()">${translations[lang].continue} ‚Üí</button>
        </div>
      `;
    }
    if (page === 5) {
      const labels = {
        en: {
          title: "Step 5: Challenges & Support",
          blurb: "Everyone faces challenges. Please tell us what TASK can do to better support you.",
          q1: "What challenges are making it harder for you to succeed at work?",
          q1ph: "Transportation, childcare, housing, financial stress...",
          q2: "How can TASK support you in overcoming these challenges?",
          q2ph: "Help with bus passes, connecting with childcare services, job coaching..."
        },
        es: {
          title: "Paso 5: Retos y Apoyo",
          blurb: "Todos enfrentamos retos. Por favor dinos c√≥mo TASK puede apoyarte mejor.",
          q1: "¬øQu√© retos hacen m√°s dif√≠cil que tengas √©xito en el trabajo?",
          q1ph: "Transporte, cuidado de ni√±os, vivienda, estr√©s financiero...",
          q2: "¬øC√≥mo puede TASK apoyarte para superar estos retos?",
          q2ph: "Ayuda con boletos de autob√∫s, conexi√≥n con servicios de cuidado infantil, entrenamiento laboral..."
        },
        ht: {
          title: "Etap 5: Defi ak Sip√≤",
          blurb: "Chak moun f√® fas ak defi. Tanpri di nou kijan TASK ka sip√≤te ou pi byen.",
          q1: "Ki defi ki f√® li pi difisil pou ou reyisi nan travay?",
          q1ph: "Transp√≤, gadri, lojman, estr√®s finansye...",
          q2: "Kijan TASK ka ede ou simonte defi sa yo?",
          q2ph: "Ede ak tik√® otobis, koneksyon ak s√®vis gadri, kou travay..."
        }
      }[lang];

      html = `
        <div class="header-bar">
          <div class="lang-select">
            üåê <select id="langToggle" onchange="setLanguage(this.value)">
              <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
              <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
              <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
            </select>
          </div>
          <div class="progress">
            <div class="step active">1</div>
            <div class="step active">2</div>
            <div class="step active">3</div>
            <div class="step active">4</div>
            <div class="step active">5</div>
            <div class="step">6</div>
            <div class="step">7</div>
          </div>
        </div>

        <h2>${labels.title}</h2>
        <p class="blurb">${labels.blurb}</p>

        <div class="highlight-box" style="border-color:#facc15;">
          <label>${labels.q1}</label>
          <textarea id="challenges" rows="3" placeholder="${labels.q1ph}">${formData.challenges || ''}</textarea>
        </div>

        <div class="highlight-box" style="border-color:#facc15;">
          <label>${labels.q2}</label>
          <textarea id="taskSupport" rows="3" placeholder="${labels.q2ph}">${formData.taskSupport || ''}</textarea>
        </div>

        <div style="display:flex; justify-content:space-between;">
          <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
          <button class="btn" onclick="nextPage()">${translations[lang].continue} ‚Üí</button>
        </div>
      `;
    }
    if (page === 6) {
      const labels = {
        en: {
          title: "Step 6: Upload Pay Stubs & Authorization",
          blurb: "Please upload your last two pay stubs. This helps verify your continued employment with TASK.",
          uploadTitle: "Upload Your Last Two Pay Stubs *",
          uploadDesc: "You can upload files or take photos. Please make sure to provide both stubs.",
          auth: "Authorization *",
          authList: [
            "Contact me monthly for employment check-ins and support",
            "Provide information about additional resources and services",
            "Connect me with emergency assistance if needed",
            "Follow up if employment status changes"
          ]
        },
        es: {
          title: "Paso 6: Subir Talones de Pago y Autorizaci√≥n",
          blurb: "Por favor sube tus dos √∫ltimos talones de pago. Esto ayuda a verificar tu empleo continuo con TASK.",
          uploadTitle: "Sube Tus √öltimos Dos Talones de Pago *",
          uploadDesc: "Puedes subir archivos o tomar fotos. Por favor aseg√∫rate de proporcionar ambos talones.",
          auth: "Autorizaci√≥n *",
          authList: [
            "Contactarme mensualmente para verificaciones de empleo y apoyo",
            "Proporcionar informaci√≥n sobre recursos y servicios adicionales",
            "Conectarme con asistencia de emergencia si es necesario",
            "Dar seguimiento si cambia mi estado laboral"
          ]
        },
        ht: {
          title: "Etap 6: Telechaje Fich Peman & Otorizasyon",
          blurb: "Tanpri telechaje 2 d√®nye fich peman ou. Sa ede verifye travay kontiny√®l ou ak TASK.",
          uploadTitle: "Telechaje 2 D√®nye Fich Peman Ou *",
          uploadDesc: "Ou ka telechaje fichye oswa pran foto. Tanpri asire ou bay tou de.",
          auth: "Otorizasyon *",
          authList: [
            "Kontakte m chak mwa pou verifye travay ak sip√≤",
            "Bay enf√≤masyon sou resous ak s√®vis adisyon√®l",
            "Konekte m ak asistans ijans si sa neses√®",
            "F√® swivi si estati travay chanje"
          ]
        }
      }[lang];

      html = `
        <div class="header-bar">
          <div class="lang-select">
            üåê <select id="langToggle" onchange="setLanguage(this.value)">
              <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
              <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
              <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
            </select>
          </div>
          <div class="progress">
            <div class="step active">1</div>
            <div class="step active">2</div>
            <div class="step active">3</div>
            <div class="step active">4</div>
            <div class="step active">5</div>
            <div class="step active">6</div>
            <div class="step">7</div>
          </div>
        </div>

        <h2>${labels.title}</h2>
        <p class="blurb">${labels.blurb}</p>

        <div class="highlight-box" style="border-color:#facc15;">
          <h3 style="font-size:20px; color:#145078;">${labels.uploadTitle}</h3>
          <p style="font-size:16px; color:#555;">${labels.uploadDesc}</p>

          <div class="upload-box" style="border-color:#facc15;" onclick="document.getElementById('payStubInput').click()">
            <div style="font-size:38px; margin-bottom:10px;">üì∑ üìÅ</div>
            <p>${lang==='es'?'Haz clic para subir o tomar fotos':lang==='ht'?'Klike pou telechaje oswa pran foto':'Click to upload or take photos'}</p>
          </div>
          <input type="file" id="payStubInput" accept=".pdf,image/*" multiple capture="environment" style="display:none;" onchange="previewFile(this,'payStubPreview')">

          <div id="payStubPreview" class="preview" style="margin-top:15px;"></div>
        </div>

        <div class="highlight-box" style="border-color:#facc15;">
          <label style="display:flex; align-items:start; cursor:pointer;">
            <input type="checkbox" id="authorization" style="margin-top:6px; margin-right:12px; transform:scale(1.2); width:auto;">
            <div>
              <span style="font-size:18px; font-weight:bold; color:#145078;">${labels.auth}</span>
              <div style="font-size:14px; margin-top:8px; color:#145078;">
                ${labels.authList.map(item=>`<div>‚Ä¢ ${item}</div>`).join("")}
              </div>
            </div>
          </label>
        </div>

        <div style="display:flex; justify-content:space-between;">
          <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
          <button class="btn" onclick="submitSurvey()">${translations[lang].submit}</button>
        </div>
      `;
    }
    if (page === 7) {
      const labels = {
        en: {
          success: "Monthly Report Submitted Successfully!",
          thanks: "Thank you for your continued commitment to employment success through TASK!",
          office: "TASK Employment Office",
          location: "Trenton Area Soup Kitchen",
          address: "72¬Ω Escher St, Trenton, NJ 08609",
          phoneLabel: "Employment Office",
          phone: "609-697-6215 or 609-697-6166",
          hours: "Meal Time Hours",
          h1: "Mon‚ÄìFri: 10:30 AM ‚Äì 1:00 PM",
          h2: "Mon‚ÄìThu: 3:30 PM ‚Äì 5:00 PM",
          online: "Online",
          website: "trentonsoupkitchen.org",
          reward: "Reward Program",
          rewardText: "Complete monthly surveys and maintain employment to earn gift card rewards! Visit our Employment Office to claim your incentive."
        },
        es: {
          success: "¬°Informe Mensual Enviado Exitosamente!",
          thanks: "¬°Gracias por tu compromiso continuo con el √©xito laboral a trav√©s de TASK!",
          office: "Oficina de Empleo TASK",
          location: "Cocina de Sopa del √Årea de Trenton",
          address: "72¬Ω Escher St, Trenton, NJ 08609",
          phoneLabel: "Oficina de Empleo",
          phone: "609-697-6215 o 609-697-6166",
          hours: "Horario de Comidas",
          h1: "Lun‚ÄìVie: 10:30 AM ‚Äì 1:00 PM",
          h2: "Lun‚ÄìJue: 3:30 PM ‚Äì 5:00 PM",
          online: "En L√≠nea",
          website: "trentonsoupkitchen.org",
          reward: "Programa de Recompensas",
          rewardText: "Completa encuestas mensuales y mant√©n el empleo para ganar tarjetas de regalo. ¬°Visita nuestra oficina para reclamar tu incentivo!"
        },
        ht: {
          success: "Rap√≤ Chak Mwa Soum√®t ak Siks√®!",
          thanks: "M√®si pou angajman kontiny√®l ou ak siks√® travay nan TASK!",
          office: "Biwo Travay TASK",
          location: "Kizin Soup Trenton Area",
          address: "72¬Ω Escher St, Trenton, NJ 08609",
          phoneLabel: "Biwo Travay",
          phone: "609-697-6215 oswa 609-697-6166",
          hours: "Or√® Manje",
          h1: "Lendi‚ÄìVandredi: 10:30 AM ‚Äì 1:00 PM",
          h2: "Lendi‚ÄìJedi: 3:30 PM ‚Äì 5:00 PM",
          online: "Sou Ent√®n√®t",
          website: "trentonsoupkitchen.org",
          reward: "Pwogram Rekonpans",
          rewardText: "Konplete sondaj chak mwa yo epi kenbe travay pou jwenn rekonpans ak kat kado! Vizite Biwo Travay nou pou reklame li."
        }
      }[lang];

      html = `
        <div style="text-align:center;">
          <div style="font-size:80px; margin-bottom:20px;">üéâ</div>
          <h1 style="color:#16a34a;">${labels.success}</h1>
          <p style="font-size:20px; color:#6b7280; margin-bottom:30px;">${labels.thanks}</p>

          <div class="highlight-box" style="text-align:left; background:#f0fdf4; border-color:#facc15;">
            <h2 style="color:#145078; margin-bottom:15px;">${labels.office}</h2>

            <div class="contact-item" style="margin-bottom:10px; display:flex; align-items:center; gap:8px;">
              <span style="font-size:20px;">üìç</span>
              <div>
                <div style="font-weight:bold; font-size:16px;">${labels.location}</div>
                <div style="font-size:14px;">${labels.address}</div>
              </div>
            </div>

            <div class="contact-item" style="margin-bottom:10px; display:flex; align-items:center; gap:8px;">
              <span style="font-size:20px;">üìû</span>
              <div>
                <div style="font-weight:bold;">${labels.phoneLabel}</div>
                <div style="font-size:14px;">${labels.phone}</div>
              </div>
            </div>

            <div class="contact-item" style="margin-bottom:10px; display:flex; align-items:center; gap:8px;">
              <span style="font-size:20px;">üïê</span>
              <div>
                <div style="font-weight:bold;">${labels.hours}</div>
                <div style="font-size:14px;">${labels.h1}</div>
                <div style="font-size:14px;">${labels.h2}</div>
              </div>
            </div>

            <div class="contact-item" style="display:flex; align-items:center; gap:8px;">
              <span style="font-size:20px;">üåê</span>
              <div>
                <div style="font-weight:bold;">${labels.online}</div>
                <div style="font-size:14px;">${labels.website}</div>
              </div>
            </div>
          </div>

          <div class="highlight-box" style="text-align:center; background:#fff7ed; border-color:#facc15; margin-top:20px;">
            <div style="font-size:22px; font-weight:bold; color:#166534; margin-bottom:10px;">
              üíµ ${labels.reward}
            </div>
            <p style="color:#166534; font-weight:500;">${labels.rewardText}</p>
          </div>
        </div>
      `;
    }
    // ===== Helpers =====

    // Toggle employment eligibility
    function toggleEmployment(isEmployed) {
      formData.stillWorking = isEmployed ? "yes" : "no";
      if (isEmployed) {
        document.getElementById("continueBtn").style.display = "";
        document.getElementById("stopMessage").style.display = "none";
      } else {
        document.getElementById("continueBtn").style.display = "none";
        document.getElementById("stopMessage").style.display = "";
      }
    }

    // Save form data
    function saveFormData() {
      if (page === 2) {
        formData.firstName = document.getElementById("firstName")?.value || "";
        formData.lastName = document.getElementById("lastName")?.value || "";
        formData.phone = document.getElementById("phone")?.value || "";
        formData.email = document.getElementById("email")?.value || "";
        formData.preferredContact = document.getElementById("preferredContact")?.value || "";
        formData.monthsEmployed = document.getElementById("monthsEmployed")?.value || "";
      }
      if (page === 3) {
        formData.employer = document.getElementById("employer")?.value || "";
        formData.payRate = document.getElementById("payRate")?.value || "";
      }
      if (page === 4) {
        formData.rating = formData.rating || 0; // handled by setRating()
        formData.bestPart = document.getElementById("bestPart")?.value || "";
      }
      if (page === 5) {
        formData.challenges = document.getElementById("challenges")?.value || "";
        formData.taskSupport = document.getElementById("taskSupport")?.value || "";
      }
      if (page === 6) {
        formData.authorization = document.getElementById("authorization")?.checked || false;
      }
    }

    // Validation
    function validatePage() {
      const t = translations[lang];

      if (page === 2) {
        const required = ["firstName","lastName","phone","email","monthsEmployed"];
        for (let field of required) {
          const el = document.getElementById(field);
          if (!el?.value.trim()) {
            alert(t.completeRequired);
            el?.focus();
            return false;
          }
        }
      }

      if (page === 3) {
        if (!document.getElementById("employer")?.value.trim() || !document.getElementById("payRate")?.value.trim()) {
          alert(t.completeRequired);
          return false;
        }
      }

      if (page === 6) {
        const payStubFiles = document.getElementById("payStubInput")?.files || [];
        const authChecked = document.getElementById("authorization")?.checked;

        if (payStubFiles.length < 2) {
          alert(lang==="es"
            ? "Por favor sube al menos dos talones de pago."
            : lang==="ht"
              ? "Tanpri telechaje omwen 2 fich peman."
              : "Please upload at least two pay stubs."
          );
          return false;
        }
        if (!authChecked) {
          alert(t.completeRequired);
          return false;
        }
      }
      return true;
    }
    // ===== Navigation =====
    function nextPage() {
      if (!validatePage()) return;
      saveFormData();
      page++;
      renderPage();
    }

    function prevPage() {
      saveFormData();
      page--;
      renderPage();
    }

    // Submit Survey
    function submitSurvey() {
      if (!validatePage()) return;

      // Prevent resubmissions within 30 days
      const lastSubmission = localStorage.getItem("taskFormSubmitted");
      if (lastSubmission) {
        const daysSince = Math.floor((Date.now() - parseInt(lastSubmission)) / (1000*60*60*24));
        if (daysSince < 30) {
          alert(lang==="es"
            ? "Ya enviaste un informe este mes. Vuelve el pr√≥ximo mes."
            : lang==="ht"
              ? "Ou deja soum√®t yon rap√≤ mwa sa a. Tanpri retounen mwa pwochen."
              : "You already submitted a report this month. Please return next month."
          );
          return;
        }
      }

      saveFormData();
      formData.submissionId = "TASK_" + Date.now();
      formData.timestamp = new Date().toISOString();

      // Save lock in localStorage
      localStorage.setItem("taskFormSubmitted", Date.now().toString());

      console.log("Form submitted:", formData);

      page = 7; // success page
      renderPage();
    }
    // ===== Helpers =====

    // Phone formatting
    function formatPhone(input) {
      let val = input.value.replace(/\D/g, "");
      if (val.length > 3 && val.length <= 6) {
        input.value = `(${val.slice(0, 3)}) ${val.slice(3)}`;
      } else if (val.length > 6) {
        input.value = `(${val.slice(0, 3)}) ${val.slice(3, 6)}-${val.slice(6, 10)}`;
      } else {
        input.value = val;
      }
    }

    // File preview (images + PDFs)
    function previewFile(input, previewId) {
      const preview = document.getElementById(previewId);
      preview.innerHTML = "";

      if (input.files.length > 0) {
        const count = document.createElement("p");
        count.textContent = `${input.files.length} file(s) selected`;
        count.style.fontWeight = "bold";
        count.style.color = "#16a34a";
        count.style.marginBottom = "10px";
        preview.appendChild(count);
      }

      Array.from(input.files).forEach(file => {
        if (file.type.startsWith("image/")) {
          const reader = new FileReader();
          reader.onload = e => {
            const img = document.createElement("img");
            img.src = e.target.result;
            preview.appendChild(img);
          };
          reader.readAsDataURL(file);
        } else {
          const div = document.createElement("div");
          div.classList.add("file-name");
          div.textContent = file.name;
          preview.appendChild(div);
        }
      });
    }

    // Star rating renderer
    function renderStarRating(id, currentValue) {
      let html = "";
      for (let i = 1; i <= 5; i++) {
        html += `<span class="star ${currentValue>=i?'filled':''}" data-value="${i}" 
                 onclick="setStarRating('${id}',${i})">‚òÖ</span>`;
      }
      return `<div id="${id}" class="star-rating">${html}</div>`;
    }

    function setStarRating(id, value) {
      formData[id] = value;
      const container = document.getElementById(id);
      if (container) {
        Array.from(container.querySelectorAll('.star')).forEach(star => {
          star.classList.toggle('filled', parseInt(star.dataset.value) <= value);
        });
      }
    }
    // ===== Tutorial Overlay =====

    let isDemoMode = false;
    let demoStep = 0;
    let selectedVoice = null;
    let autoAdvance = true; // default

    function showTutorialOverlay() {
      document.getElementById("tutorialOverlay").style.display = "flex";
    }

    function hideTutorialOverlay() {
      document.getElementById("tutorialOverlay").style.display = "none";
    }

    function skipTutorial() {
      const tutorialLang = document.getElementById('tutorialLang');
      lang = tutorialLang.value;
      localStorage.setItem("taskLanguage", lang);

      hideTutorialOverlay();
      page = 1;
      renderPage();
    }

    function startTutorial() {
      const tutorialLang = document.getElementById('tutorialLang').value;
      const voiceChoice = document.getElementById('voiceSelect').value;
      const mode = document.querySelector('input[name="tutorialMode"]:checked')?.value || 'auto';

      lang = tutorialLang;
      autoAdvance = (mode === 'auto');
      localStorage.setItem("taskLanguage", lang);

      selectedVoice = voiceChoice;
      hideTutorialOverlay();

      isDemoMode = true;
      demoStep = 0;
      page = 1;
      formData = {};

      renderPage();

      // Kickoff tutorial
      setTimeout(() => {
        const introText = getVoiceIntro(selectedVoice, lang);
        speak(introText, () => {
          runTutorialStep();
        });
      }, 500);
    }
    // ===== Voice Scripts =====

    function getVoiceIntro(voice, lang) {
      const intros = {
        Sean: {
          en: "Hi, I'm Sean. I'll walk you through this survey step by step in a calm and supportive way.",
          es: "Hola, soy Sean. Te guiar√© en esta encuesta paso a paso de manera tranquila y solidaria.",
          ht: "Bonjou, mwen se Sean. Mwen pral gide ou nan sondaj sa a etap pa etap av√®k pasyans ak sip√≤."
        },
        Diani: {
          en: "Hello! I'm Diani, and I'm excited to guide you through this survey. Let's make it clear and simple together.",
          es: "¬°Hola! Soy Diani y estoy emocionada de guiarte en esta encuesta. Vamos a hacerlo claro y sencillo juntos.",
          ht: "Bonjou! Mwen se Diani e mwen kontan ede w pase nan sondaj sa a. Ann f√® l senp ansanm."
        },
        Mia: {
          en: "Hi, I'm Mia. I know surveys can feel a little stressful, so I'll help keep things gentle and easy to follow.",
          es: "Hola, soy Mia. S√© que las encuestas pueden ser un poco estresantes, as√≠ que har√© que sea suave y f√°cil de seguir.",
          ht: "Bonjou, mwen se Mia. Mwen konnen sondaj yo ka santi yo difisil, kidonk mwen la pou f√® li pi fasil pou ou."
        },
        Paul: {
          en: "Good day, I'm Paul. I'll guide you through this survey carefully so you always know what to do next.",
          es: "Buenos d√≠as, soy Paul. Te guiar√© con cuidado en esta encuesta para que siempre sepas qu√© hacer despu√©s.",
          ht: "Bonjou, mwen se Paul. Mwen pral gide ou ak anpil atansyon pou ou toujou konnen sa pou w f√® apre."
        },
        Frank: {
          en: "Hi there, I'm Frank. I'll keep this survey friendly and straightforward while we go through it together.",
          es: "Hola, soy Frank. Mantendr√© esta encuesta amigable y directa mientras la completamos juntos.",
          ht: "Bonjou, mwen se Frank. Mwen pral f√® sondaj sa a senp ak zanmitay pandan nou ranpli l ansanm."
        },
        Amy: {
          en: "Hello! I'm Amy. I'll help you step by step with warmth and encouragement to complete this survey.",
          es: "¬°Hola! Soy Amy. Te ayudar√© paso a paso con cari√±o y √°nimo para completar esta encuesta.",
          ht: "Bonjou! Mwen se Amy. Mwen pral ede ou ak anpil ankourajman pou ranpli sondaj sa a."
        }
      };
      return intros[voice]?.[lang] || intros.Sean.en;
    }

    // ===== Speech Engine =====
    function speak(text, callback) {
      if (!('speechSynthesis' in window)) {
        console.warn("Speech synthesis not supported");
        if (callback) callback();
        return;
      }

      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }

      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 0.95;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;

      utterance.onend = () => {
        if (callback) callback();
      };

      speechSynthesis.speak(utterance);
    }
    // ===== Tutorial Steps =====
    function getTutorialSteps() {
      const steps = [
        {
          page: 1,
          selector: '.radio-card:first-child',
          text: "Let's start with the first question. Since you're filling this survey, you're likely still working. Select 'Yes, still employed'.",
          action: () => {
            setTimeout(() => {
              const radio = document.querySelector('input[value="yes"]');
              if (radio) {
                radio.checked = true;
                formData.stillWorking = "yes";
                toggleEmployment(true);
              }
            }, 1200);
          }
        },
        {
          page: 1,
          selector: '#continueBtn',
          text: "Great! Now you see the Continue button. Click it to move forward.",
          action: () => {
            setTimeout(() => nextPage(), 2000);
          }
        },
        {
          page: 2,
          selector: '#firstName',
          text: "This step is about your contact information. Let's start by entering a first name.",
          action: () => {
            setTimeout(() => {
              const field = document.getElementById('firstName');
              if (field) field.value = "John";
            }, 1500);
          }
        },
        {
          page: 2,
          selector: '#monthsEmployed',
          text: "Here we record how long you‚Äôve been employed. If more than a year, it shows years and months automatically.",
          action: () => {
            setTimeout(() => {
              const select = document.getElementById('monthsEmployed');
              if (select) select.value = "14"; // example 1 year, 2 months
            }, 1200);
          }
        },
        {
          page: 3,
          selector: '#q1',
          text: "Now let‚Äôs share what has helped you succeed in your job.",
          action: () => {
            setTimeout(() => {
              const field = document.getElementById('q1');
              if (field) field.value = "Supportive manager and flexible schedule.";
            }, 1200);
          }
        },
        {
          page: 3,
          selector: '#authorization',
          text: "Finally, check this box to allow TASK to support you monthly.",
          action: () => {
            setTimeout(() => {
              const check = document.getElementById('authorization');
              if (check) check.checked = true;
            }, 1200);
          }
        },
        {
          page: 4,
          selector: '.highlight-box',
          text: "Perfect! This success page confirms your survey is done. You‚Äôll also see TASK‚Äôs contact info and gift card rewards program.",
          action: () => {}
        }
      ];
      return steps;
    }

    // ===== Highlighting =====
    function clearHighlights() {
      document.querySelectorAll('*').forEach(el => {
        el.style.border = '';
        el.style.boxShadow = '';
      });
    }

    function highlightElement(el) {
      if (!el) return;
      clearHighlights();
      el.style.border = '3px solid yellow';
      el.style.boxShadow = '0 0 12px rgba(255, 255, 0, 0.7)';
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    // ===== Tutorial Runner =====
    function runTutorialStep() {
      if (!isDemoMode) return;

      const steps = getTutorialSteps();
      if (demoStep >= steps.length) {
        const completedText = "Tutorial completed! You can now fill in your real information.";
        speak(completedText);
        exitTutorial();
        return;
      }

      const step = steps[demoStep];
      if (page !== step.page) {
        page = step.page;
        renderPage();
        setTimeout(() => runTutorialStep(), 500);
        return;
      }

      const element = document.querySelector(step.selector);
      if (element) {
        highlightElement(element);

        speak(step.text, () => {
          step.action();
          if (autoAdvance) {
            setTimeout(() => {
              demoStep++;
              runTutorialStep();
            }, 4500);
          }
        });
      } else {
        demoStep++;
        runTutorialStep();
      }
    }

    function exitTutorial() {
      isDemoMode = false;
      demoStep = 0;
      clearHighlights();
      speechSynthesis.cancel();

      page = 1;
      formData = {};
      renderPage();
    }

    // ===== Playback Controls =====
    function pauseTutorial() {
      if (speechSynthesis.speaking && !speechSynthesis.paused) {
        speechSynthesis.pause();
      } else if (speechSynthesis.paused) {
        speechSynthesis.resume();
      }
    }

    function stopTutorial() {
      speechSynthesis.cancel();
      exitTutorial();
    }

    function nextTutorialStep() {
      speechSynthesis.cancel();
      demoStep++;
      runTutorialStep();
    }

    function prevTutorialStep() {
      speechSynthesis.cancel();
      demoStep = Math.max(0, demoStep - 1);
      runTutorialStep();
    }
  <!-- ===== Tutorial Overlay ===== -->
  <div id="tutorialOverlay" class="tutorial-overlay" style="display:none;">
    <div class="tutorial-content">
      <h2 style="color:#145078; margin-bottom:12px;">Welcome to TASK Monthly Survey</h2>
      <p style="font-size:15px; margin-bottom:18px;">
        Choose your guide, language, and how you‚Äôd like the tutorial to run.
      </p>

      <!-- Language -->
      <div class="section language-section">
        <h3 style="margin:0 0 10px 0; font-size:15px; color:#92400e;">Tutorial Language</h3>
        <select id="tutorialLang" style="width:100%; padding:8px; font-size:14px;">
          <option value="en">English</option>
          <option value="es">Espa√±ol (Spanish)</option>
          <option value="ht">Krey√≤l Ayisyen (Haitian Creole)</option>
        </select>
      </div>

      <!-- Voice -->
      <div class="section voice-section">
        <h3 style="margin:0 0 10px 0; font-size:15px; color:#0284c7;">Choose Your Guide</h3>
        <select id="voiceSelect" style="width:100%; padding:8px; font-size:14px;">
          <option value="Sean">Sean ‚Äì Steady & Reassuring (Male)</option>
          <option value="Diani">Diani ‚Äì Bright & Encouraging (Female)</option>
          <option value="Mia">Mia ‚Äì Gentle & Understanding (Female)</option>
          <option value="Paul">Paul ‚Äì Calm & Thoughtful (Male)</option>
          <option value="Frank">Frank ‚Äì Practical & Supportive (Male)</option>
          <option value="Amy">Amy ‚Äì Friendly & Clear (Female)</option>
        </select>
        <button id="voiceTestBtn" class="voice-test-btn" style="margin-top:8px;">
          üîä Test This Voice
        </button>
      </div>

      <!-- Mode -->
      <div class="section mode-section" style="background:#fef9c3; border-color:#eab308;">
        <h3 style="margin:0 0 10px 0; font-size:15px; color:#92400e;">Tutorial Mode</h3>
        <label style="display:block; margin-bottom:6px;">
          <input type="radio" name="tutorialMode" value="auto" checked> Auto-Advance
        </label>
        <label style="display:block;">
          <input type="radio" name="tutorialMode" value="manual"> Manual Control
        </label>
      </div>

      <!-- Playback Tools -->
      <div class="section" style="background:#f1f5f9; border-color:#94a3b8;">
        <h3 style="margin:0 0 10px 0; font-size:15px; color:#145078;">Playback Tools</h3>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
          <button class="btn" onclick="pauseTutorial()">‚èØ Pause/Resume</button>
          <button class="btn" onclick="prevTutorialStep()">‚¨Ö Prev</button>
          <button class="btn" onclick="nextTutorialStep()">‚û° Next</button>
          <button class="btn" onclick="stopTutorial()">‚èπ Stop</button>
        </div>
      </div>

      <!-- Start/Skip -->
      <div style="margin-top:16px; display:flex; justify-content:space-between;">
        <button class="btn" id="startTutorialBtn">üé¨ Start Tutorial</button>
        <button class="btn" id="skipTutorialBtn" style="background:#6b7280;">Skip Tutorial</button>
      </div>
    </div>
  </div>
  <style>
    /* Overlay */
    .tutorial-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 15px;
      box-sizing: border-box;
    }
    .tutorial-content {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      max-height: 95vh;
      overflow-y: auto;
      padding: 20px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.2);
    }
    .section {
      margin: 12px 0;
      padding: 12px;
      border-radius: 12px;
      border: 2px solid #e2e8f0;
    }
    .language-section {
      background: #fef3c7;
      border-color: #facc15;
    }
    .voice-section {
      background: #e0f2fe;
      border-color: #38bdf8;
    }
    .mode-section {
      background: #fef9c3;
      border-color: #eab308;
    }
    .voice-test-btn {
      width: 100%;
      padding: 8px;
      background: #16a34a;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
    }
    .voice-test-btn.playing {
      background: #dc2626;
    }
  </style>

  <script>
    // Initialize tutorial overlay
    function initTutorialOverlay() {
      loadVoices();
      speechSynthesis.onvoiceschanged = loadVoices;

      document.getElementById('voiceTestBtn').addEventListener('click', testVoice);
      document.getElementById('startTutorialBtn').addEventListener('click', startTutorial);
      document.getElementById('skipTutorialBtn').addEventListener('click', skipTutorial);

      // Always show tutorial on first load
      showTutorialOverlay();
    }

    window.addEventListener('load', () => {
      renderPage();
      initTutorialOverlay();
    });
  </script>
    // ===== Submission Control =====
    function submitSurvey() {
      if (!validatePage()) return;

      // Prevent resubmissions within 30 days
      const lastSubmission = localStorage.getItem("taskFormSubmitted");
      if (lastSubmission) {
        const daysSince = Math.floor((Date.now() - parseInt(lastSubmission)) / (1000*60*60*24));
        if (daysSince < 30) {
          const msg = lang === "es"
            ? "Ya enviaste un informe este mes. Vuelve el pr√≥ximo mes."
            : lang === "ht"
              ? "Ou deja soum√®t yon rap√≤ mwa sa a. Tanpri retounen mwa pwochen."
              : "You already submitted a report this month. Please return next month.";
          alert(msg);
          return;
        }
      }

      saveFormData();
      formData.submissionId = "TASK_" + Date.now();
      formData.timestamp = new Date().toISOString();

      localStorage.setItem("taskFormSubmitted", Date.now().toString());

      console.log("Form submitted:", formData);

      page = 4;
      renderPage();
    }
    // ===== Validation =====
    function validatePage() {
      const t = translations[lang];

      if (page === 2) {
        const required = ["firstName","lastName","phone","email","monthsEmployed","employer","payRate"];
        for (let field of required) {
          const el = document.getElementById(field);
          if (!el?.value.trim()) {
            alert(t.completeRequired);
            el?.focus();
            return false;
          }
        }
      }

      if (page === 3) {
        const payStubFiles = document.getElementById("payStubInput")?.files || [];
        const authChecked = document.getElementById("authorization")?.checked;

        if (payStubFiles.length < 2) {
          alert(lang === "es"
            ? "Por favor sube al menos dos talones de pago."
            : lang === "ht"
              ? "Tanpri telechaje omwen 2 fich peman."
              : "Please upload at least two pay stubs."
          );
          return false;
        }
        if (!authChecked) {
          alert(t.completeRequired);
          return false;
        }

        // Validate star ratings
        const ratings = ["satisfaction","support","communication"];
        for (let r of ratings) {
          const val = document.querySelector(`input[name="${r}"]:checked`);
          if (!val) {
            alert("Please provide a rating for all questions.");
            return false;
          }
        }
      }
      return true;
    }
  if (page === 2) {
    const labels = {
      en: {
        title: "Step 2: Contact Information",
        blurb: "We collect your contact info so TASK can stay in touch and provide support.",
        firstName: "First Name *",
        lastName: "Last Name *",
        phone: "Phone Number *",
        email: "Email *",
        employer: "Where are you working? *",
        payRate: "What is your hourly pay rate? *",
        months: "How many months have you been employed? *",
        options: ["Phone","Email","Text Message"]
      }
    }[lang];

    function buildMonthOptions() {
      let opts = "";
      for (let i = 1; i <= 120; i++) {
        let label;
        if (i < 12) {
          label = `${i} month${i>1?"s":""}`;
        } else {
          const years = Math.floor(i / 12);
          const rem = i % 12;
          let yearLabel = `${years} year${years>1?"s":""}`;
          if (rem > 0) yearLabel += `, ${rem} month${rem>1?"s":""}`;
          label = `${i} months (${yearLabel})`;
        }
        opts += `<option value="${i}" ${formData.monthsEmployed==i?'selected':''}>${label}</option>`;
      }
      return opts;
    }

    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${labels.title}</h2>
      <p class="blurb">${labels.blurb}</p>

      <div class="grid-2" style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
        <div>
          <label>${labels.firstName}</label>
          <input id="firstName" required value="${formData.firstName || ''}">
        </div>
        <div>
          <label>${labels.lastName}</label>
          <input id="lastName" required value="${formData.lastName || ''}">
        </div>
        <div>
          <label>${labels.phone}</label>
          <input id="phone" type="tel" oninput="formatPhone(this)" required value="${formData.phone || ''}">
        </div>
        <div>
          <label>${labels.email}</label>
          <input id="email" type="email" required value="${formData.email || ''}">
        </div>
        <div>
          <label>${labels.employer}</label>
          <input id="employer" required value="${formData.employer || ''}">
        </div>
        <div>
          <label>${labels.payRate}</label>
          <input id="payRate" type="number" step="0.01" required value="${formData.payRate || ''}">
        </div>
      </div>

      <label>${labels.months}</label>
      <select id="monthsEmployed" required>
        <option value="">Select...</option>
        ${buildMonthOptions()}
      </select>

      <div style="display:flex; justify-content:space-between; margin-top:20px;">
        <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
        <button class="btn" onclick="nextPage()">${translations[lang].continue} ‚Üí</button>
      </div>
    `;
  }
  if (page === 3) {
    const labels = {
      en: {
        title: "Step 3: Monthly Experience & Documentation",
        blurb: "Share your feedback, provide ratings, and upload employment verification.",
        q1: "What has helped you stay successful in your TASK-assisted job?",
        q1ph: "Supportive management, flexible schedule, good pay...",
        q2: "What ongoing challenges can TASK help you address?",
        q2ph: "Transportation, childcare, housing, financial stress...",
        q3: "How has TASK support made a difference in your employment journey?",
        q3ph: "Job search assistance, interview prep, work clothes...",
        rating1: "Overall satisfaction with your job",
        rating2: "How supported do you feel by TASK?",
        rating3: "How would you rate communication with TASK?",
        uploadTitle: "Upload Your Last Two Pay Stubs *",
        uploadDesc: "You can upload files or take photos. Please upload both stubs.",
        auth: "Authorization *",
        authList: [
          "Contact me monthly for employment check-ins and support",
          "Provide information about additional resources and services",
          "Connect me with emergency assistance if needed",
          "Follow up if employment status changes"
        ]
      }
    }[lang];

    function buildStarRating(name) {
      let stars = "";
      for (let i = 5; i >= 1; i--) {
        stars += `
          <input type="radio" id="${name}${i}" name="${name}" value="${i}">
          <label for="${name}${i}">‚≠ê</label>
        `;
      }
      return `<div style="display:flex; flex-direction:row-reverse; justify-content:flex-end; gap:4px;">${stars}</div>`;
    }

    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step active">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${labels.title}</h2>
      <p class="blurb">${labels.blurb}</p>

      <div class="highlight-box">
        <label>${labels.q1}</label>
        <textarea id="q1" rows="3" placeholder="${labels.q1ph}">${formData.q1 || ''}</textarea>
      </div>

      <div class="highlight-box">
        <label>${labels.q2}</label>
        <textarea id="q2" rows="3" placeholder="${labels.q2ph}">${formData.q2 || ''}</textarea>
      </div>

      <div class="highlight-box">
        <label>${labels.q3}</label>
        <textarea id="q3" rows="3" placeholder="${labels.q3ph}">${formData.q3 || ''}</textarea>
      </div>

      <div class="highlight-box">
        <label>${labels.rating1}</label>
        ${buildStarRating("satisfaction")}
      </div>

      <div class="highlight-box">
        <label>${labels.rating2}</label>
        ${buildStarRating("support")}
      </div>

      <div class="highlight-box">
        <label>${labels.rating3}</label>
        ${buildStarRating("communication")}
      </div>

      <div class="highlight-box">
        <h3 style="font-size:18px; color:#145078;">${labels.uploadTitle}</h3>
        <p style="font-size:14px; color:#555;">${labels.uploadDesc}</p>
        <div class="upload-box" onclick="document.getElementById('payStubInput').click()">
          <div style="font-size:32px; margin-bottom:8px;">üì∑ üìÅ</div>
          <p>Click to upload or take photos</p>
        </div>
        <input type="file" id="payStubInput" accept=".pdf,image/*" multiple capture="environment" style="display:none;" onchange="previewFile(this,'payStubPreview')">
        <div id="payStubPreview" class="preview" style="margin-top:10px;"></div>
      </div>

      <div class="highlight-box">
        <label style="display:flex; align-items:start; cursor:pointer;">
          <input type="checkbox" id="authorization" style="margin-top:6px; margin-right:10px; transform:scale(1.2); width:auto;">
          <div>
            <span style="font-size:16px; font-weight:bold; color:#145078;">${labels.auth}</span>
            <div style="font-size:13px; margin-top:6px; color:#145078;">
              ${labels.authList.map(item => `<div>‚Ä¢ ${item}</div>`).join("")}
            </div>
          </div>
        </label>
      </div>

      <div style="display:flex; justify-content:space-between; margin-top:20px;">
        <button class="btn" onclick="prevPage()">‚Üê ${translations[lang].back}</button>
        <button class="btn" onclick="submitSurvey()">${translations[lang].submit}</button>
      </div>
    `;
  }
  if (page === 4) {
    const labels = {
      en: {
        title: "üéâ Thank You for Completing Your Monthly Survey!",
        blurb: "Your feedback helps TASK continue supporting your success. We truly appreciate your time and honesty.",
        reward: "üí≥ As a thank you, you may pick up your gift card at TASK. Please bring a photo ID.",
        contact: "If you need help, contact TASK Employment Services:",
        phone: "üìû (609) 555-1234",
        email: "‚úâÔ∏è workforce@trentonsoupkitchen.org"
      }
    }[lang];

    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step active">3</div>
          <div class="step active">4</div>
        </div>
      </div>

      <div class="highlight-box" style="text-align:center; padding:24px;">
        <h2 style="color:#145078; font-size:22px; margin-bottom:12px;">${labels.title}</h2>
        <p style="font-size:15px; margin-bottom:16px; color:#444;">${labels.blurb}</p>

        <div style="background:#fef9c3; border:2px solid #eab308; border-radius:12px; padding:16px; margin:20px 0; text-align:left;">
          <p style="font-weight:bold; font-size:16px; color:#92400e;">${labels.reward}</p>
        </div>

        <div style="margin-top:20px; font-size:14px; line-height:1.6; color:#145078;">
          <p>${labels.contact}</p>
          <p>${labels.phone}</p>
          <p>${labels.email}</p>
        </div>

        <button class="btn" style="margin-top:20px;" onclick="exitTutorial()">üè† Back to Start</button>
      </div>
    `;
  }
    // ===== Helpers =====

    // Phone number formatting
    function formatPhone(input) {
      let val = input.value.replace(/\D/g, "");
      if (val.length > 3 && val.length <= 6) {
        input.value = `(${val.slice(0, 3)}) ${val.slice(3)}`;
      } else if (val.length > 6) {
        input.value = `(${val.slice(0, 3)}) ${val.slice(3, 6)}-${val.slice(6, 10)}`;
      } else {
        input.value = val;
      }
    }

    // File preview for uploads
    function previewFile(input, previewId) {
      const preview = document.getElementById(previewId);
      preview.innerHTML = "";

      if (input.files.length > 0) {
        const count = document.createElement("p");
        count.textContent = `${input.files.length} file(s) selected`;
        count.style.fontWeight = "bold";
        count.style.color = "#16a34a";
        count.style.marginBottom = "10px";
        preview.appendChild(count);
      }

      Array.from(input.files).forEach(file => {
        if (file.type.startsWith("image/")) {
          const reader = new FileReader();
          reader.onload = e => {
            const img = document.createElement("img");
            img.src = e.target.result;
            img.style.maxWidth = "140px";
            img.style.margin = "6px";
            img.style.borderRadius = "10px";
            img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.15)";
            preview.appendChild(img);
          };
          reader.readAsDataURL(file);
        } else {
          const div = document.createElement("div");
          div.classList.add("file-name");
          div.textContent = file.name;
          div.style.background = "#f3f4f6";
          div.style.border = "1px solid #d1d5db";
          div.style.borderRadius = "6px";
          div.style.padding = "8px";
          div.style.margin = "5px";
          div.style.fontSize = "14px";
          preview.appendChild(div);
        }
      });
    }
    // ===== Initialization =====
    function initSurvey() {
      // Load saved language
      const savedLang = localStorage.getItem("taskLanguage");
      if (savedLang && translations[savedLang]) {
        lang = savedLang;
      }

      // Load advance mode
      const savedAdvance = localStorage.getItem("advanceMode");
      if (savedAdvance) {
        advanceMode = savedAdvance;
      }

      // Reset to first tutorial page
      page = 0;
      renderPage();
    }

    // Exit tutorial and restart
    function exitTutorial() {
      page = 0;
      renderPage();
    }

    // Start survey from tutorial
    function startSurvey() {
      page = 1;
      renderPage();
    }

    // Launch initialization when page loads
    window.onload = initSurvey;
  </script>
</body>
</html>
<script>
  // ===== Voice Narration Scripts =====
  const voiceScripts = {
    en: {
      sean: [
        "Hi, I‚Äôm Sean. I‚Äôll be guiding you through this survey today.",
        "This survey helps TASK learn how your job is going and what support you may need.",
        "It only takes a few minutes, and your answers help us give you better help.",
        "Don‚Äôt worry ‚Äî there are no wrong answers. Just be honest, and we‚Äôll work together."
      ],
      diani: [
        "Hello, my name is Diani. I‚Äôm here to help explain what this survey is all about.",
        "This survey asks simple questions about your work, like how long you‚Äôve been working and how things are going.",
        "If something is hard at work, we want to know so TASK can support you.",
        "Think of me as your guide ‚Äî I‚Äôll make sure you don‚Äôt get lost."
      ],
      paul: [
        "Hey there, I‚Äôm Paul. Thanks for joining us for this survey.",
        "We‚Äôll ask about your job, your pay stubs, and how TASK can keep helping you.",
        "Your answers stay private, and they help TASK see how we‚Äôre doing as a team.",
        "I‚Äôll be here to encourage you step by step. You‚Äôve got this!"
      ]
    }
  };
</script>
<script>
  Object.assign(voiceScripts.en, {
    mia: [
      "Hi, I‚Äôm Mia. I know surveys can feel boring, but this one is really important.",
      "We‚Äôll ask about your work and how TASK can keep supporting you.",
      "If you‚Äôve had good moments at work, share them. If things are tough, tell us that too.",
      "I‚Äôll be here cheering you on. Let‚Äôs get started together!"
    ],
    frank: [
      "Hey, I‚Äôm Frank. I‚Äôll walk you through this survey step by step.",
      "We want to know how your job is going and how TASK has helped you.",
      "Your answers help us make sure you get the right kind of support each month.",
      "Take your time ‚Äî no rush. I‚Äôll help keep things clear."
    ],
    amy: [
      "Hello! My name is Amy. I‚Äôm here to make this survey easy for you.",
      "We‚Äôll ask about your job, your pay stubs, and if you need any extra help.",
      "The survey doesn‚Äôt take long, and it helps TASK keep you moving forward.",
      "I‚Äôll guide you through the steps like a friend would. Let‚Äôs do this together!"
    ]
  });
</script>
<script>
  // ===== Voice Playback Tools =====
  let currentVoice = "sean";   // default narrator
  let currentLine = 0;
  let autoAdvance = false;
  let utterance;
  let synth = window.speechSynthesis;

  function playVoiceLine() {
    if (!voiceScripts.en[currentVoice] || currentLine >= voiceScripts.en[currentVoice].length) return;
    stopVoice();
    utterance = new SpeechSynthesisUtterance(voiceScripts.en[currentVoice][currentLine]);
    utterance.lang = "en-US";
    utterance.onend = () => {
      if (autoAdvance) {
        currentLine++;
        playVoiceLine();
      }
    };
    synth.speak(utterance);
  }

  function pauseVoice() {
    if (synth.speaking && !synth.paused) synth.pause();
  }

  function resumeVoice() {
    if (synth.paused) synth.resume();
  }

  function stopVoice() {
    if (synth.speaking) synth.cancel();
  }

  function nextLine() {
    if (currentLine < voiceScripts.en[currentVoice].length - 1) {
      currentLine++;
      playVoiceLine();
    }
  }

  function prevLine() {
    if (currentLine > 0) {
      currentLine--;
      playVoiceLine();
    }
  }

  function toggleAutoAdvance() {
    autoAdvance = !autoAdvance;
    document.getElementById("autoAdvanceStatus").innerText =
      autoAdvance ? "Auto-advance ON" : "Auto-advance OFF";
  }
</script>

<!-- ===== Playback UI ===== -->
<div style="margin:20px 0; padding:15px; border:2px solid gold; border-radius:12px; text-align:center;">
  <h3>üéôÔ∏è Voice Guide</h3>
  <div style="margin-bottom:10px;">
    <button onclick="prevLine()">‚èÆÔ∏è Prev</button>
    <button onclick="playVoiceLine()">‚ñ∂Ô∏è Play</button>
    <button onclick="pauseVoice()">‚è∏Ô∏è Pause</button>
    <button onclick="resumeVoice()">‚ñ∂Ô∏è Resume</button>
    <button onclick="stopVoice()">‚èπÔ∏è Stop</button>
    <button onclick="nextLine()">‚è≠Ô∏è Next</button>
  </div>
  <button onclick="toggleAutoAdvance()">üîÑ Toggle Auto/Manual</button>
  <div id="autoAdvanceStatus" style="margin-top:8px; font-weight:bold;">Auto-advance OFF</div>
</div>
<!-- ===== Voice Narrator Selection ===== -->
<div style="margin:20px 0; padding:15px; border:2px solid gold; border-radius:12px; text-align:center;">
  <h3>üó£Ô∏è Choose Your Guide</h3>
  <p style="font-size:14px; color:#444;">Pick a voice that you‚Äôd like to guide you through this survey.</p>
  
  <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:10px; margin-top:15px;">
    <button onclick="selectVoice('sean')" style="padding:12px; border-radius:10px; background:#145078; color:white; font-weight:bold;">Sean</button>
    <button onclick="selectVoice('diani')" style="padding:12px; border-radius:10px; background:#145078; color:white; font-weight:bold;">Diani</button>
    <button onclick="selectVoice('paul')" style="padding:12px; border-radius:10px; background:#145078; color:white; font-weight:bold;">Paul</button>
    <button onclick="selectVoice('mia')" style="padding:12px; border-radius:10px; background:#145078; color:white; font-weight:bold;">Mia</button>
    <button onclick="selectVoice('frank')" style="padding:12px; border-radius:10px; background:#145078; color:white; font-weight:bold;">Frank</button>
    <button onclick="selectVoice('amy')" style="padding:12px; border-radius:10px; background:#145078; color:white; font-weight:bold;">Amy</button>
  </div>

  <div id="voiceSelected" style="margin-top:12px; font-weight:bold; color:#145078;">Current Voice: Sean</div>
</div>

<script>
  function selectVoice(name) {
    currentVoice = name;
    currentLine = 0;
    document.getElementById("voiceSelected").innerText = "Current Voice: " + name.charAt(0).toUpperCase() + name.slice(1);
    playVoiceLine();
  }
</script>
<!-- ===== Tutorial Intro Screen ===== -->
<div id="tutorialIntro" style="margin:20px 0; padding:20px; border:2px solid gold; border-radius:14px; background:#fffbe6; text-align:center;">
  <h2 style="color:#145078;">üëã Welcome to the Survey!</h2>
  <p style="font-size:16px; color:#333; margin-bottom:15px;">
    This short survey helps TASK understand how your job is going and what support you may need.  
    You can listen to your guide‚Äôs voice or read along at your own pace.
  </p>

  <div style="margin:15px 0;">
    <h3 style="margin-bottom:10px;">How would you like to move through the tutorial?</h3>
    <button onclick="setAdvanceMode(false)" style="padding:12px 18px; margin:6px; border-radius:10px; background:#145078; color:white; font-weight:bold;">
      üìã Manual Advance
    </button>
    <button onclick="setAdvanceMode(true)" style="padding:12px 18px; margin:6px; border-radius:10px; background:#145078; color:white; font-weight:bold;">
      üîÑ Auto Advance
    </button>
  </div>

  <div id="advanceChoice" style="margin:10px; font-weight:bold; color:#145078;">No mode selected yet</div>

  <button onclick="startSurvey()" style="margin-top:15px; padding:14px 24px; border-radius:12px; background:#33a7b5; color:white; font-weight:bold;">
    üöÄ Start Survey
  </button>
</div>

<script>
  function setAdvanceMode(auto) {
    autoAdvance = auto;
    document.getElementById("advanceChoice").innerText = auto
      ? "Auto Advance Mode Selected"
      : "Manual Advance Mode Selected";
  }

  function startSurvey() {
    document.getElementById("tutorialIntro")
<!-- ===== Survey Step 1: Employment Status ===== -->
<div id="surveyStep1" style="display:none; margin:20px 0; padding:20px; border:2px solid gold; border-radius:14px; background:#fff;">

  <h2 style="color:#145078; text-align:center;">Step 1: Employment Status</h2>
  <p style="text-align:center; color:#444; margin-bottom:15px;">
    Please let us know if you are still working at the job TASK helped you find.
  </p>

  <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px;">
    <label class="radio-card">
      <div style="font-weight:bold; color:#145078;">‚úÖ Yes, I am still employed</div>
      <input type="radio" name="stillWorking" value="yes"
        onchange="setEmploymentStatus('yes')" />
    </label>

    <label class="radio-card" style="border-color:#fca5a5;">
      <div style="font-weight:bold; color:#145078;">‚ùå No, I am not employed anymore</div>
      <input type="radio" name="stillWorking" value="no"
        onchange="setEmploymentStatus('no')" />
    </label>
  </div>

  <div id="employmentContinue" style="text-align:right; margin-top:20px; display:none;">
    <button class="btn" onclick="goToStep2()">Continue ‚Üí</button>
  </div>

  <div id="employmentStop" style="color:#dc2626; font-weight:bold; text-align:center; margin-top:20px; display:none;">
    You are no longer eligible to complete this survey.  
    Please contact TASK for more support.
  </div>
</div>

<script>
  function setEmploymentStatus(status) {
    formData.stillWorking = status;
    if (status === "yes") {
      document.getElementById("employmentContinue").style.display = "block";
      document.getElementById("employmentStop").style.display = "none";
    } else {
      document.getElementById("employmentContinue").style.display = "none";
      document.getElementById("employmentStop").style.display = "block";
    }
  }

  function goToStep2() {
    document.getElementById("surveyStep1").style.display = "none";
    document.getElementById("surveyStep2").style.display = "block";
    currentLine = 0;
    playVoiceLine();
  }
</script>
<!-- ===== Survey Step 2: Contact Info ===== -->
<div id="surveyStep2" style="display:none; margin:20px 0; padding:20px; border:2px solid gold; border-radius:14px; background:#fff;">

  <h2 style="color:#145078; text-align:center;">Step 2: Contact Information</h2>
  <p style="text-align:center; color:#444; margin-bottom:15px;">
    Please share your contact details so TASK can stay in touch and support you.
  </p>

  <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
    <div>
      <label>First Name *</label>
      <input type="text" id="firstName" required />
    </div>
    <div>
      <label>Last Name *</label>
      <input type="text" id="lastName" required />
    </div>
    <div>
      <label>Phone Number *</label>
      <input type="tel" id="phone" oninput="formatPhone(this)" required />
    </div>
    <div>
      <label>Email *</label>
      <input type="email" id="email" required />
    </div>
  </div>

  <label>Preferred Contact Method</label>
  <select id="preferredContact">
    <option value="phone">Phone</option>
    <option value="email">Email</option>
    <option value="text">Text Message</option>
  </select>

  <div class="highlight-box" style="margin-top:15px;">
    <label style="font-size:18px; font-weight:bold;">How many months have you been employed? *</label>
    <select id="monthsEmployed" required></select>
  </div>

  <div style="display:flex; justify-content:space-between; margin-top:20px;">
    <button class="btn" onclick="backToStep1()">‚Üê Back</button>
    <button class="btn" onclick="goToStep3()">Continue ‚Üí</button>
  </div>
</div>

<script>
  function backToStep1() {
    document.getElementById("surveyStep2").style.display = "none";
    document.getElementById("surveyStep1").style.display = "block";
  }

  function goToStep3() {
    // Save form data
    formData.firstName = document.getElementById("firstName").value;
    formData.lastName = document.getElementById("lastName").value;
    formData.phone = document.getElementById("phone").value;
    formData.email = document.getElementById("email").value;
    formData.preferredContact = document.getElementById("preferredContact").value;
    formData.monthsEmployed = document.getElementById("monthsEmployed").value;

    if (!formData.firstName || !formData.lastName || !formData.phone || !formData.email || !formData.monthsEmployed) {
      alert("Please complete all required fields.");
      return;
    }

    document.getElementById("surveyStep2").style.display = "none";
    document.getElementById("surveyStep3").style.display = "block";
    currentLine = 0;
    playVoiceLine();
  }

  // Populate months into years+months
  function populateMonths() {
    let dropdown = document.getElementById("monthsEmployed");
    for (let i = 1; i <= 120; i++) {
      let label;
      if (i < 12) {
        label = `${i} month${i > 1 ? "s" : ""}`;
      } else {
        let years = Math.floor(i / 12);
        let months = i % 12;
        label = `${years} year${years > 1 ? "s" : ""}`;
        if (months > 0) {
          label += `, ${months} month${months > 1 ? "s" : ""}`;
        }
      }
      let option = document.createElement("option");
      option.value = i;
      option.textContent = label;
      dropdown.appendChild(option);
    }
  }
  populateMonths();
</script>
<!-- ===== Survey Step 3: Workplace Information ===== -->
<div id="surveyStep3" style="display:none; margin:20px 0; padding:20px; border:2px solid gold; border-radius:14px; background:#fff;">

  <h2 style="color:#145078; text-align:center;">Step 3: Workplace Information</h2>
  <p style="text-align:center; color:#444; margin-bottom:15px;">
    Please tell us a little more about where you are working and your pay.
  </p>

  <div>
    <label>Employer / Company Name *</label>
    <input type="text" id="employer" required />
  </div>

  <div>
    <label>Pay Rate (per hour, per week, etc.) *</label>
    <input type="text" id="payRate" placeholder="$15 per hour" required />
  </div>

  <div>
    <label>Job Title / Position *</label>
    <input type="text" id="jobTitle" placeholder="Example: Cook, Driver, Cashier" required />
  </div>

  <div class="highlight-box" style="margin-top:15px;">
    <label style="font-size:18px; font-weight:bold;">Work Location</label>
    <textarea id="workLocation" rows="3" placeholder="Address or general location"></textarea>
  </div>

  <div style="display:flex; justify-content:space-between; margin-top:20px;">
    <button class="btn" onclick="backToStep2()">‚Üê Back</button>
    <button class="btn" onclick="goToStep4()">Continue ‚Üí</button>
  </div>
</div>

<script>
  function backToStep2() {
    document.getElementById("surveyStep3").style.display = "none";
    document.getElementById("surveyStep2").style.display = "block";
  }

  function goToStep4() {
    // Save form data
    formData.employer = document.getElementById("employer").value;
    formData.payRate = document.getElementById("payRate").value;
    formData.jobTitle = document.getElementById("jobTitle").value;
    formData.workLocation = document.getElementById("workLocation").value;

    if (!formData.employer || !formData.payRate || !formData.jobTitle) {
      alert("Please complete all required fields.");
      return;
    }

    document.getElementById("surveyStep3").style.display = "none";
    document.getElementById("surveyStep4").style.display = "block";
    currentLine = 0;
    playVoiceLine();
  }
</script>
<!-- ===== Survey Step 4: Monthly Reflections ===== -->
<div id="surveyStep4" style="display:none; margin:20px 0; padding:20px; border:2px solid gold; border-radius:14px; background:#fff;">

  <h2 style="color:#145078; text-align:center;">Step 4: Monthly Reflections</h2>
  <p style="text-align:center; color:#444; margin-bottom:15px;">
    Tell us how things are going at work this month.
  </p>

  <!-- Q1 -->
  <div class="highlight-box">
    <label>‚≠ê What has helped you stay successful in your job?</label>
    <div class="star-rating" id="q1Stars"></div>
    <textarea id="q1" rows="3" placeholder="Supportive manager, flexible schedule, good pay..."></textarea>
    <ul style="font-size:14px; color:#555; margin-top:8px;">
      <li>Good support at work</li>
      <li>Flexible schedule</li>
      <li>Reliable transportation</li>
    </ul>
  </div>

  <!-- Q2 -->
  <div class="highlight-box">
    <label>‚≠ê What challenges do you face at work?</label>
    <div class="star-rating" id="q2Stars"></div>
    <textarea id="q2" rows="3" placeholder="Transportation, childcare, housing, financial stress..."></textarea>
    <ul style="font-size:14px; color:#555; margin-top:8px;">
      <li>Transportation issues</li>
      <li>Childcare problems</li>
      <li>Stress with bills</li>
    </ul>
  </div>

  <!-- Q3 -->
  <div class="highlight-box">
    <label>‚≠ê How has TASK support made a difference in your employment journey?</label>
    <div class="star-rating" id="q3Stars"></div>
    <textarea id="q3" rows="3" placeholder="Job search help, interview prep, work clothes..."></textarea>
    <ul style="font-size:14px; color:#555; margin-top:8px;">
      <li>Helped with interviews</li>
      <li>Provided work clothes</li>
      <li>Job search guidance</li>
    </ul>
  </div>

  <div style="display:flex; justify-content:space-between; margin-top:20px;">
    <button class="btn" onclick="backToStep3()">‚Üê Back</button>
    <button class="btn" onclick="goToStep5()">Continue ‚Üí</button>
  </div>
</div>

<script>
  function backToStep3() {
    document.getElementById("surveyStep4").style.display = "none";
    document.getElementById("surveyStep3").style.display = "block";
  }

  function goToStep5() {
    formData.q1 = document.getElementById("q1").value;
    formData.q2 = document.getElementById("q2").value;
    formData.q3 = document.getElementById("q3").value;

    document.getElementById("surveyStep4").style.display = "none";
    document.getElementById("surveyStep5").style.display = "block";
    currentLine = 0;
    playVoiceLine();
  }

  // Simple star rating generator
  function createStarRating(id) {
    const container = document.getElementById(id);
    for (let i = 1; i <= 5; i++) {
      const star = document.createElement("span");
      star.textContent = "‚≠ê";
      star.style.cursor = "pointer";
      star.onclick = () => {
        formData[id] = i;
        Array.from(container.children).forEach((s, index) => {
          s.style.opacity = index < i ? "1" : "0.3";
        });
      };
      container.appendChild(star);
    }
  }
  createStarRating("q1Stars");
  createStarRating("q2Stars");
  createStarRating("q3Stars");
</script>
<!-- ===== Survey Step 5: Pay Stub Upload & Authorization ===== -->
<div id="surveyStep5" style="display:none; margin:20px 0; padding:20px; border:2px solid gold; border-radius:14px; background:#fff;">

  <h2 style="color:#145078; text-align:center;">Step 5: Upload Your Pay Stubs</h2>
  <p style="text-align:center; color:#444; margin-bottom:15px;">
    Please upload your last <strong>two pay stubs</strong> for employment verification.  
    You can upload files or use your camera to take pictures.
  </p>

  <!-- Upload Box -->
  <div class="highlight-box">
    <div class="upload-box" onclick="document.getElementById('payStubInput').click()">
      <div style="font-size:38px; margin-bottom:10px;">üì∑ üìÅ</div>
      <p>Click here to upload or take photos</p>
    </div>
    <input 
      type="file" 
      id="payStubInput" 
      accept=".pdf,image/*" 
      multiple 
      capture="environment" 
      style="display:none;" 
      onchange="previewFile(this,'payStubPreview')"
    >
    <div id="payStubPreview" class="preview" style="margin-top:15px;"></div>
  </div>

  <!-- Authorization Checkbox -->
  <div class="highlight-box">
    <label style="display:flex; align-items:start; cursor:pointer;">
      <input type="checkbox" id="authorization" style="margin-top:6px; margin-right:12px; transform:scale(1.2);">
      <div>
        <span style="font-size:18px; font-weight:bold; color:#145078;">Authorization *</span>
        <div style="font-size:14px; margin-top:8px; color:#145078;">
          ‚Ä¢ TASK may contact me monthly for employment check-ins and support<br>
          ‚Ä¢ Provide me with information about additional resources and services<br>
          ‚Ä¢ Connect me with emergency assistance if needed<br>
          ‚Ä¢ Follow up if my employment status changes
        </div>
      </div>
    </label>
  </div>

  <!-- Navigation -->
  <div style="display:flex; justify-content:space-between; margin-top:20px;">
    <button class="btn" onclick="backToStep4()">‚Üê Back</button>
    <button class="btn" onclick="goToStep6()">Continue ‚Üí</button>
  </div>
</div>

<script>
  function backToStep4() {
    document.getElementById("surveyStep5").style.display = "none";
    document.getElementById("surveyStep4").style.display = "block";
  }

  function goToStep6() {
    const payStubFiles = document.getElementById("payStubInput").files;
    const authChecked = document.getElementById("authorization").checked;

    if (payStubFiles.length < 2) {
      alert("Please upload at least two pay stubs.");
      return;
    }
    if (!authChecked) {
      alert("Please check the authorization box to continue.");
      return;
    }

    formData.payStubs = Array.from(payStubFiles).map(f => f.name);
    formData.authorization = authChecked;

    document.getElementById("surveyStep5").style.display = "none";
    document.getElementById("surveyStep6").style.display = "block";
    currentLine = 0;
    playVoiceLine();
  }

  // File preview (images or names)
  function previewFile(input, previewId) {
    const preview = document.getElementById(previewId);
    preview.innerHTML = "";

    Array.from(input.files).forEach(file => {
      if (file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement("img");
          img.src = e.target.result;
          img.style.maxWidth = "140px";
          img.style.margin = "6px";
          img.style.borderRadius = "10px";
          img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.15)";
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      } else {
        const div = document.createElement("div");
        div.classList.add("file-name");
        div.textContent = file.name;
        preview.appendChild(div);
      }
    });
  }
</script>
<!-- ===== Survey Step 6: Review & Confirmation ===== -->
<div id="surveyStep6" style="display:none; margin:20px 0; padding:20px; border:2px solid gold; border-radius:14px; background:#fff;">

  <h2 style="color:#145078; text-align:center;">Step 6: Review Your Information</h2>
  <p style="text-align:center; color:#444; margin-bottom:15px;">
    Please take a moment to review your answers below before submitting.
  </p>

  <!-- Review Summary -->
  <div class="highlight-box" style="font-size:15px; line-height:1.6;">
    <p><strong>Employment Status:</strong> <span id="reviewEmployment"></span></p>
    <p><strong>First Name:</strong> <span id="reviewFirstName"></span></p>
    <p><strong>Last Name:</strong> <span id="reviewLastName"></span></p>
    <p><strong>Phone:</strong> <span id="reviewPhone"></span></p>
    <p><strong>Email:</strong> <span id="reviewEmail"></span></p>
    <p><strong>Preferred Contact:</strong> <span id="reviewContact"></span></p>
    <p><strong>Months Employed:</strong> <span id="reviewMonths"></span></p>
    <p><strong>Employer:</strong> <span id="reviewEmployer"></span></p>
    <p><strong>Job Title:</strong> <span id="reviewJobTitle"></span></p>
    <p><strong>Pay Rate:</strong> <span id="reviewPayRate"></span></p>
    <p><strong>What helps you succeed?:</strong> <span id="reviewQ1"></span></p>
    <p><strong>Challenges to address:</strong> <span id="reviewQ2"></span></p>
    <p><strong>How TASK support helps:</strong> <span id="reviewQ3"></span></p>
    <p><strong>Pay Stubs Uploaded:</strong> <span id="reviewPayStubs"></span></p>
    <p><strong>Authorization:</strong> <span id="reviewAuth"></span></p>
  </div>

  <!-- Navigation -->
  <div style="display:flex; justify-content:space-between; margin-top:20px;">
    <button class="btn" onclick="backToStep5()">‚Üê Back</button>
    <button class="btn" onclick="submitSurvey()">Submit Survey ‚úÖ</button>
  </div>
</div>

<script>
  function backToStep5() {
    document.getElementById("surveyStep6").style.display = "none";
    document.getElementById("surveyStep5").style.display = "block";
  }

  // Populate review summary
  function populateReview() {
    document.getElementById("reviewEmployment").textContent = formData.stillWorking === "yes" ? "Yes, still employed" : "No longer employed";
    document.getElementById("reviewFirstName").textContent = formData.firstName || "-";
    document.getElementById("reviewLastName").textContent = formData.lastName || "-";
    document.getElementById("reviewPhone").textContent = formData.phone || "-";
    document.getElementById("reviewEmail").textContent = formData.email || "-";
    document.getElementById("reviewContact").textContent = formData.preferredContact || "-";
    document.getElementById("reviewMonths").textContent = formData.monthsEmployed || "-";
    document.getElementById("reviewEmployer").textContent = formData.employer || "-";
    document.getElementById("reviewJobTitle").textContent = formData.jobTitle || "-";
    document.getElementById("reviewPayRate").textContent = formData.payRate || "-";
    document.getElementById("reviewQ1").textContent = formData.q1 || "-";
    document.getElementById("reviewQ2").textContent = formData.q2 || "-";
    document.getElementById("reviewQ3").textContent = formData.q3 || "-";
    document.getElementById("reviewPayStubs").textContent = (formData.payStubs && formData.payStubs.length > 0) ? formData.payStubs.join(", ") : "None";
    document.getElementById("reviewAuth").textContent = formData.authorization ? "‚úî Authorized" : "‚ùå Not Authorized";
  }

  // Submit survey with one-month lock
  function submitSurvey() {
    const lastSubmission = localStorage.getItem("taskFormSubmitted");
    if (lastSubmission) {
      const daysSince = Math.floor((Date.now() - parseInt(lastSubmission)) / (1000*60*60*24));
      if (daysSince < 30) {
        alert("You already submitted this survey within the past 30 days. Please return next month.");
        return;
      }
    }

    formData.submissionId = "TASK_" + Date.now();
    formData.timestamp = new Date().toISOString();
    localStorage.setItem("taskFormSubmitted", Date.now().toString());

    console.log("Survey submitted:", formData);

    document.getElementById("surveyStep6").style.display = "none";
    document.getElementById("surveyStep7").style.display = "block";
    currentLine = 0;
    playVoiceLine();
  }
</script>
<!-- ===== Survey Step 7: Success Page ===== -->
<div id="surveyStep7" style="display:none; margin:20px 0; padding:20px; border:2px solid gold; border-radius:14px; background:#fff; text-align:center;">

  <div style="font-size:80px; margin-bottom:20px;">üéâ</div>
  <h1 style="color:#16a34a;">Survey Submitted Successfully!</h1>
  <p style="font-size:18px; color:#444; margin:20px 0;">
    Thank you for completing your monthly check-in with TASK.  
    Your participation helps us support your ongoing employment success.
  </p>

  <!-- Contact Info -->
  <div class="highlight-box" style="text-align:left; background:#f0fdf4; border-color:#86efac;">
    <h2 style="color:#145078; margin-bottom:15px;">TASK Employment Office</h2>

    <div style="margin-bottom:10px;">
      <strong>üìç Location:</strong><br>
      Trenton Area Soup Kitchen<br>
      72¬Ω Escher St, Trenton, NJ 08609
    </div>

    <div style="margin-bottom:10px;">
      <strong>üìû Phone:</strong><br>
      609-697-6215 or 609-697-6166
    </div>

    <div style="margin-bottom:10px;">
      <strong>üïê Hours:</strong><br>
      Mon‚ÄìFri: 10:30 AM ‚Äì 1:00 PM<br>
      Mon‚ÄìThu: 3:30 PM ‚Äì 5:00 PM
    </div>

    <div>
      <strong>üåê Online:</strong><br>
      <a href="https://trentonsoupkitchen.org/" target="_blank">trentonsoupkitchen.org</a>
    </div>
  </div>

  <!-- Reward Program -->
  <div class="highlight-box" style="background:#fff7ed; border-color:#fdba74; margin-top:20px;">
    <div style="font-size:22px; font-weight:bold; color:#166534; margin-bottom:10px;">
      üí≥ Reward Program
    </div>
    <p style="color:#166534; font-weight:500;">
      Complete your monthly surveys and maintain employment to receive gift card rewards.  
      Visit our Employment Office to claim your incentive.
    </p>
  </div>

  <!-- Navigation -->
  <div style="margin-top:30px;">
    <button class="btn" onclick="restartSurvey()">üè† Return to Home</button>
  </div>
</div>

<script>
  function restartSurvey() {
    page = 1;
    formData = {};
    document.getElementById("surveyStep7").style.display = "none";
    document.getElementById("surveyStep1").style.display = "block";
    currentLine = 0;
    playVoiceLine();
  }

  // Narration for success page
  function narrateSuccessPage() {
    const script = {
      Sean: "Congratulations! You‚Äôve successfully submitted your monthly survey. Remember, you can stop by the TASK Employment Office if you need extra help, and don‚Äôt forget about the reward program for staying consistent!",
      Diani: "Awesome job! Your survey has been submitted. Keep up the great work, and remember to check in with TASK for any support. Plus, you‚Äôre now closer to earning gift card rewards!",
      Mia: "Well done. You‚Äôve completed your monthly survey. TASK is here to support you, so don‚Äôt hesitate to reach out if you need help. And yes, your efforts make you eligible for gift card rewards.",
      Paul: "Survey submitted successfully. Thank you for your continued commitment to employment success. TASK staff are available for support, and your consistency puts you in line for gift card rewards.",
      Frank: "Nice work. That‚Äôs another survey completed. TASK is proud to support your employment journey. Don‚Äôt forget to stop by the office for any help you need and to claim your gift card reward.",
      Amy: "Great job finishing your survey! This helps TASK stay connected and provide you with resources. Keep coming back each month, and remember‚Äîyou can earn gift card rewards too!"
    };

    const voiceName = selectedVoiceName || "Sean";
    speak(script[voiceName] || script.Sean);
  }
</script>
<!-- ===== Playback Toolbar ===== -->
<div id="playbackToolbar" style="
  position:fixed;
  bottom:20px;
  right:20px;
  background:#145078;
  color:white;
  padding:12px 16px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  display:flex;
  align-items:center;
  gap:10px;
  z-index:2000;
">
  <button onclick="pauseNarration()" style="padding:6px 10px; border-radius:6px; background:#facc15; color:#111; font-weight:bold;">‚è∏ Pause</button>
  <button onclick="resumeNarration()" style="padding:6px 10px; border-radius:6px; background:#16a34a; color:white; font-weight:bold;">‚ñ∂ Resume</button>
  <button onclick="skipNarration()" style="padding:6px 10px; border-radius:6px; background:#dc2626; color:white; font-weight:bold;">‚è≠ Skip</button>
  <label style="margin-left:8px; font-size:13px;">
    <input type="checkbox" id="autoAdvanceToggle" onchange="toggleAutoAdvance()" style="margin-right:4px;">
    Auto-Advance
  </label>
</div>

<script>
  function pauseNarration() {
    if (speechSynthesis.speaking && !speechSynthesis.paused) {
      speechSynthesis.pause();
    }
  }

  function resumeNarration() {
    if (speechSynthesis.paused) {
      speechSynthesis.resume();
    }
  }

  function skipNarration() {
    spee
<script>
let tutorialSteps = [];
let currentStepIndex = 0;

// Build tutorial steps (with narration text + actions)
function buildTutorialSteps() {
  tutorialSteps = [
    {
      page: 1,
      text: "Let's start with the first question about your job. Please select whether you are still working.",
      action: () => highlightAndSelect("input[value='yes']")
    },
    {
      page: 2,
      text: "Now let's fill out your contact information, starting with your first and last name.",
      action: () => highlightField("#firstName")
    },
    {
      page: 3,
      text: "This section asks about your job experience. Please describe what has helped you succeed.",
      action: () => highlightField("#q1")
    },
    {
      page: 6,
      text: "This question helps TASK understand your pay rate. Please enter your hourly wage.",
      action: () => highlightField("#payRate")
    },
    {
      page: 7,
      text: "Congratulations, your survey is complete! This page shows TASK‚Äôs contact info and your reward program.",
      action: narrateSuccessPage
    }
  ];
}

// Highlight helper
function highlightAndSelect(selector) {
  clearHighlights();
  const el = document.querySelector(selector);
  if (el) {
    el.style.border = "3px solid gold";
    el.scrollIntoView({behavior: "smooth", block: "center"});
    if (el.type === "radio" || el.type === "checkbox") el.checked = true;
  }
}

function highlightField(selector) {
  clearHighlights();
  const el = document.querySelector(selector);
  if (el) {
    el.style.border = "3px solid gold";
    el.scrollIntoView({behavior: "smooth", block: "center"});
  }
}

function clearHighlights() {
  document.querySelectorAll("*").forEach(el => {
    if (el.style.border === "3px solid gold") {
      el.style.border = "";
    }
  });
}

// Run next tutorial step
function runNextTutorialStep() {
  if (currentStepIndex >= tutorialSteps.length) return;

  const step = tutorialSteps[currentStepIndex];
  if (page !== step.page) {
    page = step.page;
    renderPage();
  }

  speak(step.text, () => {
    if (step.action) step.action();
    if (autoAdvance) {
      setTimeout(() => {
        currentStepIndex++;
        runNextTutorialStep();
      }, 4000);
    }
  });
}

function startTutorialFlow() {
  currentStepIndex = 0;
  buildTutorialSteps();
  runNextTutorialStep();
}
</script>
<script>
function submitSurvey() {
  // Prevent multiple submissions per month
  const lastSubmission = localStorage.getItem("taskLastSubmission");
  if (lastSubmission) {
    const lastDate = new Date(parseInt(lastSubmission));
    const now = new Date();
    const daysSince = Math.floor((now - lastDate) / (1000 * 60 * 60 * 24));

    if (daysSince < 30) {
      alert("You‚Äôve already submitted a survey this month. Please return next month to complete another check-in.");
      return;
    }
  }

  // Save submission data
  saveFormData();
  formData.submissionId = "TASK_" + Date.now();
  formData.timestamp = new Date().toISOString();

  // Lock out until next month
  localStorage.setItem("taskLastSubmission", Date.now().toString());

  // Proceed to success page
  document.querySelectorAll("[id^='surveyStep']").forEach(div => div.style.display = "none");
  document.getElementById("surveyStep7").style.display = "block";

  // Narrate success page
  narrateSuccessPage();
}
</script>
<script>
function collectSurveyData() {
  const data = {
    submissionId: "TASK_" + Date.now(),
    timestamp: new Date().toISOString(),
    language: lang,
    stillWorking: formData.stillWorking || "",
    firstName: document.getElementById("firstName")?.value || "",
    lastName: document.getElementById("lastName")?.value || "",
    phone: document.getElementById("phone")?.value || "",
    email: document.getElementById("email")?.value || "",
    preferredContact: document.getElementById("preferredContact")?.value || "",
    monthsEmployed: document.getElementById("monthsEmployed")?.value || "",
    employer: document.getElementById("employerName")?.value || "",
    payRate: document.getElementById("payRate")?.value || "",
    q1: document.getElementById("q1")?.value || "",
    q2: document.getElementById("q2")?.value || "",
    q3: document.getElementById("q3")?.value || "",
    authorization: document.getElementById("authorization")?.checked || false
  };

  console.log("Captured Survey Data:", data);
  return data;
}

// Hook into submitSurvey
function submitSurvey() {
  const lastSubmission = localStorage.getItem("taskLastSubmission");
  if (lastSubmission) {
    const lastDate = new Date(parseInt(lastSubmission));
    const now = new Date();
    const daysSince = Math.floor((now - lastDate) / (1000 * 60 * 60 * 24));
    if (daysSince < 30) {
      alert("You‚Äôve already submitted a survey this month. Please return next month.");
      return;
    }
  }

  // Gather full data
  const submission = collectSurveyData();

  // Save lock
  localStorage.setItem("taskLastSubmission", Date.now().toString());

  // TODO: Send `submission` to backend/Apricot here (future integration)

  // Show success page
  document.querySelectorAll("[id^='surveyStep']").forEach(div => div.style.display = "none");
  document.getElementById("surveyStep7").style.display = "block";

  narrateSuccessPage();
}
</script>
<script>
const narrationScripts = {
  Sean: {
    intro: "Hello, I‚Äôm Sean. I‚Äôll guide you through this survey step by step. We‚Äôll take our time, and I‚Äôll make sure everything is clear for you.",
    step1: "This first question asks if you are still working at your job. Select ‚ÄòYes‚Äô if you are working, or ‚ÄòNo‚Äô if you are not.",
    step2: "Now let‚Äôs enter your contact details. This helps TASK stay in touch and support you better.",
    step3: "Here you can tell us what has helped you do well in your job. Please type in your answer in the box.",
    step4: "This question asks what challenges you face. For example, transportation, housing, or childcare. Write down what TASK can help you with.",
    step5: "Now tell us how TASK has supported you. Things like job search help, interview prep, or work clothes.",
    step6: "Please upload your last two pay stubs. You can upload files or take a picture with your phone.",
    step7: "Here‚Äôs the last part ‚Äî check the authorization box so TASK knows we can follow up with you and give support.",
    success: "Congratulations! You finished the survey. TASK will use your answers to better support you. Don‚Äôt forget, you can earn gift card rewards by completing this each month."
  },

  Diani: {
    intro: "Hi, I‚Äôm Diani! I‚Äôll make sure this survey feels easy and encouraging for you.",
    step1: "Let‚Äôs begin with a simple question. Are you still working? Tap Yes or No to answer.",
    step2: "Great! Now, let‚Äôs add your contact info so TASK can keep helping you.",
    step3: "Next, share what has helped you do well at work. Maybe your boss is supportive or your schedule is flexible.",
    step4: "This part is about challenges. Write what makes work harder, like childcare or travel.",
    step5: "Now, tell us how TASK made a difference in your job journey. This could be training, clothes, or coaching.",
    step6: "Almost done! Please upload your last two pay stubs. You can use your phone to take a picture if that‚Äôs easier.",
    step7: "Last step ‚Äî check the box so TASK can follow up with you and continue supporting you.",
    success: "Yay! You did it! Your survey is submitted. Keep checking in each month to earn rewards and stay connected with TASK."
  },

  Paul: {
    intro: "Hello, I‚Äôm Paul. I‚Äôll guide you calmly and clearly through each question.",
    step1: "The first question is about your job. Please select Yes if you are still working, or No if you are not.",
    step2: "Now we‚Äôll collect your contact information. This is so TASK can reach you when needed.",
    step3: "Please write what has helped you succeed in your job so far.",
    step4: "Next, write what challenges you face that TASK could help with.",
    step5: "Here, explain how TASK has supported you. Be specific so we can understand what‚Äôs helpful.",
    step6: "Now upload your last two pay stubs. This is required to complete the survey.",
    step7: "Please check the authorization box so TASK can continue helping you.",
    success: "Thank you for completing the survey. TASK is here to support your success, and by checking in each month you can earn rewards."
  },

  Mia: {
    intro: "Hi, I‚Äôm Mia. I know surveys can feel stressful, so I‚Äôll guide you gently through this one.",
    step1: "First, tell us if you are still working at your job. Choose Yes or No.",
    step2: "Now let‚Äôs fill in your contact details. That way, TASK can keep in touch with you.",
    step3: "Here, type what has helped you succeed in your job. It could be a supportive manager or good pay.",
    step4: "Next, write what challenges you‚Äôre facing. We want to know so TASK can help.",
    step5: "Please share how TASK has supported you in your job journey.",
    step6: "Now upload your last two pay stubs. You can use your phone camera if that‚Äôs easier.",
    step7: "Last part ‚Äî check the authorization box so TASK can keep helping you.",
    success: "Great job finishing the survey. TASK appreciates your time and wants to support you every month."
  },

  Frank: {
    intro: "Hey, I‚Äôm Frank. I‚Äôll keep things simple and direct while we get this survey done together.",
    step1: "First question ‚Äî are you still working at your job? Select Yes or No.",
    step2: "Next, give us your contact details so TASK can stay in touch.",
    step3: "Write down what has helped you stay successful in your job.",
    step4: "Now share what problems you‚Äôre facing, like transportation or housing.",
    step5: "Tell us how TASK has supported you in your employment journey.",
    step6: "Please upload your two most recent pay stubs.",
    step7: "Check the box to let TASK follow up and continue supporting you.",
    success: "Nice work! You‚Äôve completed the survey. TASK will use this info to keep supporting you, and you‚Äôre also on track to earn rewards."
  },

  Amy: {
    intro: "Hi there, I‚Äôm Amy. I‚Äôll guide you through this survey in a friendly way.",
    step1: "First, let‚Äôs answer if you‚Äôre still working at your job. Just pick Yes or No.",
    step2: "Now let‚Äôs add your contact details. That way TASK can keep supporting you.",
    step3: "Here, write what has helped you do well at your job.",
    step4: "Next, tell us what challenges TASK could help you with.",
    step5: "Now, share how TASK has supported you so far.",
    step6: "Please upload your two most recent pay stubs.",
    step7: "Finally, check the authorization box so TASK can keep helping you.",
    success: "Awesome! You‚Äôve finished the survey. TASK is here to support you, and by checking in each month you can earn rewards."
  }
};
</script>
<script>
const narrationScriptsES = {
  Sean: {
    intro: "Hola, soy Sean. Te guiar√© paso a paso en esta encuesta. Lo haremos con calma y todo quedar√° claro.",
    step1: "La primera pregunta es si todav√≠a trabajas en tu empleo. Marca S√≠ si trabajas o No si no trabajas.",
    step2: "Ahora vamos a escribir tu informaci√≥n de contacto. As√≠ TASK puede comunicarse contigo y apoyarte.",
    step3: "Aqu√≠ puedes decirnos qu√© te ha ayudado a tener √©xito en tu trabajo.",
    step4: "Esta pregunta es sobre los desaf√≠os. Escr√≠belos, como transporte, vivienda o cuidado de ni√±os.",
    step5: "Ahora dinos c√≥mo TASK te ha apoyado. Puede ser en entrevistas, ropa de trabajo o b√∫squeda de empleo.",
    step6: "Sube tus dos √∫ltimos comprobantes de pago. Puedes tomar una foto o subir un archivo.",
    step7: "Marca la casilla de autorizaci√≥n para que TASK pueda darte seguimiento y apoyo.",
    success: "¬°Felicidades! Terminaste la encuesta. TASK usar√° tus respuestas para apoyarte mejor. Recuerda que puedes ganar tarjetas de regalo completando esta encuesta cada mes."
  },

  Diani: {
    intro: "Hola, soy Diani. Har√© que esta encuesta sea f√°cil y positiva para ti.",
    step1: "¬øSigues trabajando? Marca S√≠ o No para contestar.",
    step2: "Muy bien. Ahora escribe tu informaci√≥n de contacto para que TASK pueda ayudarte.",
    step3: "Escribe qu√© te ha ayudado a tener √©xito. Tal vez un jefe amable o un horario flexible.",
    step4: "Esta parte es sobre tus retos. Escribe lo que te complica, como transporte o cuidado infantil.",
    step5: "Ahora dinos c√≥mo TASK ha hecho una diferencia en tu camino laboral.",
    step6: "Ya casi terminamos. Sube tus dos √∫ltimos comprobantes de pago. Puedes usar tu c√°mara.",
    step7: "√öltimo paso ‚Äî marca la casilla de autorizaci√≥n para que TASK pueda darte seguimiento.",
    success: "¬°Muy bien! Enviaste la encuesta. Sigue participando cada mes para ganar recompensas y mantenerte conectado con TASK."
  },

  Paul: {
    intro: "Hola, soy Paul. Te guiar√© con calma y claridad en cada pregunta.",
    step1: "La primera pregunta es sobre tu empleo. Marca S√≠ si trabajas o No si no trabajas.",
    step2: "Ahora vamos a tomar tu informaci√≥n de contacto. As√≠ TASK puede comunicarse contigo.",
    step3: "Escribe qu√© te ha ayudado a tener √©xito en tu trabajo.",
    step4: "Ahora escribe qu√© problemas tienes que TASK pueda ayudarte a resolver.",
    step5: "Cu√©ntanos c√≥mo TASK te ha apoyado. S√© espec√≠fico para que entendamos lo que funciona.",
    step6: "Sube tus dos √∫ltimos comprobantes de pago. Es necesario para terminar la encuesta.",
    step7: "Marca la casilla de autorizaci√≥n para que TASK pueda seguir apoy√°ndote.",
    success: "Gracias por completar la encuesta. TASK est√° aqu√≠ para apoyarte, y al participar cada mes puedes ganar recompensas."
  },

  Mia: {
    intro: "Hola, soy Mia. S√© que las encuestas pueden ser pesadas, pero te guiar√© paso a paso.",
    step1: "Primero dinos si todav√≠a trabajas. Escoge S√≠ o No.",
    step2: "Ahora escribe tus datos de contacto. As√≠ TASK puede seguir en contacto contigo.",
    step3: "Escribe qu√© te ha ayudado a tener √©xito en tu trabajo.",
    step4: "Ahora escribe qu√© dificultades tienes. TASK quiere ayudarte.",
    step5: "Cu√©ntanos c√≥mo TASK te ha apoyado en tu camino laboral.",
    step6: "Sube tus dos √∫ltimos comprobantes de pago. Puedes usar la c√°mara del tel√©fono.",
    step7: "√öltima parte ‚Äî marca la casilla de autorizaci√≥n para que TASK pueda seguir apoy√°ndote.",
    success: "Muy bien, terminaste la encuesta. TASK valora tu tiempo y quiere apoyarte cada mes."
  },

  Frank: {
    intro: "Hola, soy Frank. Har√© esta encuesta simple y r√°pida contigo.",
    step1: "Primera pregunta ‚Äî ¬øsigues trabajando? Marca S√≠ o No.",
    step2: "Ahora escribe tus datos de contacto para que TASK pueda comunicarse contigo.",
    step3: "Escribe qu√© te ha ayudado a tener √©xito en tu trabajo.",
    step4: "Comparte qu√© problemas enfrentas, como transporte o vivienda.",
    step5: "Cu√©ntanos c√≥mo TASK te ha apoyado en tu trabajo.",
    step6: "Sube tus dos √∫ltimos comprobantes de pago.",
    step7: "Marca la casilla de autorizaci√≥n para que TASK pueda seguir en contacto contigo.",
    success: "¬°Bien hecho! Completaste la encuesta. TASK usar√° tus respuestas para seguir apoy√°ndote, y puedes ganar recompensas por participar."
  },

  Amy: {
    intro: "Hola, soy Amy. Te guiar√© de una manera sencilla y amigable.",
    step1: "Primero contesta si todav√≠a trabajas en tu empleo. Escoge S√≠ o No.",
    step2: "Ahora escribe tu informaci√≥n de contacto. As√≠ TASK puede apoyarte.",
    step3: "Escribe qu√© te ha ayudado a tener √©xito en tu trabajo.",
    step4: "Escribe qu√© retos tienes que TASK pueda ayudarte a resolver.",
    step5: "Dinos c√≥mo TASK te ha apoyado hasta ahora.",
    step6: "Sube tus dos √∫ltimos comprobantes de pago.",
    step7: "Por √∫ltimo, marca la casilla de autorizaci√≥n para que TASK pueda seguir apoy√°ndote.",
    success: "¬°Excelente! Terminaste la encuesta. TASK est√° aqu√≠ para apoyarte, y al participar cada mes puedes ganar recompensas."
  }
};
</script>
<script>
const narrationScriptsHT = {
  Sean: {
    intro: "Bonjou, se Sean. M ap ede w f√® sondaj sa etap pa etap. Pran tan w, n ap f√® l fasil.",
    step1: "Premye kesyon an se si w ap toujou travay. Chwazi Wi si w ap travay oswa Non si w pa travay ank√≤.",
    step2: "Kounye a, ranpli enf√≤masyon kontak ou. Sa p√®m√®t TASK rete an kontak av√®k ou pou sip√≤.",
    step3: "Ekri bagay ki ede w kenbe travay ou.",
    step4: "Di nou difikilte w genyen. Sa ka transp√≤, kay, oswa gadri.",
    step5: "Di nou kijan TASK ede w. Pa egzanp nan rech√®ch travay oswa rad pou travay.",
    step6: "Telechaje 2 d√®nye fich peyman ou. Ou ka pran foto oswa chaje fichye yo.",
    step7: "Tcheke bwat otorizasyon an pou TASK ka kontinye sip√≤te ou.",
    success: "F√©licitations! Ou fini sondaj la. TASK ap s√®vi ak repons ou pou ede w plis. Pa bliye, chak mwa w konplete sondaj la, ou ka resevwa kat kado."
  },

  Diani: {
    intro: "Bonjou, se Diani. M ap f√® sondaj sa vin pi fasil pou ou.",
    step1: "Ou toujou travay? Chwazi Wi oswa Non.",
    step2: "Kounye a, antre enf√≤masyon kontak ou pou TASK ka ede w.",
    step3: "Ekri sa ki ede w reyisi nan travay ou. Tankou yon ch√®f ki janti oswa yon or√® fleksib.",
    step4: "Kote ki difisil pou ou? Ekri yo pou TASK ka ede w.",
    step5: "Rakonte kijan TASK f√® yon diferans nan lavi travay ou.",
    step6: "N ap pr√®ske fini. Telechaje 2 d√®nye fich peyman ou.",
    step7: "D√®nye etap la ‚Äî tcheke bwat otorizasyon an pou TASK ka kontinye kontakte ou.",
    success: "Tr√® byen! Ou voye sondaj la. Kontinye patisipe chak mwa pou jwenn rekonpans epi rete konekte ak TASK."
  },

  Paul: {
    intro: "Bonjou, se Paul. M ap ede w pran chak kesyon ak trankilite.",
    step1: "Kesyon an se sou travay ou. Chwazi Wi si w ap travay, Non si w pa travay.",
    step2: "Ranpli enf√≤masyon kontak ou. Sa ap ede TASK pale av√® w l√® sa neses√®.",
    step3: "Ekri sa ki ede w kenbe travay ou.",
    step4: "Kounye a, di nou ki pwobl√®m w ap f√® fas ak yo.",
    step5: "Eksplike kijan TASK te ede w deja.",
    step6: "Telechaje 2 d√®nye fich peyman ou. Sa neses√® pou fini sondaj la.",
    step7: "Tcheke bwat otorizasyon an pou TASK ka kontinye ede w.",
    success: "M√®si paske ou ranpli sondaj la. TASK toujou la pou ede w, epi ou ka resevwa rekonpans si ou kontinye patisipe chak mwa."
  },

  Mia: {
    intro: "Bonjou, se Mia. Mwen konnen pafwa sondaj yo long, men m ap ede w f√® sa fasil.",
    step1: "Premye etap la ‚Äî di si w toujou travay. Chwazi Wi oswa Non.",
    step2: "Kounye a, antre enf√≤masyon kontak ou pou TASK ka pale ak ou.",
    step3: "Ekri sa ki ede w reyisi nan travay ou.",
    step4: "Di nou difikilte w genyen. TASK vle ede w ak sa yo.",
    step5: "Eksplike kijan TASK f√® yon diferans pou ou.",
    step6: "Telechaje 2 d√®nye fich peyman ou. Ou ka pran foto.",
    step7: "D√®nye etap ‚Äî tcheke bwat otorizasyon an pou TASK ka kontinye ba ou sip√≤.",
    success: "Tr√® byen, ou fini sondaj la. TASK apresye tan ou epi n ap toujou sip√≤te ou."
  },

  Frank: {
    intro: "Bonjou, se Frank. Ann f√® sondaj sa rapid epi senp.",
    step1: "Premye kesyon ‚Äî √®ske w toujou travay? Chwazi Wi oswa Non.",
    step2: "Antre detay kontak ou pou TASK ka rete an kontak av√®k ou.",
    step3: "Ekri sa ki ede w reyisi nan travay ou.",
    step4: "Di nou difikilte yo, tankou transp√≤ oswa kay.",
    step5: "Rakonte kijan TASK ede w nan travay ou.",
    step6: "Telechaje 2 d√®nye fich peyman ou.",
    step7: "Tcheke bwat otorizasyon an pou TASK ka kontinye pale av√®k ou.",
    success: "Bon travay! Ou fini sondaj la. TASK ap s√®vi ak sa ou ekri pou ede w plis, e ou ka resevwa rekonpans."
  },

  Amy: {
    intro: "Bonjou, se Amy. M ap ede w av√®k sa yon fason senp ak zanmitay.",
    step1: "Premye kesyon ‚Äî √®ske w toujou travay? Chwazi Wi oswa Non.",
    step2: "Kounye a, antre enf√≤masyon kontak ou.",
    step3: "Ekri sa ki ede w reyisi nan travay ou.",
    step4: "Di nou difikilte w genyen pou TASK ka ede w.",
    step5: "Eksplike kijan TASK te ede w nan travay ou.",
    step6: "Telechaje 2 d√®nye fich peyman ou.",
    step7: "D√®nye etap ‚Äî tcheke bwat otorizasyon an pou TASK ka kontinye ede w.",
    success: "Ekselan! Ou fini sondaj la. TASK toujou la pou sip√≤te ou, e ou ka jwenn rekonpans si w kontinye patisipe."
  }
};
</script>
<script>
let selectedNarrator = "Sean";
let isAutoAdvance = false;
let isPlaying = false;
let currentStep = 0;
let utterance;
let synth = window.speechSynthesis;

function setNarrator(name) {
  selectedNarrator = name;
  alert(`Narrator switched to ${name}`);
}

function setAdvanceMode(mode) {
  isAutoAdvance = (mode === "auto");
  alert(`Advance mode set to ${isAutoAdvance ? "Auto" : "Manual"}`);
}

function narrateStep(step) {
  stopNarration();

  const scripts = {
    en: narrationScriptsEN,
    es: narrationScriptsES,
    ht: narrationScriptsHT
  };

  const scriptSet = scripts[lang];
  if (!scriptSet || !scriptSet[selectedNarrator]) return;

  let text;
  switch(step) {
    case 0: text = scriptSet[selectedNarrator].intro; break;
    case 1: text = scriptSet[selectedNarrator].step1; break;
    case 2: text = scriptSet[selectedNarrator].step2; break;
    case 3: text = scriptSet[selectedNarrator].step3; break;
    case 4: text = scriptSet[selectedNarrator].step4; break;
    case 5: text = scriptSet[selectedNarrator].step5; break;
    case 6: text = scriptSet[selectedNarrator].step6; break;
    case 7: text = scriptSet[selectedNarrator].step7; break;
    case 8: text = scriptSet[selectedNarrator].success; break;
  }

  if (!text) return;

  utterance = new SpeechSynthesisUtterance(text);
  synth.speak(utterance);

  isPlaying = true;

  utterance.onend = () => {
    isPlaying = false;
    if (isAutoAdvance && currentStep < 8) {
      currentStep++;
      narrateStep(currentStep);
    }
  };
}

function playNarration(step = currentStep) {
  currentStep = step;
  narrateStep(currentStep);
}

function pauseNarration() {
  if (synth.speaking) synth.pause();
}

function resumeNarration() {
  if (synth.paused) synth.resume();
}

function stopNarration() {
  synth.cancel();
  isPlaying = false;
}

// Call this on success page
function narrateSuccessPage() {
  currentStep = 8;
  narrateStep(currentStep);
}
</script>

<!-- Controls UI -->
<div id="narrationControls" style="margin:20px; padding:15px; border:2px solid #facc15; border-radius:12px; background:#fff8db;">
  <h3 style="margin:0 0 10px; color:#145078;">üéß Narration Controls</h3>
  
  <label for="narratorSelect">Choose Narrator:</label>
  <select id="narratorSelect" onchange="setNarrator(this.value)">
    <option value="Sean">Sean</option>
    <option value="Diani">Diani</option>
    <option value="Paul">Paul</option>
    <option value="Mia">Mia</option>
    <option value="Frank">Frank</option>
    <option value="Amy">Amy</option>
  </select>

  <label for="advanceMode" style="margin-left:15px;">Advance Mode:</label>
  <select id="advanceMode" onchange="setAdvanceMode(this.value)">
    <option value="manual">Manual</option>
    <option value="auto">Auto</option>
  </select>

  <div style="margin-top:10px;">
    <button onclick="playNarration()">‚ñ∂Ô∏è Play</button>
    <button onclick="pauseNarration()">‚è∏Ô∏è Pause</button>
    <button onclick="resumeNarration()">üîÑ Resume</button>
    <button onclick="stopNarration()">‚èπÔ∏è Stop</button>
    <button onclick="if(currentStep>0){currentStep--; playNarration()}">‚¨ÖÔ∏è Prev</button>
    <button onclick="if(currentStep<8){currentStep++; playNarration()}">‚û°Ô∏è Next</button>
  </div>
</div>
