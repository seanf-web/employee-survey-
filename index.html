<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TASK Monthly Employment Check-In</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f7fb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 40px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h2 {
      color: #145078;
      margin-bottom: 10px;
    }
    label {
      font-weight: bold;
      color: #333;
      display: block;
      margin: 12px 0 6px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #ccc;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #ff911f;
      box-shadow: 0 0 5px rgba(255,145,31,0.4);
    }
    .btn {
      background: #145078;
      color: #fff;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 5px 0 0;
    }
    .btn:hover { background: #0f3c5a; }
    .btn-secondary {
      background: #ccc;
      color: #333;
    }
    .btn-secondary:hover { background: #aaa; }
    .progress {
      height: 10px;
      background: #ddd;
      border-radius: 5px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    .progress-bar {
      height: 10px;
      background: #ff911f;
      width: 0;
      transition: width 0.3s ease;
    }
    .success-card {
      text-align: center;
      color: #145078;
    }
    .success-card h1 {
      color: green;
    }
    .info-box {
      margin-top: 20px;
      background: #e8f5ff;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #b3d7f5;
    }
    .reset-btn {
      margin-top: 20px;
      font-size: 12px;
      background: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="survey"></div>
  </div>

  <script>
    const steps = [
      { id: 1, label: "Contact Info" },
      { id: 2, label: "Employment Status" },
      { id: 3, label: "Verification" },
      { id: 4, label: "Confirmation" }
    ];

    let page = 1;
    let formData = {
      fullName: "",
      phone: "",
      email: "",
      preferredContact: "",
      employer: "",
      jobTitle: "",
      startDate: "",
      stillWorking: "",
      payStubs: [],
      photo: null
    };

    const surveyDiv = document.getElementById("survey");

    function renderProgress() {
      return `
        <div class="progress">
          <div class="progress-bar" style="width: ${(page-1)/(steps.length-1)*100}%"></div>
        </div>
      `;
    }

    function renderPage() {
      const thisMonth = new Date().getMonth();
      if (localStorage.getItem("lastSubmittedMonth") == thisMonth && page !== 4) {
        surveyDiv.innerHTML = `
          <div class="success-card">
            <h1>âœ… Already Submitted</h1>
            <p>You have already completed this month's survey. Thank you!</p>
          </div>
          <button class="btn reset-btn" onclick="resetSurvey()">Reset (Testing)</button>
        `;
        return;
      }

      let html = renderProgress();
      if (page === 1) {
        html += `
          <h2>Monthly Employment Check-In</h2>
          <label>Full Name *</label>
          <input type="text" id="fullName" value="${formData.fullName}" required />

          <label>Phone *</label>
          <input type="tel" id="phone" value="${formData.phone}" required />

          <label>Email *</label>
          <input type="email" id="email" value="${formData.email}" required />

          <label>Preferred Contact Method *</label>
          <select id="preferredContact">
            <option value="">Select...</option>
            <option ${formData.preferredContact=="Phone"?"selected":""}>Phone</option>
            <option ${formData.preferredContact=="Email"?"selected":""}>Email</option>
            <option ${formData.preferredContact=="Text"?"selected":""}>Text</option>
          </select>

          <button class="btn" onclick="nextPage()">Continue</button>
        `;
      }
      if (page === 2) {
        html += `
          <h2>Step 2: Employment Status</h2>
          <label>Employer *</label>
          <input type="text" id="employer" value="${formData.employer}" required />

          <label>Job Title *</label>
          <input type="text" id="jobTitle" value="${formData.jobTitle}" required />

          <label>Start Date *</label>
          <input type="date" id="startDate" value="${formData.startDate}" required />

          <label>Are you still employed? *</label>
          <select id="stillWorking">
            <option value="">Select...</option>
            <option ${formData.stillWorking=="Yes"?"selected":""}>Yes</option>
            <option ${formData.stillWorking=="No"?"selected":""}>No</option>
          </select>

          <button class="btn-secondary btn" onclick="prevPage()">Back</button>
          <button class="btn" onclick="nextPage()">Continue</button>
        `;
      }
      if (page === 3) {
        html += `
          <h2>Monthly Employment Check-In</h2>
          <label>Upload Pay Stubs (2 required) *</label>
          <input type="file" id="payStubs" multiple accept=".pdf,image/*" />

          <label>Or Take a Picture *</label>
          <input type="file" id="photo" accept="image/*" capture="environment" />

          <button class="btn-secondary btn" onclick="prevPage()">Back</button>
          <button class="btn" onclick="nextPage()">Submit</button>
        `;
      }
      if (page === 4) {
        localStorage.setItem("lastSubmittedMonth", thisMonth);
        html += `
          <div class="success-card">
            <h1>ðŸŽ‰ Survey Completed!</h1>
            <p>Thank you for your continued commitment to employment success through TASK.</p>
          </div>
          <div class="info-box">
            <h3>âœ… Next Steps</h3>
            <p>Please visit the <strong>TASK Employment Office</strong> to pick up your gift card reward.</p>
            <p><strong>Hours:</strong><br>
              Office: Mondayâ€“Friday 9:00 AM â€“ 4:00 PM<br>
              Lunch: Mondayâ€“Saturday 10:30 AM â€“ 1:00 PM<br>
              Dinner: Mondayâ€“Thursday 3:30 PM â€“ 5:00 PM
            </p>
            <p><strong>Phone:</strong> 609-697-6215, 609-697-6166</p>
          </div>
          <button class="btn reset-btn" onclick="resetSurvey()">ðŸ”„ Reset (Testing)</button>
        `;
      }
      surveyDiv.innerHTML = html;
    }

    function nextPage() {
      if (page === 1) {
        formData.fullName = document.getElementById("fullName").value.trim();
        formData.phone = document.getElementById("phone").value.trim();
        formData.email = document.getElementById("email").value.trim();
        formData.preferredContact = document.getElementById("preferredContact").value;
        if (!formData.fullName || !formData.phone || !formData.email || !formData.preferredContact) {
          alert("Please fill out all required fields.");
          return;
        }
      }
      if (page === 2) {
        formData.employer = document.getElementById("employer").value.trim();
        formData.jobTitle = document.getElementById("jobTitle").value.trim();
        formData.startDate = document.getElementById("startDate").value;
        formData.stillWorking = document.getElementById("stillWorking").value;
        if (!formData.employer || !formData.jobTitle || !formData.startDate || !formData.stillWorking) {
          alert("Please fill out all required fields.");
          return;
        }
      }
      if (page === 3) {
        const payStubs = document.getElementById("payStubs").files;
        const photo = document.getElementById("photo").files[0];

        // âœ… FIXED: allow either 2+ paystubs OR 1 photo
        if (payStubs.length >= 2) {
          formData.payStubs = payStubs;
        } else if (photo) {
          formData.photo = photo;
        } else {
          alert("Please upload at least 2 pay stubs OR take 1 picture.");
          return;
        }
      }
      if (page < steps.length) page++;
      renderPage();
    }

    function prevPage() {
      if (page > 1) page--;
      renderPage();
    }

    function resetSurvey() {
      localStorage.removeItem("lastSubmittedMonth");
      page = 1;
      formData = {
        fullName: "", phone: "", email: "", preferredContact: "",
        employer: "", jobTitle: "", startDate: "", stillWorking: "",
        payStubs: [], photo: null
      };
      renderPage();
    }

    renderPage();
  </script>
</body>
</html>
