<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TASK Monthly Employment Check-In</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }
    .header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .lang-select {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .progress {
      display: flex;
      justify-content: space-between;
      flex: 1;
      margin-left: 30px;
      counter-reset: step;
    }
    .step {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #ccc;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      margin: 0 10px;
    }
    .step.active {
      background: #145078;
    }
    h1, h2 {
      color: #145078;
      text-align: center;
    }
    h1 { font-size: 2.5em; }
    h2 { font-size: 2em; margin-bottom: 10px; }
    .task-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .task-logo {
      font-size: 3em;
      font-weight: bold;
      color: #145078;
    }
    .powered-by {
      background: #145078;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 10px;
      font-weight: bold;
      display: inline-block;
      margin-bottom: 10px;
    }
    .participants-only {
      background: #dc2626;
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: bold;
      display: inline-block;
      margin-bottom: 20px;
    }
    .highlight-box {
      border: 2px solid #facc15;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }
    .radio-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .radio-option {
      display: flex;
      align-items: center;
      padding: 15px;
      border: 2px solid #86efac;
      border-radius: 12px;
      cursor: pointer;
    }
    .radio-option input {
      margin-right: 10px;
      transform: scale(1.2);
      width: auto;
    }
    .btn {
      padding: 14px 24px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 5px 0 0;
      background: linear-gradient(135deg, #145078, #33a7b5);
      color: white;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="survey"></div>
  </div>

<script>
let page = 1;
let formData = {};
let lang = "en";

const translations = {
  en: {
    continue: "Continue",
    back: "Back",
    submit: "Submit Monthly Report",
    stillWorking: "Are you still employed at this TASK-assisted job? *",
    yesEmployed: "Yes, still employed",
    noEmployed: "No longer employed",
    yesHelper: "Great job maintaining employment",
    noHelper: "We are here to help you find another job",
    completeRequired: "Please complete all required fields before continuing.",
    stopMessage: "You are no longer eligible to complete this survey. Please contact TASK."
  }
  // (Add es and ht versions if needed)
};
function renderPage() {
  const t = translations[lang];
  let html = "";

  // Step 1: Employment Status FIRST
  if (page === 1) {
    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step">2</div>
          <div class="step">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${t.stillWorking}</h2>

      <div class="highlight-box green">
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="stillWorking" value="yes"
              ${formData.stillWorking === 'yes' ? 'checked' : ''}
              onchange="toggleEmployment(true)">
            <div>
              <div style="font-weight: bold; color: #145078;">${t.yesEmployed}</div>
              <div style="font-size: 12px; color: #16a34a;">${t.yesHelper}</div>
            </div>
          </label>
          <label class="radio-option" style="border-color: #fca5a5;">
            <input type="radio" name="stillWorking" value="no"
              ${formData.stillWorking === 'no' ? 'checked' : ''}
              onchange="toggleEmployment(false)">
            <div>
              <div style="font-weight: bold; color: #145078;">${t.noEmployed}</div>
              <div style="font-size: 12px; color: #dc2626;">${t.noHelper}</div>
            </div>
          </label>
        </div>
      </div>

      <div id="continueBtn" style="text-align:right; ${formData.stillWorking === 'yes' ? '' : 'display:none;'}">
        <button class="btn" onclick="nextPage()">${t.continue} ‚Üí</button>
      </div>

      <div id="stopMessage" style="color:#dc2626; font-weight:bold; text-align:center; margin-top:20px; ${formData.stillWorking === 'no' ? '' : 'display:none;'}">
        ${t.stopMessage}
      </div>
    `;
  }
  // Step 2: Contact Information
  if (page === 2) {
    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>Step 2: Contact Information</h2>
      <p class="blurb">We collect your contact info so TASK can stay in touch and provide support.</p>

      <div class="grid-2">
        <div>
          <label>First Name *</label>
          <input id="firstName" required value="${formData.firstName || ''}">
        </div>
        <div>
          <label>Last Name *</label>
          <input id="lastName" required value="${formData.lastName || ''}">
        </div>
        <div>
          <label>Phone Number *</label>
          <input id="phone" type="tel" oninput="formatPhone(this)" required value="${formData.phone || ''}">
        </div>
        <div>
          <label>Email *</label>
          <input id="email" type="email" required value="${formData.email || ''}">
        </div>
      </div>

      <label>Preferred Contact Method</label>
      <select id="preferredContact">
        ${["Phone", "Email", "Text Message"].map((option) => 
          `<option value="${option}" ${formData.preferredContact === option ? 'selected' : ''}>${option}</option>`
        ).join('')}
      </select>

      <div class="highlight-box yellow">
        <label style="font-size: 18px; font-weight: bold;">How many months have you been employed through TASK's job placement program? *</label>
        <select id="monthsEmployed" style="border-color: #facc15; font-size: 16px; font-weight: 600;" required>
          <option value="">Select months employed...</option>
          ${Array.from({length: 120}, (_, i) => {
            const m = i+1;
            return `<option value="${m}" ${formData.monthsEmployed == m ? 'selected' : ''}>${m} month${m>1?"s":""}</option>`;
          }).join('')}
        </select>
      </div>

      <div style="display: flex; justify-content: space-between;">
        <button class="btn" onclick="prevPage()">‚Üê ${t.back}</button>
        <button class="btn" onclick="nextPage()">${t.continue} ‚Üí</button>
      </div>
    `;
  }
  // Step 3: Survey and Upload
  if (page === 3) {
    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
            <option value="es" ${lang === 'es' ? 'selected' : ''}>Espa√±ol</option>
            <option value="ht" ${lang === 'ht' ? 'selected' : ''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step active">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>Step 3: Monthly Documentation & Support</h2>
      <p class="blurb">Share your feedback and upload employment verification</p>

      <div class="highlight-box green">
        <label>What has helped you stay successful in your TASK-assisted job?</label>
        <textarea id="q1" rows="4" placeholder="Supportive management, flexible schedule, good pay...">${formData.q1 || ''}</textarea>
      </div>

      <div class="highlight-box orange">
        <label>What ongoing challenges can TASK help you address?</label>
        <textarea id="q2" rows="4" placeholder="Transportation, childcare, housing, financial stress...">${formData.q2 || ''}</textarea>
      </div>

      <div class="highlight-box blue">
        <label>How has TASK support made a difference in your employment journey?</label>
        <textarea id="q3" rows="4" placeholder="Job search assistance, interview prep, work clothes...">${formData.q3 || ''}</textarea>
      </div>

      <div class="highlight-box yellow">
        <h3 style="font-size: 20px; color: #145078;">Monthly Employment Verification</h3>
        <p style="font-size: 16px; color: #145078;">Required: Upload or photograph your last 2 pay stubs</p>

        <div class="upload-options" style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:15px;">
          <div class="upload-box">
            <input type="file" id="payStubCamera" accept="image/*" capture="environment" style="display:none;" onchange="previewFile(this,'cameraPreview')">
            <button class="btn" onclick="document.getElementById('payStubCamera').click()">üì∑ Take Photo</button>
            <div id="cameraPreview" class="preview"></div>
          </div>
          <div class="upload-box">
            <input type="file" id="payStubFile" accept=".pdf,image/*" multiple style="display:none;" onchange="previewFile(this,'filePreview')">
            <button class="btn" onclick="document.getElementById('payStubFile').click()">üìÅ Choose Files</button>
            <div id="filePreview" class="preview"></div>
          </div>
        </div>
      </div>

      <div class="highlight-box blue">
        <label style="display:flex; align-items:start; cursor:pointer;">
          <input type="checkbox" id="authorization" style="margin-top:6px; margin-right:12px; transform:scale(1.2); width:auto;">
          <div>
            <span style="font-size: 18px; font-weight: bold; color: #145078;">Authorization *</span>
            <div style="font-size: 14px; margin-top: 8px; color: #145078;">
              <p>I authorize TASK to:</p>
              <div>
                <div>‚Ä¢ Contact me monthly for employment check-ins and support</div>
                <div>‚Ä¢ Provide information about additional resources and services</div>
                <div>‚Ä¢ Connect me with emergency assistance if needed</div>
                <div>‚Ä¢ Follow up if employment status changes</div>
              </div>
            </div>
          </div>
        </label>
      </div>

      <div style="display:flex; justify-content:space-between;">
        <button class="btn" onclick="prevPage()">‚Üê ${t.back}</button>
        <button class="btn" onclick="submitSurvey()">${t.submit}</button>
      </div>
    `;
  }
  // Step 4: Success Page
  if (page === 4) {
    html = `
      <div style="text-align:center;">
        <div style="font-size:80px; margin-bottom:20px;">üéâ</div>
        <h1 style="color:#16a34a;">Monthly Report Submitted Successfully!</h1>
        <p style="font-size:20px; color:#6b7280; margin-bottom:30px;">
          Thank you for your continued commitment to employment success through TASK!
        </p>

        <div class="highlight-box green" style="text-align:left;">
          <h2 style="color:#145078;">TASK Employment Office</h2>
          <div class="contact-item">
            <span style="font-size:20px;">üìç</span>
            <div>
              <div style="font-weight:bold; font-size:16px;">Trenton Area Soup Kitchen</div>
              <div style="font-size:14px;">72¬Ω Escher St, Trenton, NJ 08609</div>
            </div>
          </div>
          <div class="contact-item" style="margin-top:10px;">
            <span style="font-size:20px;">üìû</span>
            <div>
              <div style="font-weight:bold;">Employment Office</div>
              <div style="font-size:14px;">Phone Number</div>
            </div>
          </div>
          <div class="contact-item" style="margin-top:10px;">
            <span style="font-size:20px;">üïê</span>
            <div>
              <div style="font-weight:bold;">Meal Time Hours</div>
              <div style="font-size:14px;">Mon-Fri: 10:30 AM - 1:00 PM</div>
              <div style="font-size:14px;">Mon-Thu: 3:30 PM - 5:00 PM</div>
            </div>
          </div>
          <div class="contact-item" style="margin-top:10px;">
            <span style="font-size:20px;">üåê</span>
            <div>
              <div style="font-weight:bold;">Online</div>
              <div style="font-size:14px;">trentonsoupkitchen.org</div>
            </div>
          </div>
        </div>

        <div class="highlight-box yellow" style="text-align:center;">
          <div style="font-size:22px; font-weight:bold; color:#166534; margin-bottom:10px;">
            üíµ Reward Program
          </div>
          <p style="color:#166534; font-weight:500;">
            Complete monthly surveys and maintain employment to earn gift card rewards! 
            Visit our Employment Office to claim your incentive.
          </p>
        </div>

        <div style="margin-top:30px;">
          <button class="btn" onclick="resetForm()" style="background:#6b7280;">Start New Report (Testing)</button>
        </div>
      </div>
    `;
  }
  document.getElementById("survey").innerHTML = html;
}

// Toggle employment eligibility
function toggleEmployment(isEmployed) {
  formData.stillWorking = isEmployed ? "yes" : "no";
  if (isEmployed) {
    document.getElementById("continueBtn").style.display = "";
    document.getElementById("stopMessage").style.display = "none";
  } else {
    document.getElementById("continueBtn").style.display = "none";
    document.getElementById("stopMessage").style.display = "";
  }
}

// Save form data before switching pages
function saveFormData() {
  if (page === 2) {
    formData.firstName = document.getElementById("firstName")?.value || "";
    formData.lastName = document.getElementById("lastName")?.value || "";
    formData.phone = document.getElementById("phone")?.value || "";
    formData.email = document.getElementById("email")?.value || "";
    formData.preferredContact = document.getElementById("preferredContact")?.value || "";
    formData.monthsEmployed = document.getElementById("monthsEmployed")?.value || "";
  }
  if (page === 3) {
    formData.q1 = document.getElementById("q1")?.value || "";
    formData.q2 = document.getElementById("q2")?.value || "";
    formData.q3 = document.getElementById("q3")?.value || "";
    formData.authorization = document.getElementById("authorization")?.checked || false;
  }
}

// Validation
function validatePage() {
  if (page === 2) {
    const required = ["firstName", "lastName", "phone", "email", "monthsEmployed"];
    for (let field of required) {
      const el = document.getElementById(field);
      if (!el?.value.trim()) {
        alert(translations[lang].completeRequired);
        el?.focus();
        return false;
      }
    }
  }
  if (page === 3) {
    const payStubCamera = document.getElementById("payStubCamera")?.files.length || 0;
    const payStubFile = document.getElementById("payStubFile")?.files.length || 0;
    const authChecked = document.getElementById("authorization")?.checked;
    if (payStubCamera + payStubFile < 1) {
      alert("Please upload at least one pay stub before submitting.");
      return false;
    }
    if (!authChecked) {
      alert(translations[lang].completeRequired);
      return false;
    }
  }
  return true;
}

// Navigation
function nextPage() {
  if (!validatePage()) return;
  saveFormData();
  page++;
  renderPage();
}

function prevPage() {
  saveFormData();
  page--;
  renderPage();
}

// Submit
function submitSurvey() {
  if (!validatePage()) return;
  saveFormData();

  formData.submissionId = "TASK_" + Date.now();
  formData.timestamp = new Date().toISOString();

  // Save submission timestamp for rate limiting
  localStorage.setItem("taskFormSubmitted", Date.now().toString());

  console.log("Form submitted:", formData);

  page = 4;
  renderPage();
}

// Reset for testing
function resetForm() {
  if (confirm("Are you sure you want to start a new report?")) {
    localStorage.removeItem("taskFormSubmitted");
    page = 1;
    formData = {};
    renderPage();
  }
}

// Format phone number
function formatPhone(input) {
  let val = input.value.replace(/\D/g, "");
  if (val.length > 3 && val.length <= 6) {
    input.value = `(${val.slice(0, 3)}) ${val.slice(3)}`;
  } else if (val.length > 6) {
    input.value = `(${val.slice(0, 3)}) ${val.slice(3, 6)}-${val.slice(6, 10)}`;
  } else {
    input.value = val;
  }
}

// Preview uploaded files
function previewFile(input, previewId) {
  const preview = document.getElementById(previewId);
  preview.innerHTML = "";
  if (input.files.length > 0) {
    const fileCount = document.createElement("p");
    fileCount.textContent = `${input.files.length} file(s) selected`;
    fileCount.style.fontWeight = "bold";
    fileCount.style.color = "#16a34a";
    fileCount.style.marginBottom = "10px";
    preview.appendChild(fileCount);
  }
  Array.from(input.files).forEach(file => {
    if (file.type.startsWith("image/")) {
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement("img");
        img.src = e.target.result;
        img.style.maxWidth = "120px";
        img.style.margin = "5px";
        preview.appendChild(img);
      };
      reader.readAsDataURL(file);
    } else {
      const fileDiv = document.createElement("div");
      fileDiv.style.background = "#f3f4f6";
      fileDiv.style.border = "1px solid #d1d5db";
      fileDiv.style.borderRadius = "6px";
      fileDiv.style.padding = "8px";
      fileDiv.style.margin = "5px";
      fileDiv.textContent = file.name;
      preview.appendChild(fileDiv);
    }
  });
}

// Initialize
renderPage();
</script>
</body>
</html>
