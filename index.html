<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TASK Monthly Employment Check-In</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }
    .header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .step {
      width: 50px; height: 50px; border-radius: 50%;
      background: #ccc; color: white; display: flex;
      align-items: center; justify-content: center;
      font-weight: bold; font-size: 18px;
    }
    .step.active { background: #145078; }
    h1,h2 { color:#145078; text-align:center; }
    h1{ font-size:2.3em; } h2{ font-size:1.9em; margin-bottom:10px; }

    label { font-weight:bold; display:block; margin:12px 0 6px; color:#333; }
    input, select, textarea {
      width:100%; padding:14px 16px; border:2px solid #d1d5db;
      border-radius:14px; font-size:16px; margin-bottom:18px;
      box-sizing:border-box; transition:all 0.2s ease;
    }
    input:focus,select:focus,textarea:focus {
      border-color:#33a7b5; box-shadow:0 0 6px rgba(51,167,181,0.4);
      outline:none;
    }
    textarea { min-height:100px; resize:vertical; border-radius:14px; }

    .btn {
      padding:14px 26px; border:none; border-radius:14px;
      font-weight:bold; cursor:pointer; margin:10px 5px 0 0;
      background:linear-gradient(135deg,#145078,#33a7b5); color:white;
      transition:all 0.2s ease;
    }
    .btn:hover { transform:translateY(-2px); box-shadow:0 4px 10px rgba(0,0,0,0.2); }

    .radio-card {
      border:2px solid #d1d5db; border-radius:14px; padding:20px;
      text-align:center; cursor:pointer; background:#fafafa; transition:all 0.2s ease;
    }
    .radio-card:hover { background:#f1f5f9; }
    .radio-card input { margin-top:12px; transform:scale(1.3); }

    .upload-box {
      border:2px dashed #93c5fd; border-radius:14px;
      padding:25px; text-align:center; cursor:pointer; background:#f9fafb;
    }
    .upload-box:hover { background:#eff6ff; }
    .preview img { max-width:140px; margin:6px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.15); }
    .preview div.file-name { background:#f3f4f6; border:1px solid #d1d5db; border-radius:6px; padding:8px; margin:5px; font-size:14px; }

    /* Demo highlight */
    .demo-highlight {
      animation: pulse 2s infinite;
      border-color: #f59e0b !important;
      background-color: #fffbeb !important;
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.5) !important;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.5); }
      50% { box-shadow: 0 0 30px rgba(245, 158, 11, 0.8); }
      100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.5); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="survey"></div>
  </div>

  <!-- Demo Overlay -->
  <div id="demoOverlay" class="demo-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); display:flex; align-items:center; justify-content:center; z-index:1000;">
    <div class="demo-content" style="background:white; padding:40px; border-radius:20px; max-width:600px; text-align:center;">
      <h2 style="color:#145078; margin-bottom:20px;">Welcome to TASK Monthly Survey</h2>
      <p style="font-size:18px; margin-bottom:20px;">Would you like a guided tutorial?</p>

      <!-- Tutorial Mode -->
      <div class="voice-selector" style="margin-bottom:20px;">
        <h3 style="color:#0284c7; margin-bottom:10px;">Tutorial Style</h3>
        <label style="display:flex; align-items:center; margin:6px 0;">
          <input type="radio" name="tutorialMode" value="auto" checked style="margin-right:8px;"> Auto-Advance (plays full demo)
        </label>
        <label style="display:flex; align-items:center; margin:6px 0;">
          <input type="radio" name="tutorialMode" value="pause" style="margin-right:8px;"> Pause Mode (you click through)
        </label>
      </div>

      <button class="btn" onclick="startTutorial()">üé¨ Start Tutorial</button>
      <button class="btn" style="background:#6b7280; margin-top:10px;" onclick="skipTutorial()">Skip Tutorial & Start Survey</button>
    </div>
  </div>
<script>
let page = 1;
let formData = {};
let lang = "en";
let isDemoMode = false;
let tutorialMode = "auto";
let demoStep = 0;
let demoTimeout;

/* ===== Translations ===== */
const translations = {
  en: {
    continue: "Continue",
    back: "Back",
    submit: "Submit Monthly Report",
    stillWorking: "Are you still employed at this TASK-assisted job? *",
    yesEmployed: "Yes, still employed",
    noEmployed: "No longer employed",
    yesHelper: "Great job maintaining employment",
    noHelper: "We are here to help you find another job",
    completeRequired: "Please complete all required fields before continuing.",
    stopMessage: "You are no longer eligible to complete this survey. Please contact TASK."
  },
  es: {
    continue: "Continuar",
    back: "Atr√°s",
    submit: "Enviar Informe Mensual",
    stillWorking: "¬øSigues empleado en este trabajo asistido por TASK? *",
    yesEmployed: "S√≠, sigo empleado",
    noEmployed: "Ya no estoy empleado",
    yesHelper: "¬°Excelente trabajo manteniendo el empleo!",
    noHelper: "Estamos aqu√≠ para ayudarte a encontrar otro trabajo",
    completeRequired: "Por favor completa todos los campos requeridos antes de continuar.",
    stopMessage: "Ya no eres elegible para completar esta encuesta. Por favor contacta a TASK."
  },
  ht: {
    continue: "Kontinye",
    back: "Retounen",
    submit: "Soum√®t Rap√≤ Chak Mwa",
    stillWorking: "√àske w ap toujou travay nan travay TASK te ede w jwenn lan? *",
    yesEmployed: "Wi, toujou ap travay",
    noEmployed: "Mwen pa travay ank√≤",
    yesHelper: "Bon travay kenbe travay la!",
    noHelper: "Nou la pou ede ou jwenn yon l√≤t travay",
    completeRequired: "Tanpri ranpli tout chan obligatwa yo anvan ou kontinye.",
    stopMessage: "Ou pa elijib pou konplete sondaj sa ank√≤. Tanpri kontakte TASK."
  }
};

/* ===== Language Toggle ===== */
function setLanguage(l) {
  lang = l;
  localStorage.setItem("taskLanguage", l);
  renderPage();
}

/* ===== Render Page ===== */
function renderPage() {
  const t = translations[lang];
  let html = "";

  /* Step 1: Employment Status */
  if (page === 1) {
    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang==='en'?'selected':''}>English</option>
            <option value="es" ${lang==='es'?'selected':''}>Espa√±ol</option>
            <option value="ht" ${lang==='ht'?'selected':''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step">2</div>
          <div class="step">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${t.stillWorking}</h2>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px;">
        <label class="radio-card">
          <div style="font-weight:bold; color:#145078;">${t.yesEmployed}</div>
          <div style="font-size:13px; color:#16a34a;">${t.yesHelper}</div>
          <input type="radio" name="stillWorking" value="yes" ${formData.stillWorking==='yes'?'checked':''} onchange="toggleEmployment(true)">
        </label>
        <label class="radio-card" style="border-color:#fca5a5;">
          <div style="font-weight:bold; color:#145078;">${t.noEmployed}</div>
          <div style="font-size:13px; color:#dc2626;">${t.noHelper}</div>
          <input type="radio" name="stillWorking" value="no" ${formData.stillWorking==='no'?'checked':''} onchange="toggleEmployment(false)">
        </label>
      </div>

      <div id="continueBtn" style="text-align:right; margin-top:20px; ${formData.stillWorking==='yes'?'':'display:none;'}">
        <button class="btn" onclick="nextPage()">${t.continue} ‚Üí</button>
      </div>

      <div id="stopMessage" style="color:#dc2626; font-weight:bold; text-align:center; margin-top:20px; ${formData.stillWorking==='no'?'':'display:none;'}">
        ${t.stopMessage}
      </div>
    `;
  }

  /* Step 2: Contact Info */
  if (page === 2) {
    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang==='en'?'selected':''}>English</option>
            <option value="es" ${lang==='es'?'selected':''}>Espa√±ol</option>
            <option value="ht" ${lang==='ht'?'selected':''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${lang==='es'?'Paso 2: Informaci√≥n de Contacto':lang==='ht'?'Etap 2: Enf√≤masyon Kontak':'Step 2: Contact Information'}</h2>
      <p>${lang==='es'?'Recopilamos tu informaci√≥n para ayudarte.':lang==='ht'?'Nou kolekte enf√≤masyon ou pou ede w.':'We collect your info so TASK can support you.'}</p>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
        <div><label>First Name *</label><input id="firstName" value="${formData.firstName||''}"></div>
        <div><label>Last Name *</label><input id="lastName" value="${formData.lastName||''}"></div>
        <div><label>Phone *</label><input id="phone" type="tel" value="${formData.phone||''}" oninput="formatPhone(this)"></div>
        <div><label>Email *</label><input id="email" type="email" value="${formData.email||''}"></div>
      </div>

      <label>${lang==='es'?'M√©todo de Contacto Preferido':lang==='ht'?'Met√≤d Kontak':'Preferred Contact Method'}</label>
      <select id="preferredContact">
        <option ${formData.preferredContact==='Phone'?'selected':''}>Phone</option>
        <option ${formData.preferredContact==='Email'?'selected':''}>Email</option>
        <option ${formData.preferredContact==='Text Message'?'selected':''}>Text Message</option>
      </select>

      <label>${lang==='es'?'Meses empleados':lang==='ht'?'Mwa travay':'Months employed'} *</label>
      <select id="monthsEmployed">
        <option value="">Select...</option>
        <option value="6" ${formData.monthsEmployed==='6'?'selected':''}>6</option>
        <option value="12" ${formData.monthsEmployed==='12'?'selected':''}>12</option>
      </select>

      <div style="display:flex; justify-content:space-between;">
        <button class="btn" onclick="prevPage()">‚Üê ${t.back}</button>
        <button class="btn" onclick="nextPage()">${t.continue} ‚Üí</button>
      </div>
    `;
  }

  document.getElementById("survey").innerHTML = html;
}
</script>
<script>
/* ===== Render Continued ===== */
function renderPage() {
  const t = translations[lang];
  let html = "";

  /* Step 1 and 2 already above... */

  /* Step 3: Feedback + Pay Stub Upload */
  if (page === 3) {
    html = `
      <div class="header-bar">
        <div class="lang-select">
          üåê <select id="langToggle" onchange="setLanguage(this.value)">
            <option value="en" ${lang==='en'?'selected':''}>English</option>
            <option value="es" ${lang==='es'?'selected':''}>Espa√±ol</option>
            <option value="ht" ${lang==='ht'?'selected':''}>Krey√≤l</option>
          </select>
        </div>
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step active">3</div>
          <div class="step">4</div>
        </div>
      </div>

      <h2>${lang==='es'?'Paso 3: Tu Experiencia':lang==='ht'?'Etap 3: Eksperyans Ou':'Step 3: Your Experience'}</h2>
      <p>${lang==='es'?'Cu√©ntanos tu historia para mejorar.':lang==='ht'?'Rakonte nou istwa ou pou amelyore.':'Tell us your story so we can help better.'}</p>

      <label>${lang==='es'?'¬øQu√© te ha ayudado a mantenerte en tu trabajo?':lang==='ht'?'Kisa ki ede w kenbe travay la?':'What has helped you stay in your job?'}</label>
      <textarea id="q1">${formData.q1||''}</textarea>

      <label>${lang==='es'?'¬øQu√© desaf√≠os enfrentas que TASK podr√≠a ayudarte a superar?':lang==='ht'?'Ki defi w ap f√® fas ak yo ke TASK ka ede w?':'What challenges do you face that TASK could help with?'}</label>
      <textarea id="q2">${formData.q2||''}</textarea>

      <label>${lang==='es'?'¬øC√≥mo ha hecho TASK una diferencia para ti?':lang==='ht'?'Kijan TASK te f√® yon diferans pou ou?':'How has TASK made a difference for you?'}</label>
      <textarea id="q3">${formData.q3||''}</textarea>

      <label>${lang==='es'?'Sube tus dos √∫ltimos talones de pago':lang==='ht'?'Telechaje de d√®nye fich peman ou yo':'Upload your last two pay stubs'}</label>
      <div class="upload-box" onclick="document.getElementById('payStubInput').click()">
        üì§ ${lang==='es'?'Haz clic para subir':'Click to upload'}
      </div>
      <input type="file" id="payStubInput" multiple accept="image/*,.pdf" style="display:none" onchange="previewFiles(this)">
      <div class="preview" id="payStubPreview"></div>

      <label style="display:flex; align-items:center; margin-top:20px;">
        <input type="checkbox" id="authorization" ${formData.authorization?'checked':''} style="margin-right:10px;">
        ${lang==='es'?'Autorizo que TASK use esta informaci√≥n':lang==='ht'?'Mwen otorize TASK itilize enf√≤masyon sa yo':'I authorize TASK to use this information'}
      </label>

      <div style="display:flex; justify-content:space-between; margin-top:20px;">
        <button class="btn" onclick="prevPage()">‚Üê ${t.back}</button>
        <button class="btn" onclick="submitSurvey()">${t.submit}</button>
      </div>
    `;
  }

  /* Step 4: Success Screen */
  if (page === 4) {
    html = `
      <div class="header-bar">
        <div class="progress">
          <div class="step active">1</div>
          <div class="step active">2</div>
          <div class="step active">3</div>
          <div class="step active">4</div>
        </div>
      </div>
      <h2 style="color:#16a34a;">‚úÖ ${lang==='es'?'¬°Env√≠o exitoso!':lang==='ht'?'Soum√®t av√®k siks√®!':'Submission Successful!'}</h2>
      <p>${lang==='es'?'Gracias por completar tu informe mensual. Por favor pasa por TASK para recoger tu tarjeta de regalo.':lang==='ht'?'M√®si paske w te konplete rap√≤ chak mwa ou. Tanpri pase pa TASK pou ranmase kat kado ou.':'Thank you for completing your monthly report. Please come to TASK to pick up your gift card.'}</p>
    `;
  }

  document.getElementById("survey").innerHTML = html;
}
</script>
<script>
/* ===== Navigation ===== */
function toggleEmployment(isYes) {
  formData.stillWorking = isYes ? "yes" : "no";
  renderPage();
}

function nextPage() {
  if (page === 1) {
    if (!formData.stillWorking) return alert(translations[lang].completeRequired);
    if (formData.stillWorking === "no") return; // stops at stop message
  }
  if (page === 2) {
    formData.firstName = document.getElementById("firstName").value.trim();
    formData.lastName = document.getElementById("lastName").value.trim();
    formData.phone = document.getElementById("phone").value.trim();
    formData.email = document.getElementById("email").value.trim();
    formData.preferredContact = document.getElementById("preferredContact").value;
    formData.monthsEmployed = document.getElementById("monthsEmployed").value;
    if (!formData.firstName || !formData.lastName || !formData.phone || !formData.email || !formData.monthsEmployed) {
      return alert(translations[lang].completeRequired);
    }
  }
  page++;
  renderPage();
}

function prevPage() {
  if (page > 1) {
    page--;
    renderPage();
  }
}

/* ===== File Preview ===== */
function previewFiles(input) {
  const preview = document.getElementById("payStubPreview");
  preview.innerHTML = "";
  for (const file of input.files) {
    const div = document.createElement("div");
    div.className = "file-name";
    div.textContent = file.name;
    preview.appendChild(div);
  }
}

/* ===== Phone Formatter ===== */
function formatPhone(el) {
  let x = el.value.replace(/\D/g, "").slice(0, 10);
  let formatted = x;
  if (x.length > 6) {
    formatted = `(${x.slice(0,3)}) ${x.slice(3,6)}-${x.slice(6)}`;
  } else if (x.length > 3) {
    formatted = `(${x.slice(0,3)}) ${x.slice(3)}`;
  }
  el.value = formatted;
}

/* ===== Submission ===== */
function submitSurvey() {
  formData.q1 = document.getElementById("q1").value.trim();
  formData.q2 = document.getElementById("q2").value.trim();
  formData.q3 = document.getElementById("q3").value.trim();
  formData.authorization = document.getElementById("authorization").checked;

  if (!formData.q1 || !formData.q2 || !formData.q3 || !formData.authorization) {
    return alert(translations[lang].completeRequired);
  }
  // Normally save to backend
  page = 4;
  renderPage();
}
</script>
<script>
let demoSteps = [];

/* ===== Start / Skip Tutorial ===== */
function startTutorial() {
  isDemoMode = true;
  demoStep = 0;
  const modeEl = document.querySelector("input[name='tutorialMode']:checked");
  tutorialMode = modeEl ? modeEl.value : "auto";
  document.getElementById("demoOverlay").style.display = "none";
  page = 1;
  renderPage();
  demoSteps = getDemoSteps();
  runDemoStep();
}
function skipTutorial() {
  document.getElementById("demoOverlay").style.display = "none";
  page = 1;
  renderPage();
}

/* ===== Speak (uses Speech Synthesis) ===== */
function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = lang === "es" ? "es-ES" : lang === "ht" ? "ht-HT" : "en-US";
  speechSynthesis.speak(utter);
}

/* ===== Tutorial Steps ===== */
function getDemoSteps() {
  return [
    { selector: 'input[name="stillWorking"][value="yes"]',
      text: lang==="es" ? "Marca S√≠ para indicar que a√∫n est√°s empleado."
           : lang==="ht" ? "Chwazi Wi pou montre ou toujou ap travay."
           : "Select Yes to show you‚Äôre still employed.",
      action: () => {
        formData.stillWorking = "yes";
        document.querySelector('input[value="yes"]').checked = true;
        document.getElementById("continueBtn").style.display = "";
      }
    },
    { selector: '#continueBtn',
      text: lang==="es" ? "Haz clic en Continuar para pasar al siguiente paso."
           : lang==="ht" ? "Klike sou Kontinye pou ale nan pwochen etap la."
           : "Click Continue to move forward.",
      action: () => nextPage()
    },
    { selector: '#firstName',
      text: lang==="es" ? "Ingresa tu nombre, por ejemplo John."
           : lang==="ht" ? "Antre non ou, pou egzanp John."
           : "Enter your first name, for example John.",
      action: () => {
        if (tutorialMode==="auto") document.getElementById("firstName").value = "John";
        else { document.getElementById("firstName").placeholder="e.g. John (replace with yours)"; document.getElementById("firstName").style.color="#9ca3af"; }
      }
    },
    { selector: '#lastName',
      text: lang==="es" ? "Ahora tu apellido, por ejemplo Smith."
           : lang==="ht" ? "Koulye a non fanmi ou, pou egzanp Smith."
           : "Now your last name, for example Smith.",
      action: () => {
        if (tutorialMode==="auto") document.getElementById("lastName").value = "Smith";
        else { document.getElementById("lastName").placeholder="e.g. Smith"; document.getElementById("lastName").style.color="#9ca3af"; }
      }
    },
    { selector: '#phone',
      text: lang==="es" ? "Escribe tu n√∫mero de tel√©fono."
           : lang==="ht" ? "Antre nimewo telef√≤n ou."
           : "Enter your phone number.",
      action: () => {
        if (tutorialMode==="auto") document.getElementById("phone").value = "(609) 555-1234";
        else { document.getElementById("phone").placeholder="e.g. (609) 555-1234"; document.getElementById("phone").style.color="#9ca3af"; }
      }
    },
    { selector: '#email',
      text: lang==="es" ? "Agrega tu correo electr√≥nico."
           : lang==="ht" ? "Ajoute adr√®s imel ou."
           : "Add your email address.",
      action: () => {
        if (tutorialMode==="auto") document.getElementById("email").value = "john.smith@email.com";
        else { document.getElementById("email").placeholder="e.g. you@email.com"; document.getElementById("email").style.color="#9ca3af"; }
      }
    },
    { selector: '#monthsEmployed',
      text: lang==="es" ? "Selecciona cu√°ntos meses has trabajado, por ejemplo 6 meses."
           : lang==="ht" ? "Chwazi konbyen mwa ou te travay, pou egzanp 6 mwa."
           : "Select how many months you‚Äôve been employed, for example 6 months.",
      action: () => {
        if (tutorialMode==="auto") document.getElementById("monthsEmployed").value="6";
      }
    },
    { selector: '.btn:last-of-type',
      text: lang==="es" ? "Haz clic en Continuar para seguir."
           : lang==="ht" ? "Klike sou Kontinye pou kontinye."
           : "Click Continue to move forward.",
      action: () => nextPage()
    },
    { selector: '#q1',
      text: lang==="es" ? "Escribe qu√© te ha ayudado a mantener tu empleo."
           : lang==="ht" ? "Ekri sa ki ede w kenbe travay la."
           : "Write what has helped you stay successful at work.",
      action: () => {
        if (tutorialMode==="auto") document.getElementById("q1").value = "Supportive manager and flexible schedule.";
        else { document.getElementById("q1").placeholder="e.g. Supportive manager..."; document.getElementById("q1").style.color="#9ca3af"; }
      }
    },
    { selector: '#q2',
      text: lang==="es" ? "Agrega un desaf√≠o que enfrentas."
           : lang==="ht" ? "Ajoute yon defi w ap f√® fas ak li."
           : "Add a challenge you face.",
      action: () => {
        if (tutorialMode==="auto") document.getElementById("q2").value = "Transportation can be tough sometimes.";
        else { document.getElementById("q2").placeholder="e.g. Transportation issues"; document.getElementById("q2").style.color="#9ca3af"; }
      }
    },
    { selector: '#q3',
      text: lang==="es" ? "Explica c√≥mo TASK ha hecho una diferencia."
           : lang==="ht" ? "Eksplike kijan TASK f√® yon diferans."
           : "Explain how TASK has made a difference.",
      action: () => {
        if (tutorialMode==="auto") document.getElementById("q3").value = "They helped me with job search and training.";
        else { document.getElementById("q3").placeholder="e.g. TASK helped with training"; document.getElementById("q3").style.color="#9ca3af"; }
      }
    },
    { selector: '#payStubInput',
      text: lang==="es" ? "Sube dos talones de pago. Aqu√≠ mostramos un ejemplo ficticio."
           : lang==="ht" ? "Telechaje 2 fich peman. Isit la nou montre yon egzanp fo."
           : "Upload two pay stubs. Here we just show a fake example.",
      action: () => {
        const preview = document.getElementById("payStubPreview");
        preview.innerHTML = '<div class="file-name" style="opacity:0.6">(example) paystub_jan.pdf</div><div class="file-name" style="opacity:0.6">(example) paystub_feb.pdf</div>';
      }
    },
    { selector: '#authorization',
      text: lang==="es" ? "No olvides marcar la autorizaci√≥n."
           : lang==="ht" ? "Pa bliye make bwat otorizasyon an."
           : "Don‚Äôt forget to check the authorization box.",
      action: () => {
        if (tutorialMode==="auto") document.getElementById("authorization").checked = true;
      }
    },
    { selector: 'button.btn:last-of-type',
      text: lang==="es" ? "Haz clic en Enviar para completar."
           : lang==="ht" ? "Klike sou Soum√®t pou fini."
           : "Click Submit to finish.",
      action: () => { if (tutorialMode==="auto") { page=4; renderPage(); } }
    }
  ];
}

/* ===== Run Step ===== */
function runDemoStep() {
  if (!isDemoMode) return;
  if (demoStep >= demoSteps.length) {
    speak(lang==="es" ? "Has completado el tutorial."
         : lang==="ht" ? "Ou fini ak leson patikilye a."
         : "You‚Äôve completed the tutorial.");
    isDemoMode = false;
    return;
  }

  const step = demoSteps[demoStep];
  const el = document.querySelector(step.selector);
  if (el) {
    el.classList.add("demo-highlight");
    speak(step.text);
    step.action && step.action();
    el.scrollIntoView({ behavior: "smooth", block: "center" });
  }

  if (tutorialMode === "auto") {
    demoTimeout = setTimeout(() => {
      if (el) el.classList.remove("demo-highlight");
      demoStep++;
      runDemoStep();
    }, 4500);
  } else {
    // Pause mode: wait for user to advance manually
    const observer = new MutationObserver(() => {
      if (page !== 1 && step.selector==="#continueBtn") { el.classList.remove("demo-highlight"); observer.disconnect(); demoStep++; runDemoStep(); }
      if (page !== 2 && step.selector===".btn:last-of-type") { el.classList.remove("demo-highlight"); observer.disconnect(); demoStep++; runDemoStep(); }
      if (page !== 3 && step.selector==="button.btn:last-of-type") { el.classList.remove("demo-highlight"); observer.disconnect(); demoStep++; runDemoStep(); }
    });
    observer.observe(document.getElementById("survey"), { childList:true, subtree:true });
  }
}
</script>
<script>
/* ===== Init Load ===== */
window.onload = () => {
  const savedLang = localStorage.getItem("taskLanguage");
  if (savedLang) lang = savedLang;
  // Show tutorial overlay first
  document.getElementById("demoOverlay").style.display = "flex";
};
</script>
</body>
</html>
